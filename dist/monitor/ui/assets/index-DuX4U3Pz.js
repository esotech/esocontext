(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();/**
* @vue/shared v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ho(e){const t=Object.create(null);for(const s of e.split(","))t[s]=1;return s=>s in t}const Ce={},qs=[],Vt=()=>{},ga=()=>!1,Cr=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),co=e=>e.startsWith("onUpdate:"),at=Object.assign,uo=(e,t)=>{const s=e.indexOf(t);s>-1&&e.splice(s,1)},yc=Object.prototype.hasOwnProperty,be=(e,t)=>yc.call(e,t),ie=Array.isArray,Ys=e=>xr(e)==="[object Map]",ma=e=>xr(e)==="[object Set]",oe=e=>typeof e=="function",Ke=e=>typeof e=="string",xs=e=>typeof e=="symbol",Ee=e=>e!==null&&typeof e=="object",va=e=>(Ee(e)||oe(e))&&oe(e.then)&&oe(e.catch),Sa=Object.prototype.toString,xr=e=>Sa.call(e),wc=e=>xr(e).slice(8,-1),ba=e=>xr(e)==="[object Object]",kr=e=>Ke(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,mi=ho(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Er=e=>{const t=Object.create(null);return(s=>t[s]||(t[s]=e(s)))},Cc=/-\w/g,Pt=Er(e=>e.replace(Cc,t=>t.slice(1).toUpperCase())),xc=/\B([A-Z])/g,ks=Er(e=>e.replace(xc,"-$1").toLowerCase()),Mr=Er(e=>e.charAt(0).toUpperCase()+e.slice(1)),Kr=Er(e=>e?`on${Mr(e)}`:""),ys=(e,t)=>!Object.is(e,t),Ji=(e,...t)=>{for(let s=0;s<e.length;s++)e[s](...t)},ya=(e,t,s,i=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:i,value:s})},fo=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let $o;const Rr=()=>$o||($o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Kt(e){if(ie(e)){const t={};for(let s=0;s<e.length;s++){const i=e[s],r=Ke(i)?Rc(i):Kt(i);if(r)for(const n in r)t[n]=r[n]}return t}else if(Ke(e)||Ee(e))return e}const kc=/;(?![^(]*\))/g,Ec=/:([^]+)/,Mc=/\/\*[^]*?\*\//g;function Rc(e){const t={};return e.replace(Mc,"").split(kc).forEach(s=>{if(s){const i=s.split(Ec);i.length>1&&(t[i[0].trim()]=i[1].trim())}}),t}function Se(e){let t="";if(Ke(e))t=e;else if(ie(e))for(let s=0;s<e.length;s++){const i=Se(e[s]);i&&(t+=i+" ")}else if(Ee(e))for(const s in e)e[s]&&(t+=s+" ");return t.trim()}const Bc="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Dc=ho(Bc);function wa(e){return!!e||e===""}const Ca=e=>!!(e&&e.__v_isRef===!0),j=e=>Ke(e)?e:e==null?"":ie(e)||Ee(e)&&(e.toString===Sa||!oe(e.toString))?Ca(e)?j(e.value):JSON.stringify(e,xa,2):String(e),xa=(e,t)=>Ca(t)?xa(e,t.value):Ys(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((s,[i,r],n)=>(s[Ur(i,n)+" =>"]=r,s),{})}:ma(t)?{[`Set(${t.size})`]:[...t.values()].map(s=>Ur(s))}:xs(t)?Ur(t):Ee(t)&&!ie(t)&&!ba(t)?String(t):t,Ur=(e,t="")=>{var s;return xs(e)?`Symbol(${(s=e.description)!=null?s:t})`:e};/**
* @vue/reactivity v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let nt;class ka{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=nt,!t&&nt&&(this.index=(nt.scopes||(nt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,s;if(this.scopes)for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].pause();for(t=0,s=this.effects.length;t<s;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,s;if(this.scopes)for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].resume();for(t=0,s=this.effects.length;t<s;t++)this.effects[t].resume()}}run(t){if(this._active){const s=nt;try{return nt=this,t()}finally{nt=s}}}on(){++this._on===1&&(this.prevScope=nt,nt=this)}off(){this._on>0&&--this._on===0&&(nt=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){this._active=!1;let s,i;for(s=0,i=this.effects.length;s<i;s++)this.effects[s].stop();for(this.effects.length=0,s=0,i=this.cleanups.length;s<i;s++)this.cleanups[s]();if(this.cleanups.length=0,this.scopes){for(s=0,i=this.scopes.length;s<i;s++)this.scopes[s].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0}}}function Ea(e){return new ka(e)}function Ma(){return nt}function Tc(e,t=!1){nt&&nt.cleanups.push(e)}let xe;const Vr=new WeakSet;class Ra{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,nt&&nt.active&&nt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Vr.has(this)&&(Vr.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Da(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Ho(this),Ta(this);const t=xe,s=At;xe=this,At=!0;try{return this.fn()}finally{Pa(this),xe=t,At=s,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)go(t);this.deps=this.depsTail=void 0,Ho(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Vr.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){_n(this)&&this.run()}get dirty(){return _n(this)}}let Ba=0,vi,Si;function Da(e,t=!1){if(e.flags|=8,t){e.next=Si,Si=e;return}e.next=vi,vi=e}function _o(){Ba++}function po(){if(--Ba>0)return;if(Si){let t=Si;for(Si=void 0;t;){const s=t.next;t.next=void 0,t.flags&=-9,t=s}}let e;for(;vi;){let t=vi;for(vi=void 0;t;){const s=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(i){e||(e=i)}t=s}}if(e)throw e}function Ta(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function Pa(e){let t,s=e.depsTail,i=s;for(;i;){const r=i.prevDep;i.version===-1?(i===s&&(s=r),go(i),Pc(i)):t=i,i.dep.activeLink=i.prevActiveLink,i.prevActiveLink=void 0,i=r}e.deps=t,e.depsTail=s}function _n(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(La(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function La(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Mi)||(e.globalVersion=Mi,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!_n(e))))return;e.flags|=2;const t=e.dep,s=xe,i=At;xe=e,At=!0;try{Ta(e);const r=e.fn(e._value);(t.version===0||ys(r,e._value))&&(e.flags|=128,e._value=r,t.version++)}catch(r){throw t.version++,r}finally{xe=s,At=i,Pa(e),e.flags&=-3}}function go(e,t=!1){const{dep:s,prevSub:i,nextSub:r}=e;if(i&&(i.nextSub=r,e.prevSub=void 0),r&&(r.prevSub=i,e.nextSub=void 0),s.subs===e&&(s.subs=i,!i&&s.computed)){s.computed.flags&=-5;for(let n=s.computed.deps;n;n=n.nextDep)go(n,!0)}!t&&!--s.sc&&s.map&&s.map.delete(s.key)}function Pc(e){const{prevDep:t,nextDep:s}=e;t&&(t.nextDep=s,e.prevDep=void 0),s&&(s.prevDep=t,e.nextDep=void 0)}let At=!0;const Ia=[];function rs(){Ia.push(At),At=!1}function ns(){const e=Ia.pop();At=e===void 0?!0:e}function Ho(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const s=xe;xe=void 0;try{t()}finally{xe=s}}}let Mi=0;class Lc{constructor(t,s){this.sub=t,this.dep=s,this.version=s.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class mo{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!xe||!At||xe===this.computed)return;let s=this.activeLink;if(s===void 0||s.sub!==xe)s=this.activeLink=new Lc(xe,this),xe.deps?(s.prevDep=xe.depsTail,xe.depsTail.nextDep=s,xe.depsTail=s):xe.deps=xe.depsTail=s,Aa(s);else if(s.version===-1&&(s.version=this.version,s.nextDep)){const i=s.nextDep;i.prevDep=s.prevDep,s.prevDep&&(s.prevDep.nextDep=i),s.prevDep=xe.depsTail,s.nextDep=void 0,xe.depsTail.nextDep=s,xe.depsTail=s,xe.deps===s&&(xe.deps=i)}return s}trigger(t){this.version++,Mi++,this.notify(t)}notify(t){_o();try{for(let s=this.subs;s;s=s.prevSub)s.sub.notify()&&s.sub.dep.notify()}finally{po()}}}function Aa(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let i=t.deps;i;i=i.nextDep)Aa(i)}const s=e.dep.subs;s!==e&&(e.prevSub=s,s&&(s.nextSub=e)),e.dep.subs=e}}const ar=new WeakMap,Ls=Symbol(""),pn=Symbol(""),Ri=Symbol("");function ot(e,t,s){if(At&&xe){let i=ar.get(e);i||ar.set(e,i=new Map);let r=i.get(s);r||(i.set(s,r=new mo),r.map=i,r.key=s),r.track()}}function es(e,t,s,i,r,n){const o=ar.get(e);if(!o){Mi++;return}const l=a=>{a&&a.trigger()};if(_o(),t==="clear")o.forEach(l);else{const a=ie(e),h=a&&kr(s);if(a&&s==="length"){const c=Number(i);o.forEach((u,d)=>{(d==="length"||d===Ri||!xs(d)&&d>=c)&&l(u)})}else switch((s!==void 0||o.has(void 0))&&l(o.get(s)),h&&l(o.get(Ri)),t){case"add":a?h&&l(o.get("length")):(l(o.get(Ls)),Ys(e)&&l(o.get(pn)));break;case"delete":a||(l(o.get(Ls)),Ys(e)&&l(o.get(pn)));break;case"set":Ys(e)&&l(o.get(Ls));break}}po()}function Ic(e,t){const s=ar.get(e);return s&&s.get(t)}function Ws(e){const t=ve(e);return t===e?t:(ot(t,"iterate",Ri),Et(e)?t:t.map(Ot))}function Br(e){return ot(e=ve(e),"iterate",Ri),e}function gs(e,t){return os(e)?is(e)?Gs(Ot(t)):Gs(t):Ot(t)}const Ac={__proto__:null,[Symbol.iterator](){return jr(this,Symbol.iterator,e=>gs(this,e))},concat(...e){return Ws(this).concat(...e.map(t=>ie(t)?Ws(t):t))},entries(){return jr(this,"entries",e=>(e[1]=gs(this,e[1]),e))},every(e,t){return Jt(this,"every",e,t,void 0,arguments)},filter(e,t){return Jt(this,"filter",e,t,s=>s.map(i=>gs(this,i)),arguments)},find(e,t){return Jt(this,"find",e,t,s=>gs(this,s),arguments)},findIndex(e,t){return Jt(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return Jt(this,"findLast",e,t,s=>gs(this,s),arguments)},findLastIndex(e,t){return Jt(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return Jt(this,"forEach",e,t,void 0,arguments)},includes(...e){return qr(this,"includes",e)},indexOf(...e){return qr(this,"indexOf",e)},join(e){return Ws(this).join(e)},lastIndexOf(...e){return qr(this,"lastIndexOf",e)},map(e,t){return Jt(this,"map",e,t,void 0,arguments)},pop(){return si(this,"pop")},push(...e){return si(this,"push",e)},reduce(e,...t){return Wo(this,"reduce",e,t)},reduceRight(e,...t){return Wo(this,"reduceRight",e,t)},shift(){return si(this,"shift")},some(e,t){return Jt(this,"some",e,t,void 0,arguments)},splice(...e){return si(this,"splice",e)},toReversed(){return Ws(this).toReversed()},toSorted(e){return Ws(this).toSorted(e)},toSpliced(...e){return Ws(this).toSpliced(...e)},unshift(...e){return si(this,"unshift",e)},values(){return jr(this,"values",e=>gs(this,e))}};function jr(e,t,s){const i=Br(e),r=i[t]();return i!==e&&!Et(e)&&(r._next=r.next,r.next=()=>{const n=r._next();return n.done||(n.value=s(n.value)),n}),r}const Oc=Array.prototype;function Jt(e,t,s,i,r,n){const o=Br(e),l=o!==e&&!Et(e),a=o[t];if(a!==Oc[t]){const u=a.apply(e,n);return l?Ot(u):u}let h=s;o!==e&&(l?h=function(u,d){return s.call(this,gs(e,u),d,e)}:s.length>2&&(h=function(u,d){return s.call(this,u,d,e)}));const c=a.call(o,h,i);return l&&r?r(c):c}function Wo(e,t,s,i){const r=Br(e);let n=s;return r!==e&&(Et(e)?s.length>3&&(n=function(o,l,a){return s.call(this,o,l,a,e)}):n=function(o,l,a){return s.call(this,o,gs(e,l),a,e)}),r[t](n,...i)}function qr(e,t,s){const i=ve(e);ot(i,"iterate",Ri);const r=i[t](...s);return(r===-1||r===!1)&&Tr(s[0])?(s[0]=ve(s[0]),i[t](...s)):r}function si(e,t,s=[]){rs(),_o();const i=ve(e)[t].apply(e,s);return po(),ns(),i}const Nc=ho("__proto__,__v_isRef,__isVue"),Oa=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(xs));function $c(e){xs(e)||(e=String(e));const t=ve(this);return ot(t,"has",e),t.hasOwnProperty(e)}class Na{constructor(t=!1,s=!1){this._isReadonly=t,this._isShallow=s}get(t,s,i){if(s==="__v_skip")return t.__v_skip;const r=this._isReadonly,n=this._isShallow;if(s==="__v_isReactive")return!r;if(s==="__v_isReadonly")return r;if(s==="__v_isShallow")return n;if(s==="__v_raw")return i===(r?n?Yc:Fa:n?Wa:Ha).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(i)?t:void 0;const o=ie(t);if(!r){let a;if(o&&(a=Ac[s]))return a;if(s==="hasOwnProperty")return $c}const l=Reflect.get(t,s,Le(t)?t:i);if((xs(s)?Oa.has(s):Nc(s))||(r||ot(t,"get",s),n))return l;if(Le(l)){const a=o&&kr(s)?l:l.value;return r&&Ee(a)?mn(a):a}return Ee(l)?r?mn(l):Dr(l):l}}class $a extends Na{constructor(t=!1){super(!1,t)}set(t,s,i,r){let n=t[s];const o=ie(t)&&kr(s);if(!this._isShallow){const h=os(n);if(!Et(i)&&!os(i)&&(n=ve(n),i=ve(i)),!o&&Le(n)&&!Le(i))return h||(n.value=i),!0}const l=o?Number(s)<t.length:be(t,s),a=Reflect.set(t,s,i,Le(t)?t:r);return t===ve(r)&&(l?ys(i,n)&&es(t,"set",s,i):es(t,"add",s,i)),a}deleteProperty(t,s){const i=be(t,s);t[s];const r=Reflect.deleteProperty(t,s);return r&&i&&es(t,"delete",s,void 0),r}has(t,s){const i=Reflect.has(t,s);return(!xs(s)||!Oa.has(s))&&ot(t,"has",s),i}ownKeys(t){return ot(t,"iterate",ie(t)?"length":Ls),Reflect.ownKeys(t)}}class Hc extends Na{constructor(t=!1){super(!0,t)}set(t,s){return!0}deleteProperty(t,s){return!0}}const Wc=new $a,Fc=new Hc,zc=new $a(!0);const gn=e=>e,zi=e=>Reflect.getPrototypeOf(e);function Kc(e,t,s){return function(...i){const r=this.__v_raw,n=ve(r),o=Ys(n),l=e==="entries"||e===Symbol.iterator&&o,a=e==="keys"&&o,h=r[e](...i),c=s?gn:t?Gs:Ot;return!t&&ot(n,"iterate",a?pn:Ls),{next(){const{value:u,done:d}=h.next();return d?{value:u,done:d}:{value:l?[c(u[0]),c(u[1])]:c(u),done:d}},[Symbol.iterator](){return this}}}}function Ki(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function Uc(e,t){const s={get(r){const n=this.__v_raw,o=ve(n),l=ve(r);e||(ys(r,l)&&ot(o,"get",r),ot(o,"get",l));const{has:a}=zi(o),h=t?gn:e?Gs:Ot;if(a.call(o,r))return h(n.get(r));if(a.call(o,l))return h(n.get(l));n!==o&&n.get(r)},get size(){const r=this.__v_raw;return!e&&ot(ve(r),"iterate",Ls),r.size},has(r){const n=this.__v_raw,o=ve(n),l=ve(r);return e||(ys(r,l)&&ot(o,"has",r),ot(o,"has",l)),r===l?n.has(r):n.has(r)||n.has(l)},forEach(r,n){const o=this,l=o.__v_raw,a=ve(l),h=t?gn:e?Gs:Ot;return!e&&ot(a,"iterate",Ls),l.forEach((c,u)=>r.call(n,h(c),h(u),o))}};return at(s,e?{add:Ki("add"),set:Ki("set"),delete:Ki("delete"),clear:Ki("clear")}:{add(r){!t&&!Et(r)&&!os(r)&&(r=ve(r));const n=ve(this);return zi(n).has.call(n,r)||(n.add(r),es(n,"add",r,r)),this},set(r,n){!t&&!Et(n)&&!os(n)&&(n=ve(n));const o=ve(this),{has:l,get:a}=zi(o);let h=l.call(o,r);h||(r=ve(r),h=l.call(o,r));const c=a.call(o,r);return o.set(r,n),h?ys(n,c)&&es(o,"set",r,n):es(o,"add",r,n),this},delete(r){const n=ve(this),{has:o,get:l}=zi(n);let a=o.call(n,r);a||(r=ve(r),a=o.call(n,r)),l&&l.call(n,r);const h=n.delete(r);return a&&es(n,"delete",r,void 0),h},clear(){const r=ve(this),n=r.size!==0,o=r.clear();return n&&es(r,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(r=>{s[r]=Kc(r,e,t)}),s}function vo(e,t){const s=Uc(e,t);return(i,r,n)=>r==="__v_isReactive"?!e:r==="__v_isReadonly"?e:r==="__v_raw"?i:Reflect.get(be(s,r)&&r in i?s:i,r,n)}const Vc={get:vo(!1,!1)},jc={get:vo(!1,!0)},qc={get:vo(!0,!1)};const Ha=new WeakMap,Wa=new WeakMap,Fa=new WeakMap,Yc=new WeakMap;function Xc(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Gc(e){return e.__v_skip||!Object.isExtensible(e)?0:Xc(wc(e))}function Dr(e){return os(e)?e:So(e,!1,Wc,Vc,Ha)}function Jc(e){return So(e,!1,zc,jc,Wa)}function mn(e){return So(e,!0,Fc,qc,Fa)}function So(e,t,s,i,r){if(!Ee(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const n=Gc(e);if(n===0)return e;const o=r.get(e);if(o)return o;const l=new Proxy(e,n===2?i:s);return r.set(e,l),l}function is(e){return os(e)?is(e.__v_raw):!!(e&&e.__v_isReactive)}function os(e){return!!(e&&e.__v_isReadonly)}function Et(e){return!!(e&&e.__v_isShallow)}function Tr(e){return e?!!e.__v_raw:!1}function ve(e){const t=e&&e.__v_raw;return t?ve(t):e}function bo(e){return!be(e,"__v_skip")&&Object.isExtensible(e)&&ya(e,"__v_skip",!0),e}const Ot=e=>Ee(e)?Dr(e):e,Gs=e=>Ee(e)?mn(e):e;function Le(e){return e?e.__v_isRef===!0:!1}function fe(e){return Zc(e,!1)}function Zc(e,t){return Le(e)?e:new Qc(e,t)}class Qc{constructor(t,s){this.dep=new mo,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=s?t:ve(t),this._value=s?t:Ot(t),this.__v_isShallow=s}get value(){return this.dep.track(),this._value}set value(t){const s=this._rawValue,i=this.__v_isShallow||Et(t)||os(t);t=i?t:ve(t),ys(t,s)&&(this._rawValue=t,this._value=i?t:Ot(t),this.dep.trigger())}}function Ne(e){return Le(e)?e.value:e}const eu={get:(e,t,s)=>t==="__v_raw"?e:Ne(Reflect.get(e,t,s)),set:(e,t,s,i)=>{const r=e[t];return Le(r)&&!Le(s)?(r.value=s,!0):Reflect.set(e,t,s,i)}};function za(e){return is(e)?e:new Proxy(e,eu)}function tu(e){const t=ie(e)?new Array(e.length):{};for(const s in e)t[s]=iu(e,s);return t}class su{constructor(t,s,i){this._object=t,this._key=s,this._defaultValue=i,this.__v_isRef=!0,this._value=void 0,this._raw=ve(t);let r=!0,n=t;if(!ie(t)||!kr(String(s)))do r=!Tr(n)||Et(n);while(r&&(n=n.__v_raw));this._shallow=r}get value(){let t=this._object[this._key];return this._shallow&&(t=Ne(t)),this._value=t===void 0?this._defaultValue:t}set value(t){if(this._shallow&&Le(this._raw[this._key])){const s=this._object[this._key];if(Le(s)){s.value=t;return}}this._object[this._key]=t}get dep(){return Ic(this._raw,this._key)}}function iu(e,t,s){return new su(e,t,s)}class ru{constructor(t,s,i){this.fn=t,this.setter=s,this._value=void 0,this.dep=new mo(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Mi-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!s,this.isSSR=i}notify(){if(this.flags|=16,!(this.flags&8)&&xe!==this)return Da(this,!0),!0}get value(){const t=this.dep.track();return La(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function nu(e,t,s=!1){let i,r;return oe(e)?i=e:(i=e.get,r=e.set),new ru(i,r,s)}const Ui={},hr=new WeakMap;let Bs;function ou(e,t=!1,s=Bs){if(s){let i=hr.get(s);i||hr.set(s,i=[]),i.push(e)}}function lu(e,t,s=Ce){const{immediate:i,deep:r,once:n,scheduler:o,augmentJob:l,call:a}=s,h=w=>r?w:Et(w)||r===!1||r===0?ts(w,1):ts(w);let c,u,d,_,p=!1,f=!1;if(Le(e)?(u=()=>e.value,p=Et(e)):is(e)?(u=()=>h(e),p=!0):ie(e)?(f=!0,p=e.some(w=>is(w)||Et(w)),u=()=>e.map(w=>{if(Le(w))return w.value;if(is(w))return h(w);if(oe(w))return a?a(w,2):w()})):oe(e)?t?u=a?()=>a(e,2):e:u=()=>{if(d){rs();try{d()}finally{ns()}}const w=Bs;Bs=c;try{return a?a(e,3,[_]):e(_)}finally{Bs=w}}:u=Vt,t&&r){const w=u,$=r===!0?1/0:r;u=()=>ts(w(),$)}const v=Ma(),S=()=>{c.stop(),v&&v.active&&uo(v.effects,c)};if(n&&t){const w=t;t=(...$)=>{w(...$),S()}}let C=f?new Array(e.length).fill(Ui):Ui;const I=w=>{if(!(!(c.flags&1)||!c.dirty&&!w))if(t){const $=c.run();if(r||p||(f?$.some((J,re)=>ys(J,C[re])):ys($,C))){d&&d();const J=Bs;Bs=c;try{const re=[$,C===Ui?void 0:f&&C[0]===Ui?[]:C,_];C=$,a?a(t,3,re):t(...re)}finally{Bs=J}}}else c.run()};return l&&l(I),c=new Ra(u),c.scheduler=o?()=>o(I,!1):I,_=w=>ou(w,!1,c),d=c.onStop=()=>{const w=hr.get(c);if(w){if(a)a(w,4);else for(const $ of w)$();hr.delete(c)}},t?i?I(!0):C=c.run():o?o(I.bind(null,!0),!0):c.run(),S.pause=c.pause.bind(c),S.resume=c.resume.bind(c),S.stop=S,S}function ts(e,t=1/0,s){if(t<=0||!Ee(e)||e.__v_skip||(s=s||new Map,(s.get(e)||0)>=t))return e;if(s.set(e,t),t--,Le(e))ts(e.value,t,s);else if(ie(e))for(let i=0;i<e.length;i++)ts(e[i],t,s);else if(ma(e)||Ys(e))e.forEach(i=>{ts(i,t,s)});else if(ba(e)){for(const i in e)ts(e[i],t,s);for(const i of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,i)&&ts(e[i],t,s)}return e}/**
* @vue/runtime-core v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ai(e,t,s,i){try{return i?e(...i):e()}catch(r){Pr(r,t,s)}}function qt(e,t,s,i){if(oe(e)){const r=Ai(e,t,s,i);return r&&va(r)&&r.catch(n=>{Pr(n,t,s)}),r}if(ie(e)){const r=[];for(let n=0;n<e.length;n++)r.push(qt(e[n],t,s,i));return r}}function Pr(e,t,s,i=!0){const r=t?t.vnode:null,{errorHandler:n,throwUnhandledErrorInProduction:o}=t&&t.appContext.config||Ce;if(t){let l=t.parent;const a=t.proxy,h=`https://vuejs.org/error-reference/#runtime-${s}`;for(;l;){const c=l.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](e,a,h)===!1)return}l=l.parent}if(n){rs(),Ai(n,null,10,[e,a,h]),ns();return}}au(e,s,r,i,o)}function au(e,t,s,i=!0,r=!1){if(r)throw e;console.error(e)}const ut=[];let Ft=-1;const Xs=[];let ms=null,Us=0;const Ka=Promise.resolve();let cr=null;function Js(e){const t=cr||Ka;return e?t.then(this?e.bind(this):e):t}function hu(e){let t=Ft+1,s=ut.length;for(;t<s;){const i=t+s>>>1,r=ut[i],n=Bi(r);n<e||n===e&&r.flags&2?t=i+1:s=i}return t}function yo(e){if(!(e.flags&1)){const t=Bi(e),s=ut[ut.length-1];!s||!(e.flags&2)&&t>=Bi(s)?ut.push(e):ut.splice(hu(t),0,e),e.flags|=1,Ua()}}function Ua(){cr||(cr=Ka.then(ja))}function cu(e){ie(e)?Xs.push(...e):ms&&e.id===-1?ms.splice(Us+1,0,e):e.flags&1||(Xs.push(e),e.flags|=1),Ua()}function Fo(e,t,s=Ft+1){for(;s<ut.length;s++){const i=ut[s];if(i&&i.flags&2){if(e&&i.id!==e.uid)continue;ut.splice(s,1),s--,i.flags&4&&(i.flags&=-2),i(),i.flags&4||(i.flags&=-2)}}}function Va(e){if(Xs.length){const t=[...new Set(Xs)].sort((s,i)=>Bi(s)-Bi(i));if(Xs.length=0,ms){ms.push(...t);return}for(ms=t,Us=0;Us<ms.length;Us++){const s=ms[Us];s.flags&4&&(s.flags&=-2),s.flags&8||s(),s.flags&=-2}ms=null,Us=0}}const Bi=e=>e.id==null?e.flags&2?-1:1/0:e.id;function ja(e){try{for(Ft=0;Ft<ut.length;Ft++){const t=ut[Ft];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Ai(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Ft<ut.length;Ft++){const t=ut[Ft];t&&(t.flags&=-2)}Ft=-1,ut.length=0,Va(),cr=null,(ut.length||Xs.length)&&ja()}}let xt=null,qa=null;function ur(e){const t=xt;return xt=e,qa=e&&e.type.__scopeId||null,t}function uu(e,t=xt,s){if(!t||e._n)return e;const i=(...r)=>{i._d&&_r(-1);const n=ur(t);let o;try{o=e(...r)}finally{ur(n),i._d&&_r(1)}return o};return i._n=!0,i._c=!0,i._d=!0,i}function Ya(e,t){if(xt===null)return e;const s=Nr(xt),i=e.dirs||(e.dirs=[]);for(let r=0;r<t.length;r++){let[n,o,l,a=Ce]=t[r];n&&(oe(n)&&(n={mounted:n,updated:n}),n.deep&&ts(o),i.push({dir:n,instance:s,value:o,oldValue:void 0,arg:l,modifiers:a}))}return e}function Es(e,t,s,i){const r=e.dirs,n=t&&t.dirs;for(let o=0;o<r.length;o++){const l=r[o];n&&(l.oldValue=n[o].value);let a=l.dir[i];a&&(rs(),qt(a,s,8,[e.el,l,e,t]),ns())}}function du(e,t){if(lt){let s=lt.provides;const i=lt.parent&&lt.parent.provides;i===s&&(s=lt.provides=Object.create(i)),s[e]=t}}function bi(e,t,s=!1){const i=Sh();if(i||As){let r=As?As._context.provides:i?i.parent==null||i.ce?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:void 0;if(r&&e in r)return r[e];if(arguments.length>1)return s&&oe(t)?t.call(i&&i.proxy):t}}function fu(){return!!(Sh()||As)}const _u=Symbol.for("v-scx"),pu=()=>bi(_u);function Is(e,t,s){return Xa(e,t,s)}function Xa(e,t,s=Ce){const{immediate:i,deep:r,flush:n,once:o}=s,l=at({},s),a=t&&i||!t&&n!=="post";let h;if(Ti){if(n==="sync"){const _=pu();h=_.__watcherHandles||(_.__watcherHandles=[])}else if(!a){const _=()=>{};return _.stop=Vt,_.resume=Vt,_.pause=Vt,_}}const c=lt;l.call=(_,p,f)=>qt(_,c,p,f);let u=!1;n==="post"?l.scheduler=_=>{Ct(_,c&&c.suspense)}:n!=="sync"&&(u=!0,l.scheduler=(_,p)=>{p?_():yo(_)}),l.augmentJob=_=>{t&&(_.flags|=4),u&&(_.flags|=2,c&&(_.id=c.uid,_.i=c))};const d=lu(e,t,l);return Ti&&(h?h.push(d):a&&d()),d}function gu(e,t,s){const i=this.proxy,r=Ke(e)?e.includes(".")?Ga(i,e):()=>i[e]:e.bind(i,i);let n;oe(t)?n=t:(n=t.handler,s=t);const o=Ni(this),l=Xa(r,n.bind(i),s);return o(),l}function Ga(e,t){const s=t.split(".");return()=>{let i=e;for(let r=0;r<s.length&&i;r++)i=i[s[r]];return i}}const mu=Symbol("_vte"),vu=e=>e.__isTeleport,Su=Symbol("_leaveCb");function wo(e,t){e.shapeFlag&6&&e.component?(e.transition=t,wo(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function Xt(e,t){return oe(e)?at({name:e.name},t,{setup:e}):e}function Ja(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}const dr=new WeakMap;function yi(e,t,s,i,r=!1){if(ie(e)){e.forEach((p,f)=>yi(p,t&&(ie(t)?t[f]:t),s,i,r));return}if(wi(i)&&!r){i.shapeFlag&512&&i.type.__asyncResolved&&i.component.subTree.component&&yi(e,t,s,i.component.subTree);return}const n=i.shapeFlag&4?Nr(i.component):i.el,o=r?null:n,{i:l,r:a}=e,h=t&&t.r,c=l.refs===Ce?l.refs={}:l.refs,u=l.setupState,d=ve(u),_=u===Ce?ga:p=>be(d,p);if(h!=null&&h!==a){if(zo(t),Ke(h))c[h]=null,_(h)&&(u[h]=null);else if(Le(h)){h.value=null;const p=t;p.k&&(c[p.k]=null)}}if(oe(a))Ai(a,l,12,[o,c]);else{const p=Ke(a),f=Le(a);if(p||f){const v=()=>{if(e.f){const S=p?_(a)?u[a]:c[a]:a.value;if(r)ie(S)&&uo(S,n);else if(ie(S))S.includes(n)||S.push(n);else if(p)c[a]=[n],_(a)&&(u[a]=c[a]);else{const C=[n];a.value=C,e.k&&(c[e.k]=C)}}else p?(c[a]=o,_(a)&&(u[a]=o)):f&&(a.value=o,e.k&&(c[e.k]=o))};if(o){const S=()=>{v(),dr.delete(e)};S.id=-1,dr.set(e,S),Ct(S,s)}else zo(e),v()}}}function zo(e){const t=dr.get(e);t&&(t.flags|=8,dr.delete(e))}Rr().requestIdleCallback;Rr().cancelIdleCallback;const wi=e=>!!e.type.__asyncLoader,Za=e=>e.type.__isKeepAlive;function bu(e,t){Qa(e,"a",t)}function yu(e,t){Qa(e,"da",t)}function Qa(e,t,s=lt){const i=e.__wdc||(e.__wdc=()=>{let r=s;for(;r;){if(r.isDeactivated)return;r=r.parent}return e()});if(Lr(t,i,s),s){let r=s.parent;for(;r&&r.parent;)Za(r.parent.vnode)&&wu(i,t,s,r),r=r.parent}}function wu(e,t,s,i){const r=Lr(t,e,i,!0);Oi(()=>{uo(i[t],r)},s)}function Lr(e,t,s=lt,i=!1){if(s){const r=s[e]||(s[e]=[]),n=t.__weh||(t.__weh=(...o)=>{rs();const l=Ni(s),a=qt(t,s,e,o);return l(),ns(),a});return i?r.unshift(n):r.push(n),n}}const ls=e=>(t,s=lt)=>{(!Ti||e==="sp")&&Lr(e,(...i)=>t(...i),s)},Cu=ls("bm"),Ir=ls("m"),xu=ls("bu"),ku=ls("u"),Eu=ls("bum"),Oi=ls("um"),Mu=ls("sp"),Ru=ls("rtg"),Bu=ls("rtc");function Du(e,t=lt){Lr("ec",e,t)}const Tu="components";function Ko(e,t){return Lu(Tu,e,!0,t)||e}const Pu=Symbol.for("v-ndc");function Lu(e,t,s=!0,i=!1){const r=xt||lt;if(r){const n=r.type;{const l=md(n,!1);if(l&&(l===t||l===Pt(t)||l===Mr(Pt(t))))return n}const o=Uo(r[e]||n[e],t)||Uo(r.appContext[e],t);return!o&&i?n:o}}function Uo(e,t){return e&&(e[t]||e[Pt(t)]||e[Mr(Pt(t))])}function ft(e,t,s,i){let r;const n=s,o=ie(e);if(o||Ke(e)){const l=o&&is(e);let a=!1,h=!1;l&&(a=!Et(e),h=os(e),e=Br(e)),r=new Array(e.length);for(let c=0,u=e.length;c<u;c++)r[c]=t(a?h?Gs(Ot(e[c])):Ot(e[c]):e[c],c,void 0,n)}else if(typeof e=="number"){r=new Array(e);for(let l=0;l<e;l++)r[l]=t(l+1,l,void 0,n)}else if(Ee(e))if(e[Symbol.iterator])r=Array.from(e,(l,a)=>t(l,a,void 0,n));else{const l=Object.keys(e);r=new Array(l.length);for(let a=0,h=l.length;a<h;a++){const c=l[a];r[a]=t(e[c],c,a,n)}}else r=[];return r}const vn=e=>e?bh(e)?Nr(e):vn(e.parent):null,Ci=at(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>vn(e.parent),$root:e=>vn(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>th(e),$forceUpdate:e=>e.f||(e.f=()=>{yo(e.update)}),$nextTick:e=>e.n||(e.n=Js.bind(e.proxy)),$watch:e=>gu.bind(e)}),Yr=(e,t)=>e!==Ce&&!e.__isScriptSetup&&be(e,t),Iu={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:s,setupState:i,data:r,props:n,accessCache:o,type:l,appContext:a}=e;if(t[0]!=="$"){const d=o[t];if(d!==void 0)switch(d){case 1:return i[t];case 2:return r[t];case 4:return s[t];case 3:return n[t]}else{if(Yr(i,t))return o[t]=1,i[t];if(r!==Ce&&be(r,t))return o[t]=2,r[t];if(be(n,t))return o[t]=3,n[t];if(s!==Ce&&be(s,t))return o[t]=4,s[t];Sn&&(o[t]=0)}}const h=Ci[t];let c,u;if(h)return t==="$attrs"&&ot(e.attrs,"get",""),h(e);if((c=l.__cssModules)&&(c=c[t]))return c;if(s!==Ce&&be(s,t))return o[t]=4,s[t];if(u=a.config.globalProperties,be(u,t))return u[t]},set({_:e},t,s){const{data:i,setupState:r,ctx:n}=e;return Yr(r,t)?(r[t]=s,!0):i!==Ce&&be(i,t)?(i[t]=s,!0):be(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(n[t]=s,!0)},has({_:{data:e,setupState:t,accessCache:s,ctx:i,appContext:r,props:n,type:o}},l){let a;return!!(s[l]||e!==Ce&&l[0]!=="$"&&be(e,l)||Yr(t,l)||be(n,l)||be(i,l)||be(Ci,l)||be(r.config.globalProperties,l)||(a=o.__cssModules)&&a[l])},defineProperty(e,t,s){return s.get!=null?e._.accessCache[t]=0:be(s,"value")&&this.set(e,t,s.value,null),Reflect.defineProperty(e,t,s)}};function Vo(e){return ie(e)?e.reduce((t,s)=>(t[s]=null,t),{}):e}let Sn=!0;function Au(e){const t=th(e),s=e.proxy,i=e.ctx;Sn=!1,t.beforeCreate&&jo(t.beforeCreate,e,"bc");const{data:r,computed:n,methods:o,watch:l,provide:a,inject:h,created:c,beforeMount:u,mounted:d,beforeUpdate:_,updated:p,activated:f,deactivated:v,beforeDestroy:S,beforeUnmount:C,destroyed:I,unmounted:w,render:$,renderTracked:J,renderTriggered:re,errorCaptured:X,serverPrefetch:Z,expose:ge,inheritAttrs:ne,components:N,directives:E,filters:O}=t;if(h&&Ou(h,i,null),o)for(const F in o){const P=o[F];oe(P)&&(i[F]=P.bind(s))}if(r){const F=r.call(s,s);Ee(F)&&(e.data=Dr(F))}if(Sn=!0,n)for(const F in n){const P=n[F],_e=oe(P)?P.bind(s,s):oe(P.get)?P.get.bind(s,s):Vt,Me=!oe(P)&&oe(P.set)?P.set.bind(s):Vt,He=pe({get:_e,set:Me});Object.defineProperty(i,F,{enumerable:!0,configurable:!0,get:()=>He.value,set:Ae=>He.value=Ae})}if(l)for(const F in l)eh(l[F],i,s,F);if(a){const F=oe(a)?a.call(s):a;Reflect.ownKeys(F).forEach(P=>{du(P,F[P])})}c&&jo(c,e,"c");function H(F,P){ie(P)?P.forEach(_e=>F(_e.bind(s))):P&&F(P.bind(s))}if(H(Cu,u),H(Ir,d),H(xu,_),H(ku,p),H(bu,f),H(yu,v),H(Du,X),H(Bu,J),H(Ru,re),H(Eu,C),H(Oi,w),H(Mu,Z),ie(ge))if(ge.length){const F=e.exposed||(e.exposed={});ge.forEach(P=>{Object.defineProperty(F,P,{get:()=>s[P],set:_e=>s[P]=_e,enumerable:!0})})}else e.exposed||(e.exposed={});$&&e.render===Vt&&(e.render=$),ne!=null&&(e.inheritAttrs=ne),N&&(e.components=N),E&&(e.directives=E),Z&&Ja(e)}function Ou(e,t,s=Vt){ie(e)&&(e=bn(e));for(const i in e){const r=e[i];let n;Ee(r)?"default"in r?n=bi(r.from||i,r.default,!0):n=bi(r.from||i):n=bi(r),Le(n)?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>n.value,set:o=>n.value=o}):t[i]=n}}function jo(e,t,s){qt(ie(e)?e.map(i=>i.bind(t.proxy)):e.bind(t.proxy),t,s)}function eh(e,t,s,i){let r=i.includes(".")?Ga(s,i):()=>s[i];if(Ke(e)){const n=t[e];oe(n)&&Is(r,n)}else if(oe(e))Is(r,e.bind(s));else if(Ee(e))if(ie(e))e.forEach(n=>eh(n,t,s,i));else{const n=oe(e.handler)?e.handler.bind(s):t[e.handler];oe(n)&&Is(r,n,e)}}function th(e){const t=e.type,{mixins:s,extends:i}=t,{mixins:r,optionsCache:n,config:{optionMergeStrategies:o}}=e.appContext,l=n.get(t);let a;return l?a=l:!r.length&&!s&&!i?a=t:(a={},r.length&&r.forEach(h=>fr(a,h,o,!0)),fr(a,t,o)),Ee(t)&&n.set(t,a),a}function fr(e,t,s,i=!1){const{mixins:r,extends:n}=t;n&&fr(e,n,s,!0),r&&r.forEach(o=>fr(e,o,s,!0));for(const o in t)if(!(i&&o==="expose")){const l=Nu[o]||s&&s[o];e[o]=l?l(e[o],t[o]):t[o]}return e}const Nu={data:qo,props:Yo,emits:Yo,methods:ci,computed:ci,beforeCreate:ht,created:ht,beforeMount:ht,mounted:ht,beforeUpdate:ht,updated:ht,beforeDestroy:ht,beforeUnmount:ht,destroyed:ht,unmounted:ht,activated:ht,deactivated:ht,errorCaptured:ht,serverPrefetch:ht,components:ci,directives:ci,watch:Hu,provide:qo,inject:$u};function qo(e,t){return t?e?function(){return at(oe(e)?e.call(this,this):e,oe(t)?t.call(this,this):t)}:t:e}function $u(e,t){return ci(bn(e),bn(t))}function bn(e){if(ie(e)){const t={};for(let s=0;s<e.length;s++)t[e[s]]=e[s];return t}return e}function ht(e,t){return e?[...new Set([].concat(e,t))]:t}function ci(e,t){return e?at(Object.create(null),e,t):t}function Yo(e,t){return e?ie(e)&&ie(t)?[...new Set([...e,...t])]:at(Object.create(null),Vo(e),Vo(t??{})):t}function Hu(e,t){if(!e)return t;if(!t)return e;const s=at(Object.create(null),e);for(const i in t)s[i]=ht(e[i],t[i]);return s}function sh(){return{app:null,config:{isNativeTag:ga,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Wu=0;function Fu(e,t){return function(i,r=null){oe(i)||(i=at({},i)),r!=null&&!Ee(r)&&(r=null);const n=sh(),o=new WeakSet,l=[];let a=!1;const h=n.app={_uid:Wu++,_component:i,_props:r,_container:null,_context:n,_instance:null,version:Sd,get config(){return n.config},set config(c){},use(c,...u){return o.has(c)||(c&&oe(c.install)?(o.add(c),c.install(h,...u)):oe(c)&&(o.add(c),c(h,...u))),h},mixin(c){return n.mixins.includes(c)||n.mixins.push(c),h},component(c,u){return u?(n.components[c]=u,h):n.components[c]},directive(c,u){return u?(n.directives[c]=u,h):n.directives[c]},mount(c,u,d){if(!a){const _=h._ceVNode||$e(i,r);return _.appContext=n,d===!0?d="svg":d===!1&&(d=void 0),e(_,c,d),a=!0,h._container=c,c.__vue_app__=h,Nr(_.component)}},onUnmount(c){l.push(c)},unmount(){a&&(qt(l,h._instance,16),e(null,h._container),delete h._container.__vue_app__)},provide(c,u){return n.provides[c]=u,h},runWithContext(c){const u=As;As=h;try{return c()}finally{As=u}}};return h}}let As=null;const zu=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${Pt(t)}Modifiers`]||e[`${ks(t)}Modifiers`];function Ku(e,t,...s){if(e.isUnmounted)return;const i=e.vnode.props||Ce;let r=s;const n=t.startsWith("update:"),o=n&&zu(i,t.slice(7));o&&(o.trim&&(r=s.map(c=>Ke(c)?c.trim():c)),o.number&&(r=s.map(fo)));let l,a=i[l=Kr(t)]||i[l=Kr(Pt(t))];!a&&n&&(a=i[l=Kr(ks(t))]),a&&qt(a,e,6,r);const h=i[l+"Once"];if(h){if(!e.emitted)e.emitted={};else if(e.emitted[l])return;e.emitted[l]=!0,qt(h,e,6,r)}}const Uu=new WeakMap;function ih(e,t,s=!1){const i=s?Uu:t.emitsCache,r=i.get(e);if(r!==void 0)return r;const n=e.emits;let o={},l=!1;if(!oe(e)){const a=h=>{const c=ih(h,t,!0);c&&(l=!0,at(o,c))};!s&&t.mixins.length&&t.mixins.forEach(a),e.extends&&a(e.extends),e.mixins&&e.mixins.forEach(a)}return!n&&!l?(Ee(e)&&i.set(e,null),null):(ie(n)?n.forEach(a=>o[a]=null):at(o,n),Ee(e)&&i.set(e,o),o)}function Ar(e,t){return!e||!Cr(t)?!1:(t=t.slice(2).replace(/Once$/,""),be(e,t[0].toLowerCase()+t.slice(1))||be(e,ks(t))||be(e,t))}function Xo(e){const{type:t,vnode:s,proxy:i,withProxy:r,propsOptions:[n],slots:o,attrs:l,emit:a,render:h,renderCache:c,props:u,data:d,setupState:_,ctx:p,inheritAttrs:f}=e,v=ur(e);let S,C;try{if(s.shapeFlag&4){const w=r||i,$=w;S=zt(h.call($,w,c,u,_,d,p)),C=l}else{const w=t;S=zt(w.length>1?w(u,{attrs:l,slots:o,emit:a}):w(u,null)),C=t.props?l:Vu(l)}}catch(w){xi.length=0,Pr(w,e,1),S=$e(Cs)}let I=S;if(C&&f!==!1){const w=Object.keys(C),{shapeFlag:$}=I;w.length&&$&7&&(n&&w.some(co)&&(C=ju(C,n)),I=Zs(I,C,!1,!0))}return s.dirs&&(I=Zs(I,null,!1,!0),I.dirs=I.dirs?I.dirs.concat(s.dirs):s.dirs),s.transition&&wo(I,s.transition),S=I,ur(v),S}const Vu=e=>{let t;for(const s in e)(s==="class"||s==="style"||Cr(s))&&((t||(t={}))[s]=e[s]);return t},ju=(e,t)=>{const s={};for(const i in e)(!co(i)||!(i.slice(9)in t))&&(s[i]=e[i]);return s};function qu(e,t,s){const{props:i,children:r,component:n}=e,{props:o,children:l,patchFlag:a}=t,h=n.emitsOptions;if(t.dirs||t.transition)return!0;if(s&&a>=0){if(a&1024)return!0;if(a&16)return i?Go(i,o,h):!!o;if(a&8){const c=t.dynamicProps;for(let u=0;u<c.length;u++){const d=c[u];if(o[d]!==i[d]&&!Ar(h,d))return!0}}}else return(r||l)&&(!l||!l.$stable)?!0:i===o?!1:i?o?Go(i,o,h):!0:!!o;return!1}function Go(e,t,s){const i=Object.keys(t);if(i.length!==Object.keys(e).length)return!0;for(let r=0;r<i.length;r++){const n=i[r];if(t[n]!==e[n]&&!Ar(s,n))return!0}return!1}function Yu({vnode:e,parent:t},s){for(;t;){const i=t.subTree;if(i.suspense&&i.suspense.activeBranch===e&&(i.el=e.el),i===e)(e=t.vnode).el=s,t=t.parent;else break}}const rh={},nh=()=>Object.create(rh),oh=e=>Object.getPrototypeOf(e)===rh;function Xu(e,t,s,i=!1){const r={},n=nh();e.propsDefaults=Object.create(null),lh(e,t,r,n);for(const o in e.propsOptions[0])o in r||(r[o]=void 0);s?e.props=i?r:Jc(r):e.type.props?e.props=r:e.props=n,e.attrs=n}function Gu(e,t,s,i){const{props:r,attrs:n,vnode:{patchFlag:o}}=e,l=ve(r),[a]=e.propsOptions;let h=!1;if((i||o>0)&&!(o&16)){if(o&8){const c=e.vnode.dynamicProps;for(let u=0;u<c.length;u++){let d=c[u];if(Ar(e.emitsOptions,d))continue;const _=t[d];if(a)if(be(n,d))_!==n[d]&&(n[d]=_,h=!0);else{const p=Pt(d);r[p]=yn(a,l,p,_,e,!1)}else _!==n[d]&&(n[d]=_,h=!0)}}}else{lh(e,t,r,n)&&(h=!0);let c;for(const u in l)(!t||!be(t,u)&&((c=ks(u))===u||!be(t,c)))&&(a?s&&(s[u]!==void 0||s[c]!==void 0)&&(r[u]=yn(a,l,u,void 0,e,!0)):delete r[u]);if(n!==l)for(const u in n)(!t||!be(t,u))&&(delete n[u],h=!0)}h&&es(e.attrs,"set","")}function lh(e,t,s,i){const[r,n]=e.propsOptions;let o=!1,l;if(t)for(let a in t){if(mi(a))continue;const h=t[a];let c;r&&be(r,c=Pt(a))?!n||!n.includes(c)?s[c]=h:(l||(l={}))[c]=h:Ar(e.emitsOptions,a)||(!(a in i)||h!==i[a])&&(i[a]=h,o=!0)}if(n){const a=ve(s),h=l||Ce;for(let c=0;c<n.length;c++){const u=n[c];s[u]=yn(r,a,u,h[u],e,!be(h,u))}}return o}function yn(e,t,s,i,r,n){const o=e[s];if(o!=null){const l=be(o,"default");if(l&&i===void 0){const a=o.default;if(o.type!==Function&&!o.skipFactory&&oe(a)){const{propsDefaults:h}=r;if(s in h)i=h[s];else{const c=Ni(r);i=h[s]=a.call(null,t),c()}}else i=a;r.ce&&r.ce._setProp(s,i)}o[0]&&(n&&!l?i=!1:o[1]&&(i===""||i===ks(s))&&(i=!0))}return i}const Ju=new WeakMap;function ah(e,t,s=!1){const i=s?Ju:t.propsCache,r=i.get(e);if(r)return r;const n=e.props,o={},l=[];let a=!1;if(!oe(e)){const c=u=>{a=!0;const[d,_]=ah(u,t,!0);at(o,d),_&&l.push(..._)};!s&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}if(!n&&!a)return Ee(e)&&i.set(e,qs),qs;if(ie(n))for(let c=0;c<n.length;c++){const u=Pt(n[c]);Jo(u)&&(o[u]=Ce)}else if(n)for(const c in n){const u=Pt(c);if(Jo(u)){const d=n[c],_=o[u]=ie(d)||oe(d)?{type:d}:at({},d),p=_.type;let f=!1,v=!0;if(ie(p))for(let S=0;S<p.length;++S){const C=p[S],I=oe(C)&&C.name;if(I==="Boolean"){f=!0;break}else I==="String"&&(v=!1)}else f=oe(p)&&p.name==="Boolean";_[0]=f,_[1]=v,(f||be(_,"default"))&&l.push(u)}}const h=[o,l];return Ee(e)&&i.set(e,h),h}function Jo(e){return e[0]!=="$"&&!mi(e)}const Co=e=>e==="_"||e==="_ctx"||e==="$stable",xo=e=>ie(e)?e.map(zt):[zt(e)],Zu=(e,t,s)=>{if(t._n)return t;const i=uu((...r)=>xo(t(...r)),s);return i._c=!1,i},hh=(e,t,s)=>{const i=e._ctx;for(const r in e){if(Co(r))continue;const n=e[r];if(oe(n))t[r]=Zu(r,n,i);else if(n!=null){const o=xo(n);t[r]=()=>o}}},ch=(e,t)=>{const s=xo(t);e.slots.default=()=>s},uh=(e,t,s)=>{for(const i in t)(s||!Co(i))&&(e[i]=t[i])},Qu=(e,t,s)=>{const i=e.slots=nh();if(e.vnode.shapeFlag&32){const r=t._;r?(uh(i,t,s),s&&ya(i,"_",r,!0)):hh(t,i)}else t&&ch(e,t)},ed=(e,t,s)=>{const{vnode:i,slots:r}=e;let n=!0,o=Ce;if(i.shapeFlag&32){const l=t._;l?s&&l===1?n=!1:uh(r,t,s):(n=!t.$stable,hh(t,r)),o=t}else t&&(ch(e,t),o={default:1});if(n)for(const l in r)!Co(l)&&o[l]==null&&delete r[l]},Ct=nd;function td(e){return sd(e)}function sd(e,t){const s=Rr();s.__VUE__=!0;const{insert:i,remove:r,patchProp:n,createElement:o,createText:l,createComment:a,setText:h,setElementText:c,parentNode:u,nextSibling:d,setScopeId:_=Vt,insertStaticContent:p}=e,f=(g,b,x,A=null,D=null,T=null,V=void 0,K=null,z=!!b.dynamicChildren)=>{if(g===b)return;g&&!ii(g,b)&&(A=mt(g),Ae(g,D,T,!0),g=null),b.patchFlag===-2&&(z=!1,b.dynamicChildren=null);const{type:L,ref:ee,shapeFlag:q}=b;switch(L){case Or:v(g,b,x,A);break;case Cs:S(g,b,x,A);break;case Zi:g==null&&C(b,x,A,V);break;case ye:N(g,b,x,A,D,T,V,K,z);break;default:q&1?$(g,b,x,A,D,T,V,K,z):q&6?E(g,b,x,A,D,T,V,K,z):(q&64||q&128)&&L.process(g,b,x,A,D,T,V,K,z,Mt)}ee!=null&&D?yi(ee,g&&g.ref,T,b||g,!b):ee==null&&g&&g.ref!=null&&yi(g.ref,null,T,g,!0)},v=(g,b,x,A)=>{if(g==null)i(b.el=l(b.children),x,A);else{const D=b.el=g.el;b.children!==g.children&&h(D,b.children)}},S=(g,b,x,A)=>{g==null?i(b.el=a(b.children||""),x,A):b.el=g.el},C=(g,b,x,A)=>{[g.el,g.anchor]=p(g.children,b,x,A,g.el,g.anchor)},I=({el:g,anchor:b},x,A)=>{let D;for(;g&&g!==b;)D=d(g),i(g,x,A),g=D;i(b,x,A)},w=({el:g,anchor:b})=>{let x;for(;g&&g!==b;)x=d(g),r(g),g=x;r(b)},$=(g,b,x,A,D,T,V,K,z)=>{if(b.type==="svg"?V="svg":b.type==="math"&&(V="mathml"),g==null)J(b,x,A,D,T,V,K,z);else{const L=g.el&&g.el._isVueCE?g.el:null;try{L&&L._beginPatch(),Z(g,b,D,T,V,K,z)}finally{L&&L._endPatch()}}},J=(g,b,x,A,D,T,V,K)=>{let z,L;const{props:ee,shapeFlag:q,transition:G,dirs:te}=g;if(z=g.el=o(g.type,T,ee&&ee.is,ee),q&8?c(z,g.children):q&16&&X(g.children,z,null,A,D,Xr(g,T),V,K),te&&Es(g,null,A,"created"),re(z,g,g.scopeId,V,A),ee){for(const y in ee)y!=="value"&&!mi(y)&&n(z,y,null,ee[y],T,A);"value"in ee&&n(z,"value",null,ee.value,T),(L=ee.onVnodeBeforeMount)&&Nt(L,A,g)}te&&Es(g,null,A,"beforeMount");const de=id(D,G);de&&G.beforeEnter(z),i(z,b,x),((L=ee&&ee.onVnodeMounted)||de||te)&&Ct(()=>{L&&Nt(L,A,g),de&&G.enter(z),te&&Es(g,null,A,"mounted")},D)},re=(g,b,x,A,D)=>{if(x&&_(g,x),A)for(let T=0;T<A.length;T++)_(g,A[T]);if(D){let T=D.subTree;if(b===T||ph(T.type)&&(T.ssContent===b||T.ssFallback===b)){const V=D.vnode;re(g,V,V.scopeId,V.slotScopeIds,D.parent)}}},X=(g,b,x,A,D,T,V,K,z=0)=>{for(let L=z;L<g.length;L++){const ee=g[L]=K?vs(g[L]):zt(g[L]);f(null,ee,b,x,A,D,T,V,K)}},Z=(g,b,x,A,D,T,V)=>{const K=b.el=g.el;let{patchFlag:z,dynamicChildren:L,dirs:ee}=b;z|=g.patchFlag&16;const q=g.props||Ce,G=b.props||Ce;let te;if(x&&Ms(x,!1),(te=G.onVnodeBeforeUpdate)&&Nt(te,x,b,g),ee&&Es(b,g,x,"beforeUpdate"),x&&Ms(x,!0),(q.innerHTML&&G.innerHTML==null||q.textContent&&G.textContent==null)&&c(K,""),L?ge(g.dynamicChildren,L,K,x,A,Xr(b,D),T):V||P(g,b,K,null,x,A,Xr(b,D),T,!1),z>0){if(z&16)ne(K,q,G,x,D);else if(z&2&&q.class!==G.class&&n(K,"class",null,G.class,D),z&4&&n(K,"style",q.style,G.style,D),z&8){const de=b.dynamicProps;for(let y=0;y<de.length;y++){const R=de[y],ae=q[R],me=G[R];(me!==ae||R==="value")&&n(K,R,ae,me,D,x)}}z&1&&g.children!==b.children&&c(K,b.children)}else!V&&L==null&&ne(K,q,G,x,D);((te=G.onVnodeUpdated)||ee)&&Ct(()=>{te&&Nt(te,x,b,g),ee&&Es(b,g,x,"updated")},A)},ge=(g,b,x,A,D,T,V)=>{for(let K=0;K<b.length;K++){const z=g[K],L=b[K],ee=z.el&&(z.type===ye||!ii(z,L)||z.shapeFlag&198)?u(z.el):x;f(z,L,ee,null,A,D,T,V,!0)}},ne=(g,b,x,A,D)=>{if(b!==x){if(b!==Ce)for(const T in b)!mi(T)&&!(T in x)&&n(g,T,b[T],null,D,A);for(const T in x){if(mi(T))continue;const V=x[T],K=b[T];V!==K&&T!=="value"&&n(g,T,K,V,D,A)}"value"in x&&n(g,"value",b.value,x.value,D)}},N=(g,b,x,A,D,T,V,K,z)=>{const L=b.el=g?g.el:l(""),ee=b.anchor=g?g.anchor:l("");let{patchFlag:q,dynamicChildren:G,slotScopeIds:te}=b;te&&(K=K?K.concat(te):te),g==null?(i(L,x,A),i(ee,x,A),X(b.children||[],x,ee,D,T,V,K,z)):q>0&&q&64&&G&&g.dynamicChildren&&g.dynamicChildren.length===G.length?(ge(g.dynamicChildren,G,x,D,T,V,K),(b.key!=null||D&&b===D.subTree)&&dh(g,b,!0)):P(g,b,x,ee,D,T,V,K,z)},E=(g,b,x,A,D,T,V,K,z)=>{b.slotScopeIds=K,g==null?b.shapeFlag&512?D.ctx.activate(b,x,A,V,z):O(b,x,A,D,T,V,z):U(g,b,z)},O=(g,b,x,A,D,T,V)=>{const K=g.component=dd(g,A,D);if(Za(g)&&(K.ctx.renderer=Mt),fd(K,!1,V),K.asyncDep){if(D&&D.registerDep(K,H,V),!g.el){const z=K.subTree=$e(Cs);S(null,z,b,x),g.placeholder=z.el}}else H(K,g,b,x,D,T,V)},U=(g,b,x)=>{const A=b.component=g.component;if(qu(g,b,x))if(A.asyncDep&&!A.asyncResolved){F(A,b,x);return}else A.next=b,A.update();else b.el=g.el,A.vnode=b},H=(g,b,x,A,D,T,V)=>{const K=()=>{if(g.isMounted){let{next:q,bu:G,u:te,parent:de,vnode:y}=g;{const Ue=fh(g);if(Ue){q&&(q.el=y.el,F(g,q,V)),Ue.asyncDep.then(()=>{g.isUnmounted||K()});return}}let R=q,ae;Ms(g,!1),q?(q.el=y.el,F(g,q,V)):q=y,G&&Ji(G),(ae=q.props&&q.props.onVnodeBeforeUpdate)&&Nt(ae,de,q,y),Ms(g,!0);const me=Xo(g),Be=g.subTree;g.subTree=me,f(Be,me,u(Be.el),mt(Be),g,D,T),q.el=me.el,R===null&&Yu(g,me.el),te&&Ct(te,D),(ae=q.props&&q.props.onVnodeUpdated)&&Ct(()=>Nt(ae,de,q,y),D)}else{let q;const{el:G,props:te}=b,{bm:de,m:y,parent:R,root:ae,type:me}=g,Be=wi(b);Ms(g,!1),de&&Ji(de),!Be&&(q=te&&te.onVnodeBeforeMount)&&Nt(q,R,b),Ms(g,!0);{ae.ce&&ae.ce._def.shadowRoot!==!1&&ae.ce._injectChildStyle(me);const Ue=g.subTree=Xo(g);f(null,Ue,x,A,g,D,T),b.el=Ue.el}if(y&&Ct(y,D),!Be&&(q=te&&te.onVnodeMounted)){const Ue=b;Ct(()=>Nt(q,R,Ue),D)}(b.shapeFlag&256||R&&wi(R.vnode)&&R.vnode.shapeFlag&256)&&g.a&&Ct(g.a,D),g.isMounted=!0,b=x=A=null}};g.scope.on();const z=g.effect=new Ra(K);g.scope.off();const L=g.update=z.run.bind(z),ee=g.job=z.runIfDirty.bind(z);ee.i=g,ee.id=g.uid,z.scheduler=()=>yo(ee),Ms(g,!0),L()},F=(g,b,x)=>{b.component=g;const A=g.vnode.props;g.vnode=b,g.next=null,Gu(g,b.props,A,x),ed(g,b.children,x),rs(),Fo(g),ns()},P=(g,b,x,A,D,T,V,K,z=!1)=>{const L=g&&g.children,ee=g?g.shapeFlag:0,q=b.children,{patchFlag:G,shapeFlag:te}=b;if(G>0){if(G&128){Me(L,q,x,A,D,T,V,K,z);return}else if(G&256){_e(L,q,x,A,D,T,V,K,z);return}}te&8?(ee&16&&We(L,D,T),q!==L&&c(x,q)):ee&16?te&16?Me(L,q,x,A,D,T,V,K,z):We(L,D,T,!0):(ee&8&&c(x,""),te&16&&X(q,x,A,D,T,V,K,z))},_e=(g,b,x,A,D,T,V,K,z)=>{g=g||qs,b=b||qs;const L=g.length,ee=b.length,q=Math.min(L,ee);let G;for(G=0;G<q;G++){const te=b[G]=z?vs(b[G]):zt(b[G]);f(g[G],te,x,null,D,T,V,K,z)}L>ee?We(g,D,T,!0,!1,q):X(b,x,A,D,T,V,K,z,q)},Me=(g,b,x,A,D,T,V,K,z)=>{let L=0;const ee=b.length;let q=g.length-1,G=ee-1;for(;L<=q&&L<=G;){const te=g[L],de=b[L]=z?vs(b[L]):zt(b[L]);if(ii(te,de))f(te,de,x,null,D,T,V,K,z);else break;L++}for(;L<=q&&L<=G;){const te=g[q],de=b[G]=z?vs(b[G]):zt(b[G]);if(ii(te,de))f(te,de,x,null,D,T,V,K,z);else break;q--,G--}if(L>q){if(L<=G){const te=G+1,de=te<ee?b[te].el:A;for(;L<=G;)f(null,b[L]=z?vs(b[L]):zt(b[L]),x,de,D,T,V,K,z),L++}}else if(L>G)for(;L<=q;)Ae(g[L],D,T,!0),L++;else{const te=L,de=L,y=new Map;for(L=de;L<=G;L++){const le=b[L]=z?vs(b[L]):zt(b[L]);le.key!=null&&y.set(le.key,L)}let R,ae=0;const me=G-de+1;let Be=!1,Ue=0;const Lt=new Array(me);for(L=0;L<me;L++)Lt[L]=0;for(L=te;L<=q;L++){const le=g[L];if(ae>=me){Ae(le,D,T,!0);continue}let vt;if(le.key!=null)vt=y.get(le.key);else for(R=de;R<=G;R++)if(Lt[R-de]===0&&ii(le,b[R])){vt=R;break}vt===void 0?Ae(le,D,T,!0):(Lt[vt-de]=L+1,vt>=Ue?Ue=vt:Be=!0,f(le,b[vt],x,null,D,T,V,K,z),ae++)}const ue=Be?rd(Lt):qs;for(R=ue.length-1,L=me-1;L>=0;L--){const le=de+L,vt=b[le],Oo=b[le+1],No=le+1<ee?Oo.el||_h(Oo):A;Lt[L]===0?f(null,vt,x,No,D,T,V,K,z):Be&&(R<0||L!==ue[R]?He(vt,x,No,2):R--)}}},He=(g,b,x,A,D=null)=>{const{el:T,type:V,transition:K,children:z,shapeFlag:L}=g;if(L&6){He(g.component.subTree,b,x,A);return}if(L&128){g.suspense.move(b,x,A);return}if(L&64){V.move(g,b,x,Mt);return}if(V===ye){i(T,b,x);for(let q=0;q<z.length;q++)He(z[q],b,x,A);i(g.anchor,b,x);return}if(V===Zi){I(g,b,x);return}if(A!==2&&L&1&&K)if(A===0)K.beforeEnter(T),i(T,b,x),Ct(()=>K.enter(T),D);else{const{leave:q,delayLeave:G,afterLeave:te}=K,de=()=>{g.ctx.isUnmounted?r(T):i(T,b,x)},y=()=>{T._isLeaving&&T[Su](!0),q(T,()=>{de(),te&&te()})};G?G(T,de,y):y()}else i(T,b,x)},Ae=(g,b,x,A=!1,D=!1)=>{const{type:T,props:V,ref:K,children:z,dynamicChildren:L,shapeFlag:ee,patchFlag:q,dirs:G,cacheIndex:te}=g;if(q===-2&&(D=!1),K!=null&&(rs(),yi(K,null,x,g,!0),ns()),te!=null&&(b.renderCache[te]=void 0),ee&256){b.ctx.deactivate(g);return}const de=ee&1&&G,y=!wi(g);let R;if(y&&(R=V&&V.onVnodeBeforeUnmount)&&Nt(R,b,g),ee&6)gt(g.component,x,A);else{if(ee&128){g.suspense.unmount(x,A);return}de&&Es(g,null,b,"beforeUnmount"),ee&64?g.type.remove(g,b,x,Mt,A):L&&!L.hasOnce&&(T!==ye||q>0&&q&64)?We(L,b,x,!1,!0):(T===ye&&q&384||!D&&ee&16)&&We(z,b,x),A&&tt(g)}(y&&(R=V&&V.onVnodeUnmounted)||de)&&Ct(()=>{R&&Nt(R,b,g),de&&Es(g,null,b,"unmounted")},x)},tt=g=>{const{type:b,el:x,anchor:A,transition:D}=g;if(b===ye){Ye(x,A);return}if(b===Zi){w(g);return}const T=()=>{r(x),D&&!D.persisted&&D.afterLeave&&D.afterLeave()};if(g.shapeFlag&1&&D&&!D.persisted){const{leave:V,delayLeave:K}=D,z=()=>V(x,T);K?K(g.el,T,z):z()}else T()},Ye=(g,b)=>{let x;for(;g!==b;)x=d(g),r(g),g=x;r(b)},gt=(g,b,x)=>{const{bum:A,scope:D,job:T,subTree:V,um:K,m:z,a:L}=g;Zo(z),Zo(L),A&&Ji(A),D.stop(),T&&(T.flags|=8,Ae(V,g,b,x)),K&&Ct(K,b),Ct(()=>{g.isUnmounted=!0},b)},We=(g,b,x,A=!1,D=!1,T=0)=>{for(let V=T;V<g.length;V++)Ae(g[V],b,x,A,D)},mt=g=>{if(g.shapeFlag&6)return mt(g.component.subTree);if(g.shapeFlag&128)return g.suspense.next();const b=d(g.anchor||g.el),x=b&&b[mu];return x?d(x):b};let Gt=!1;const bt=(g,b,x)=>{let A;g==null?b._vnode&&(Ae(b._vnode,null,null,!0),A=b._vnode.component):f(b._vnode||null,g,b,null,null,null,x),b._vnode=g,Gt||(Gt=!0,Fo(A),Va(),Gt=!1)},Mt={p:f,um:Ae,m:He,r:tt,mt:O,mc:X,pc:P,pbc:ge,n:mt,o:e};return{render:bt,hydrate:void 0,createApp:Fu(bt)}}function Xr({type:e,props:t},s){return s==="svg"&&e==="foreignObject"||s==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:s}function Ms({effect:e,job:t},s){s?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function id(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function dh(e,t,s=!1){const i=e.children,r=t.children;if(ie(i)&&ie(r))for(let n=0;n<i.length;n++){const o=i[n];let l=r[n];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=r[n]=vs(r[n]),l.el=o.el),!s&&l.patchFlag!==-2&&dh(o,l)),l.type===Or&&(l.patchFlag!==-1?l.el=o.el:l.__elIndex=n+(e.type===ye?1:0)),l.type===Cs&&!l.el&&(l.el=o.el)}}function rd(e){const t=e.slice(),s=[0];let i,r,n,o,l;const a=e.length;for(i=0;i<a;i++){const h=e[i];if(h!==0){if(r=s[s.length-1],e[r]<h){t[i]=r,s.push(i);continue}for(n=0,o=s.length-1;n<o;)l=n+o>>1,e[s[l]]<h?n=l+1:o=l;h<e[s[n]]&&(n>0&&(t[i]=s[n-1]),s[n]=i)}}for(n=s.length,o=s[n-1];n-- >0;)s[n]=o,o=t[o];return s}function fh(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:fh(t)}function Zo(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}function _h(e){if(e.placeholder)return e.placeholder;const t=e.component;return t?_h(t.subTree):null}const ph=e=>e.__isSuspense;function nd(e,t){t&&t.pendingBranch?ie(e)?t.effects.push(...e):t.effects.push(e):cu(e)}const ye=Symbol.for("v-fgt"),Or=Symbol.for("v-txt"),Cs=Symbol.for("v-cmt"),Zi=Symbol.for("v-stc"),xi=[];let kt=null;function M(e=!1){xi.push(kt=e?null:[])}function od(){xi.pop(),kt=xi[xi.length-1]||null}let Di=1;function _r(e,t=!1){Di+=e,e<0&&kt&&t&&(kt.hasOnce=!0)}function gh(e){return e.dynamicChildren=Di>0?kt||qs:null,od(),Di>0&&kt&&kt.push(e),e}function B(e,t,s,i,r,n){return gh(m(e,t,s,i,r,n,!0))}function Qi(e,t,s,i,r){return gh($e(e,t,s,i,r,!0))}function pr(e){return e?e.__v_isVNode===!0:!1}function ii(e,t){return e.type===t.type&&e.key===t.key}const mh=({key:e})=>e??null,er=({ref:e,ref_key:t,ref_for:s})=>(typeof e=="number"&&(e=""+e),e!=null?Ke(e)||Le(e)||oe(e)?{i:xt,r:e,k:t,f:!!s}:e:null);function m(e,t=null,s=null,i=0,r=null,n=e===ye?0:1,o=!1,l=!1){const a={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&mh(t),ref:t&&er(t),scopeId:qa,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:i,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:xt};return l?(ko(a,s),n&128&&e.normalize(a)):s&&(a.shapeFlag|=Ke(s)?8:16),Di>0&&!o&&kt&&(a.patchFlag>0||n&6)&&a.patchFlag!==32&&kt.push(a),a}const $e=ld;function ld(e,t=null,s=null,i=0,r=null,n=!1){if((!e||e===Pu)&&(e=Cs),pr(e)){const l=Zs(e,t,!0);return s&&ko(l,s),Di>0&&!n&&kt&&(l.shapeFlag&6?kt[kt.indexOf(e)]=l:kt.push(l)),l.patchFlag=-2,l}if(vd(e)&&(e=e.__vccOpts),t){t=ad(t);let{class:l,style:a}=t;l&&!Ke(l)&&(t.class=Se(l)),Ee(a)&&(Tr(a)&&!ie(a)&&(a=at({},a)),t.style=Kt(a))}const o=Ke(e)?1:ph(e)?128:vu(e)?64:Ee(e)?4:oe(e)?2:0;return m(e,t,s,i,r,o,n,!0)}function ad(e){return e?Tr(e)||oh(e)?at({},e):e:null}function Zs(e,t,s=!1,i=!1){const{props:r,ref:n,patchFlag:o,children:l,transition:a}=e,h=t?hd(r||{},t):r,c={__v_isVNode:!0,__v_skip:!0,type:e.type,props:h,key:h&&mh(h),ref:t&&t.ref?s&&n?ie(n)?n.concat(er(t)):[n,er(t)]:er(t):n,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:l,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==ye?o===-1?16:o|16:o,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:a,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Zs(e.ssContent),ssFallback:e.ssFallback&&Zs(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return a&&i&&wo(c,a.clone(c)),c}function dt(e=" ",t=0){return $e(Or,null,e,t)}function vh(e,t){const s=$e(Zi,null,e);return s.staticCount=t,s}function Q(e="",t=!1){return t?(M(),Qi(Cs,null,e)):$e(Cs,null,e)}function zt(e){return e==null||typeof e=="boolean"?$e(Cs):ie(e)?$e(ye,null,e.slice()):pr(e)?vs(e):$e(Or,null,String(e))}function vs(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Zs(e)}function ko(e,t){let s=0;const{shapeFlag:i}=e;if(t==null)t=null;else if(ie(t))s=16;else if(typeof t=="object")if(i&65){const r=t.default;r&&(r._c&&(r._d=!1),ko(e,r()),r._c&&(r._d=!0));return}else{s=32;const r=t._;!r&&!oh(t)?t._ctx=xt:r===3&&xt&&(xt.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else oe(t)?(t={default:t,_ctx:xt},s=32):(t=String(t),i&64?(s=16,t=[dt(t)]):s=8);e.children=t,e.shapeFlag|=s}function hd(...e){const t={};for(let s=0;s<e.length;s++){const i=e[s];for(const r in i)if(r==="class")t.class!==i.class&&(t.class=Se([t.class,i.class]));else if(r==="style")t.style=Kt([t.style,i.style]);else if(Cr(r)){const n=t[r],o=i[r];o&&n!==o&&!(ie(n)&&n.includes(o))&&(t[r]=n?[].concat(n,o):o)}else r!==""&&(t[r]=i[r])}return t}function Nt(e,t,s,i=null){qt(e,t,7,[s,i])}const cd=sh();let ud=0;function dd(e,t,s){const i=e.type,r=(t?t.appContext:e.appContext)||cd,n={uid:ud++,vnode:e,type:i,parent:t,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new ka(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(r.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ah(i,r),emitsOptions:ih(i,r),emit:null,emitted:null,propsDefaults:Ce,inheritAttrs:i.inheritAttrs,ctx:Ce,data:Ce,props:Ce,attrs:Ce,slots:Ce,refs:Ce,setupState:Ce,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return n.ctx={_:n},n.root=t?t.root:n,n.emit=Ku.bind(null,n),e.ce&&e.ce(n),n}let lt=null;const Sh=()=>lt||xt;let gr,wn;{const e=Rr(),t=(s,i)=>{let r;return(r=e[s])||(r=e[s]=[]),r.push(i),n=>{r.length>1?r.forEach(o=>o(n)):r[0](n)}};gr=t("__VUE_INSTANCE_SETTERS__",s=>lt=s),wn=t("__VUE_SSR_SETTERS__",s=>Ti=s)}const Ni=e=>{const t=lt;return gr(e),e.scope.on(),()=>{e.scope.off(),gr(t)}},Qo=()=>{lt&&lt.scope.off(),gr(null)};function bh(e){return e.vnode.shapeFlag&4}let Ti=!1;function fd(e,t=!1,s=!1){t&&wn(t);const{props:i,children:r}=e.vnode,n=bh(e);Xu(e,i,n,t),Qu(e,r,s||t);const o=n?_d(e,t):void 0;return t&&wn(!1),o}function _d(e,t){const s=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Iu);const{setup:i}=s;if(i){rs();const r=e.setupContext=i.length>1?gd(e):null,n=Ni(e),o=Ai(i,e,0,[e.props,r]),l=va(o);if(ns(),n(),(l||e.sp)&&!wi(e)&&Ja(e),l){if(o.then(Qo,Qo),t)return o.then(a=>{el(e,a)}).catch(a=>{Pr(a,e,0)});e.asyncDep=o}else el(e,o)}else yh(e)}function el(e,t,s){oe(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:Ee(t)&&(e.setupState=za(t)),yh(e)}function yh(e,t,s){const i=e.type;e.render||(e.render=i.render||Vt);{const r=Ni(e);rs();try{Au(e)}finally{ns(),r()}}}const pd={get(e,t){return ot(e,"get",""),e[t]}};function gd(e){const t=s=>{e.exposed=s||{}};return{attrs:new Proxy(e.attrs,pd),slots:e.slots,emit:e.emit,expose:t}}function Nr(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(za(bo(e.exposed)),{get(t,s){if(s in t)return t[s];if(s in Ci)return Ci[s](e)},has(t,s){return s in t||s in Ci}})):e.proxy}function md(e,t=!0){return oe(e)?e.displayName||e.name:e.name||t&&e.__name}function vd(e){return oe(e)&&"__vccOpts"in e}const pe=(e,t)=>nu(e,t,Ti);function Xe(e,t,s){try{_r(-1);const i=arguments.length;return i===2?Ee(t)&&!ie(t)?pr(t)?$e(e,null,[t]):$e(e,t):$e(e,null,t):(i>3?s=Array.prototype.slice.call(arguments,2):i===3&&pr(s)&&(s=[s]),$e(e,t,s))}finally{_r(1)}}const Sd="3.5.26";/**
* @vue/runtime-dom v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Cn;const tl=typeof window<"u"&&window.trustedTypes;if(tl)try{Cn=tl.createPolicy("vue",{createHTML:e=>e})}catch{}const wh=Cn?e=>Cn.createHTML(e):e=>e,bd="http://www.w3.org/2000/svg",yd="http://www.w3.org/1998/Math/MathML",Qt=typeof document<"u"?document:null,sl=Qt&&Qt.createElement("template"),wd={insert:(e,t,s)=>{t.insertBefore(e,s||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,s,i)=>{const r=t==="svg"?Qt.createElementNS(bd,e):t==="mathml"?Qt.createElementNS(yd,e):s?Qt.createElement(e,{is:s}):Qt.createElement(e);return e==="select"&&i&&i.multiple!=null&&r.setAttribute("multiple",i.multiple),r},createText:e=>Qt.createTextNode(e),createComment:e=>Qt.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Qt.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,s,i,r,n){const o=s?s.previousSibling:t.lastChild;if(r&&(r===n||r.nextSibling))for(;t.insertBefore(r.cloneNode(!0),s),!(r===n||!(r=r.nextSibling)););else{sl.innerHTML=wh(i==="svg"?`<svg>${e}</svg>`:i==="mathml"?`<math>${e}</math>`:e);const l=sl.content;if(i==="svg"||i==="mathml"){const a=l.firstChild;for(;a.firstChild;)l.appendChild(a.firstChild);l.removeChild(a)}t.insertBefore(l,s)}return[o?o.nextSibling:t.firstChild,s?s.previousSibling:t.lastChild]}},Cd=Symbol("_vtc");function xd(e,t,s){const i=e[Cd];i&&(t=(t?[t,...i]:[...i]).join(" ")),t==null?e.removeAttribute("class"):s?e.setAttribute("class",t):e.className=t}const il=Symbol("_vod"),kd=Symbol("_vsh"),Ed=Symbol(""),Md=/(?:^|;)\s*display\s*:/;function Rd(e,t,s){const i=e.style,r=Ke(s);let n=!1;if(s&&!r){if(t)if(Ke(t))for(const o of t.split(";")){const l=o.slice(0,o.indexOf(":")).trim();s[l]==null&&tr(i,l,"")}else for(const o in t)s[o]==null&&tr(i,o,"");for(const o in s)o==="display"&&(n=!0),tr(i,o,s[o])}else if(r){if(t!==s){const o=i[Ed];o&&(s+=";"+o),i.cssText=s,n=Md.test(s)}}else t&&e.removeAttribute("style");il in e&&(e[il]=n?i.display:"",e[kd]&&(i.display="none"))}const rl=/\s*!important$/;function tr(e,t,s){if(ie(s))s.forEach(i=>tr(e,t,i));else if(s==null&&(s=""),t.startsWith("--"))e.setProperty(t,s);else{const i=Bd(e,t);rl.test(s)?e.setProperty(ks(i),s.replace(rl,""),"important"):e[i]=s}}const nl=["Webkit","Moz","ms"],Gr={};function Bd(e,t){const s=Gr[t];if(s)return s;let i=Pt(t);if(i!=="filter"&&i in e)return Gr[t]=i;i=Mr(i);for(let r=0;r<nl.length;r++){const n=nl[r]+i;if(n in e)return Gr[t]=n}return t}const ol="http://www.w3.org/1999/xlink";function ll(e,t,s,i,r,n=Dc(t)){i&&t.startsWith("xlink:")?s==null?e.removeAttributeNS(ol,t.slice(6,t.length)):e.setAttributeNS(ol,t,s):s==null||n&&!wa(s)?e.removeAttribute(t):e.setAttribute(t,n?"":xs(s)?String(s):s)}function al(e,t,s,i,r){if(t==="innerHTML"||t==="textContent"){s!=null&&(e[t]=t==="innerHTML"?wh(s):s);return}const n=e.tagName;if(t==="value"&&n!=="PROGRESS"&&!n.includes("-")){const l=n==="OPTION"?e.getAttribute("value")||"":e.value,a=s==null?e.type==="checkbox"?"on":"":String(s);(l!==a||!("_value"in e))&&(e.value=a),s==null&&e.removeAttribute(t),e._value=s;return}let o=!1;if(s===""||s==null){const l=typeof e[t];l==="boolean"?s=wa(s):s==null&&l==="string"?(s="",o=!0):l==="number"&&(s=0,o=!0)}try{e[t]=s}catch{}o&&e.removeAttribute(r||t)}function Vs(e,t,s,i){e.addEventListener(t,s,i)}function Dd(e,t,s,i){e.removeEventListener(t,s,i)}const hl=Symbol("_vei");function Td(e,t,s,i,r=null){const n=e[hl]||(e[hl]={}),o=n[t];if(i&&o)o.value=i;else{const[l,a]=Pd(t);if(i){const h=n[t]=Ad(i,r);Vs(e,l,h,a)}else o&&(Dd(e,l,o,a),n[t]=void 0)}}const cl=/(?:Once|Passive|Capture)$/;function Pd(e){let t;if(cl.test(e)){t={};let i;for(;i=e.match(cl);)e=e.slice(0,e.length-i[0].length),t[i[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):ks(e.slice(2)),t]}let Jr=0;const Ld=Promise.resolve(),Id=()=>Jr||(Ld.then(()=>Jr=0),Jr=Date.now());function Ad(e,t){const s=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=s.attached)return;qt(Od(i,s.value),t,5,[i])};return s.value=e,s.attached=Id(),s}function Od(e,t){if(ie(t)){const s=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{s.call(e),e._stopped=!0},t.map(i=>r=>!r._stopped&&i&&i(r))}else return t}const ul=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,Nd=(e,t,s,i,r,n)=>{const o=r==="svg";t==="class"?xd(e,i,o):t==="style"?Rd(e,s,i):Cr(t)?co(t)||Td(e,t,s,i,n):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):$d(e,t,i,o))?(al(e,t,i),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&ll(e,t,i,o,n,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!Ke(i))?al(e,Pt(t),i,n,t):(t==="true-value"?e._trueValue=i:t==="false-value"&&(e._falseValue=i),ll(e,t,i,o))};function $d(e,t,s,i){if(i)return!!(t==="innerHTML"||t==="textContent"||t in e&&ul(t)&&oe(s));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="sandbox"&&e.tagName==="IFRAME"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const r=e.tagName;if(r==="IMG"||r==="VIDEO"||r==="CANVAS"||r==="SOURCE")return!1}return ul(t)&&Ke(s)?!1:t in e}const dl=e=>{const t=e.props["onUpdate:modelValue"]||!1;return ie(t)?s=>Ji(t,s):t};function Hd(e){e.target.composing=!0}function fl(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Zr=Symbol("_assign");function _l(e,t,s){return t&&(e=e.trim()),s&&(e=fo(e)),e}const Ch={created(e,{modifiers:{lazy:t,trim:s,number:i}},r){e[Zr]=dl(r);const n=i||r.props&&r.props.type==="number";Vs(e,t?"change":"input",o=>{o.target.composing||e[Zr](_l(e.value,s,n))}),(s||n)&&Vs(e,"change",()=>{e.value=_l(e.value,s,n)}),t||(Vs(e,"compositionstart",Hd),Vs(e,"compositionend",fl),Vs(e,"change",fl))},mounted(e,{value:t}){e.value=t??""},beforeUpdate(e,{value:t,oldValue:s,modifiers:{lazy:i,trim:r,number:n}},o){if(e[Zr]=dl(o),e.composing)return;const l=(n||e.type==="number")&&!/^0\d/.test(e.value)?fo(e.value):e.value,a=t??"";l!==a&&(document.activeElement===e&&e.type!=="range"&&(i&&t===s||r&&e.value.trim()===a)||(e.value=a))}},Wd=["ctrl","shift","alt","meta"],Fd={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Wd.some(s=>e[`${s}Key`]&&!t.includes(s))},ui=(e,t)=>{const s=e._withMods||(e._withMods={}),i=t.join(".");return s[i]||(s[i]=((r,...n)=>{for(let o=0;o<t.length;o++){const l=Fd[t[o]];if(l&&l(r,t))return}return e(r,...n)}))},zd={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},pl=(e,t)=>{const s=e._withKeys||(e._withKeys={}),i=t.join(".");return s[i]||(s[i]=(r=>{if(!("key"in r))return;const n=ks(r.key);if(t.some(o=>o===n||zd[o]===n))return e(r)}))},Kd=at({patchProp:Nd},wd);let gl;function Ud(){return gl||(gl=td(Kd))}const Vd=((...e)=>{const t=Ud().createApp(...e),{mount:s}=t;return t.mount=i=>{const r=qd(i);if(!r)return;const n=t._component;!oe(n)&&!n.render&&!n.template&&(n.template=r.innerHTML),r.nodeType===1&&(r.textContent="");const o=s(r,!1,jd(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),o},t});function jd(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function qd(e){return Ke(e)?document.querySelector(e):e}/*!
 * pinia v2.3.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let xh;const $r=e=>xh=e,kh=Symbol();function xn(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var ki;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(ki||(ki={}));function Yd(){const e=Ea(!0),t=e.run(()=>fe({}));let s=[],i=[];const r=bo({install(n){$r(r),r._a=n,n.provide(kh,r),n.config.globalProperties.$pinia=r,i.forEach(o=>s.push(o)),i=[]},use(n){return this._a?s.push(n):i.push(n),this},_p:s,_a:null,_e:e,_s:new Map,state:t});return r}const Eh=()=>{};function ml(e,t,s,i=Eh){e.push(t);const r=()=>{const n=e.indexOf(t);n>-1&&(e.splice(n,1),i())};return!s&&Ma()&&Tc(r),r}function Fs(e,...t){e.slice().forEach(s=>{s(...t)})}const Xd=e=>e(),vl=Symbol(),Qr=Symbol();function kn(e,t){e instanceof Map&&t instanceof Map?t.forEach((s,i)=>e.set(i,s)):e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const s in t){if(!t.hasOwnProperty(s))continue;const i=t[s],r=e[s];xn(r)&&xn(i)&&e.hasOwnProperty(s)&&!Le(i)&&!is(i)?e[s]=kn(r,i):e[s]=i}return e}const Gd=Symbol();function Jd(e){return!xn(e)||!e.hasOwnProperty(Gd)}const{assign:ps}=Object;function Zd(e){return!!(Le(e)&&e.effect)}function Qd(e,t,s,i){const{state:r,actions:n,getters:o}=t,l=s.state.value[e];let a;function h(){l||(s.state.value[e]=r?r():{});const c=tu(s.state.value[e]);return ps(c,n,Object.keys(o||{}).reduce((u,d)=>(u[d]=bo(pe(()=>{$r(s);const _=s._s.get(e);return o[d].call(_,_)})),u),{}))}return a=Mh(e,h,t,s,i,!0),a}function Mh(e,t,s={},i,r,n){let o;const l=ps({actions:{}},s),a={deep:!0};let h,c,u=[],d=[],_;const p=i.state.value[e];!n&&!p&&(i.state.value[e]={}),fe({});let f;function v(X){let Z;h=c=!1,typeof X=="function"?(X(i.state.value[e]),Z={type:ki.patchFunction,storeId:e,events:_}):(kn(i.state.value[e],X),Z={type:ki.patchObject,payload:X,storeId:e,events:_});const ge=f=Symbol();Js().then(()=>{f===ge&&(h=!0)}),c=!0,Fs(u,Z,i.state.value[e])}const S=n?function(){const{state:Z}=s,ge=Z?Z():{};this.$patch(ne=>{ps(ne,ge)})}:Eh;function C(){o.stop(),u=[],d=[],i._s.delete(e)}const I=(X,Z="")=>{if(vl in X)return X[Qr]=Z,X;const ge=function(){$r(i);const ne=Array.from(arguments),N=[],E=[];function O(F){N.push(F)}function U(F){E.push(F)}Fs(d,{args:ne,name:ge[Qr],store:$,after:O,onError:U});let H;try{H=X.apply(this&&this.$id===e?this:$,ne)}catch(F){throw Fs(E,F),F}return H instanceof Promise?H.then(F=>(Fs(N,F),F)).catch(F=>(Fs(E,F),Promise.reject(F))):(Fs(N,H),H)};return ge[vl]=!0,ge[Qr]=Z,ge},w={_p:i,$id:e,$onAction:ml.bind(null,d),$patch:v,$reset:S,$subscribe(X,Z={}){const ge=ml(u,X,Z.detached,()=>ne()),ne=o.run(()=>Is(()=>i.state.value[e],N=>{(Z.flush==="sync"?c:h)&&X({storeId:e,type:ki.direct,events:_},N)},ps({},a,Z)));return ge},$dispose:C},$=Dr(w);i._s.set(e,$);const re=(i._a&&i._a.runWithContext||Xd)(()=>i._e.run(()=>(o=Ea()).run(()=>t({action:I}))));for(const X in re){const Z=re[X];if(Le(Z)&&!Zd(Z)||is(Z))n||(p&&Jd(Z)&&(Le(Z)?Z.value=p[X]:kn(Z,p[X])),i.state.value[e][X]=Z);else if(typeof Z=="function"){const ge=I(Z,X);re[X]=ge,l.actions[X]=Z}}return ps($,re),ps(ve($),re),Object.defineProperty($,"$state",{get:()=>i.state.value[e],set:X=>{v(Z=>{ps(Z,X)})}}),i._p.forEach(X=>{ps($,o.run(()=>X({store:$,app:i._a,pinia:i,options:l})))}),p&&n&&s.hydrate&&s.hydrate($.$state,p),h=!0,c=!0,$}/*! #__NO_SIDE_EFFECTS__ */function ef(e,t,s){let i,r;const n=typeof t=="function";i=e,r=n?s:t;function o(l,a){const h=fu();return l=l||(h?bi(kh,null):null),l&&$r(l),l=xh,l._s.has(i)||(n?Mh(i,t,r,l):Qd(i,r,l)),l._s.get(i)}return o.$id=i,o}const tf="/logo.png",as=ef("monitor",()=>{const e=fe("disconnected"),t=fe(null),s=fe(0),i=5,r=2e3,n=fe([]),o=fe([]),l=fe(null),a=fe("local"),h=fe(!0),c=fe(!1),u=fe(!1),d=fe(!1),_=fe(new Set),p=fe(new Map),f=fe(new Set),v=fe([]),S=fe(null),C=fe(new Map),I=fe(null),w=fe({eventTypes:[],sessionIds:[],searchQuery:"",timeRange:{start:null,end:null}}),$=pe(()=>l.value&&n.value.find(y=>y.sessionId===l.value)||null),J=pe(()=>{let y=[...o.value];if(l.value&&(y=y.filter(R=>R.sessionId===l.value)),w.value.eventTypes.length>0&&(y=y.filter(R=>w.value.eventTypes.includes(R.eventType))),w.value.searchQuery){const R=w.value.searchQuery.toLowerCase();y=y.filter(ae=>[ae.eventType,ae.data.toolName,ae.data.message,JSON.stringify(ae.data.toolInput)].filter(Boolean).join(" ").toLowerCase().includes(R))}return w.value.timeRange.start&&(y=y.filter(R=>R.timestamp>=w.value.timeRange.start)),w.value.timeRange.end&&(y=y.filter(R=>R.timestamp<=w.value.timeRange.end)),y.sort((R,ae)=>R.timestamp-ae.timestamp)}),re=pe(()=>n.value.filter(y=>y.status==="active"));function X(y,R){const ae=R.find(me=>me.sessionId===y);if(!ae)return!1;for(const me of ae.childSessionIds){const Be=R.find(Ue=>Ue.sessionId===me);if((Be==null?void 0:Be.status)==="active"||X(me,R))return!0}return!1}const Z=pe(()=>{let y=n.value;c.value||(y=y.filter(ue=>!_.value.has(ue.sessionId))),u.value&&(y=y.filter(ue=>ue.status!=="active"));const R=new Set(y.map(ue=>ue.sessionId)),ae=y.filter(ue=>!ue.parentSessionId||!R.has(ue.parentSessionId)),me=new Map;y.forEach(ue=>{if(ue.parentSessionId&&R.has(ue.parentSessionId)){const le=me.get(ue.parentSessionId)||[];le.push(ue),me.set(ue.parentSessionId,le)}});const Be=ae.filter(ue=>ue.isPinned===!0||ue.isUserInitiated===!0||ue.isUserInitiated===void 0&&!ue.parentSessionId||ue.status==="active"||X(ue.sessionId,y));Be.sort((ue,le)=>ue.status==="active"&&le.status!=="active"?-1:le.status==="active"&&ue.status!=="active"?1:le.startTime-ue.startTime);const Ue=new Set(Be.map(ue=>ue.sessionId)),Lt=ae.filter(ue=>!Ue.has(ue.sessionId));return{rootSessions:ae,primarySessions:Be,otherSessions:Lt,childMap:me}}),ge=pe(()=>o.value.filter(y=>y.eventType==="tool_call"||y.eventType==="tool_result")),ne=pe(()=>{const y={input:0,output:0,cacheRead:0,cacheWrite:0};return n.value.forEach(R=>{var ae,me,Be,Ue;y.input+=((ae=R.tokenUsage)==null?void 0:ae.totalInput)||0,y.output+=((me=R.tokenUsage)==null?void 0:me.totalOutput)||0,y.cacheRead+=((Be=R.tokenUsage)==null?void 0:Be.totalCacheRead)||0,y.cacheWrite+=((Ue=R.tokenUsage)==null?void 0:Ue.totalCacheCreation)||0}),y});function N(){var R;if(((R=t.value)==null?void 0:R.readyState)===WebSocket.OPEN)return;e.value="connecting";const y=`ws://${window.location.hostname}:3848`;t.value=new WebSocket(y),t.value.onopen=()=>{e.value="connected",s.value=0,O({type:"subscribe"}),O({type:"get_sessions"}),O({type:"get_all_recent_events",limit:200})},t.value.onmessage=ae=>{try{const me=JSON.parse(ae.data);U(me)}catch(me){console.error("Failed to parse WebSocket message:",me)}},t.value.onclose=()=>{e.value="disconnected",t.value=null,s.value<i&&(s.value++,setTimeout(N,r*s.value))},t.value.onerror=ae=>{console.error("WebSocket error:",ae)}}function E(){t.value&&(t.value.close(),t.value=null),e.value="disconnected"}function O(y){var R;((R=t.value)==null?void 0:R.readyState)===WebSocket.OPEN&&t.value.send(JSON.stringify(y))}function U(y){switch(y.type){case"sessions":n.value=y.sessions;break;case"session_update":const R=n.value.findIndex(le=>le.sessionId===y.session.sessionId);R>=0?n.value[R]=y.session:n.value.push(y.session);break;case"event":console.log(`[Monitor] Received real-time event: ${y.event.eventType} (session: ${y.event.sessionId})`),o.value.push(y.event),o.value.length>1e3&&(o.value=o.value.slice(-1e3));break;case"events":const ae=new Set(o.value.map(le=>le.id)),me=y.events.filter(le=>!ae.has(le.id));o.value=[...o.value,...me].sort((le,vt)=>le.timestamp-vt.timestamp);break;case"all_events":console.log(`[Monitor] Received ${y.events.length} events from get_all_recent_events`);const Be=new Set(o.value.map(le=>le.id)),Ue=y.events.filter(le=>!Be.has(le.id));o.value=[...o.value,...Ue].sort((le,vt)=>le.timestamp-vt.timestamp),console.log(`[Monitor] Total events now: ${o.value.length}`);break;case"event_detail":p.value.set(y.event.id,y.event),f.value.delete(y.event.id);break;case"sessions_updated":n.value=y.sessions;break;case"error":console.error("Server error:",y.message);break;case"wrappers":v.value=y.wrappers;break;case"wrapper_connected":console.log(`[Monitor] Wrapper connected: ${y.wrapperId}`),v.value.push({wrapperId:y.wrapperId,state:y.state,claudeSessionId:null}),C.value.set(y.wrapperId,[]);break;case"wrapper_disconnected":console.log(`[Monitor] Wrapper disconnected: ${y.wrapperId}`),v.value=v.value.filter(le=>le.wrapperId!==y.wrapperId),C.value.delete(y.wrapperId),S.value===y.wrapperId&&(S.value=null);break;case"wrapper_state":console.log(`[Monitor] Wrapper ${y.wrapperId} state: ${y.state}`);const Lt=v.value.findIndex(le=>le.wrapperId===y.wrapperId);Lt>=0&&(v.value[Lt].state=y.state,y.claudeSessionId&&(v.value[Lt].claudeSessionId=y.claudeSessionId));break;case"wrapper_output":const ue=C.value.get(y.wrapperId);if(ue){const le=y.data;ue.push(le),ue.length>500&&ue.splice(0,ue.length-500),I.value={wrapperId:y.wrapperId,data:le}}break}}function H(y){l.value=y,y&&O({type:"get_events",sessionId:y,limit:500})}function F(y,R){w.value[y]=R}function P(y){const R=w.value.eventTypes.indexOf(y);R>=0?w.value.eventTypes.splice(R,1):w.value.eventTypes.push(y)}function _e(){w.value={eventTypes:[],sessionIds:[],searchQuery:"",timeRange:{start:null,end:null}}}function Me(y){h.value=y}function He(){o.value=[]}function Ae(y){_.value.add(y),O({type:"hide_session",sessionId:y})}function tt(y){n.value=n.value.filter(R=>R.sessionId!==y),o.value=o.value.filter(R=>R.sessionId!==y),_.value.delete(y),l.value===y&&(l.value=null),O({type:"delete_session",sessionId:y})}function Ye(){Z.value.rootSessions.map(R=>R.sessionId).forEach(R=>_.value.add(R)),O({type:"hide_all_sessions"})}function gt(){const y=Z.value.rootSessions.map(R=>R.sessionId);n.value=n.value.filter(R=>!y.includes(R.sessionId)),o.value=o.value.filter(R=>!y.includes(R.sessionId)),y.forEach(R=>_.value.delete(R)),l.value=null,O({type:"delete_all_sessions"})}function We(y){_.value.delete(y),O({type:"unhide_session",sessionId:y})}function mt(){c.value=!c.value}function Gt(){u.value=!u.value}function bt(y){d.value=y}function Mt(y,R){O({type:"set_parent",sessionId:y,parentSessionId:R})}function us(y){O({type:"toggle_pin",sessionId:y})}function g(y,R){O({type:"set_user_initiated",sessionId:y,isUserInitiated:R})}function b(y,R){O({type:"rename_session",sessionId:y,label:R})}const x=fe(null);function A(y){x.value=y}function D(y,R){p.value.has(R)||f.value.has(R)||(f.value.add(R),O({type:"get_event_detail",sessionId:y,eventId:R}))}function T(y){return p.value.get(y)}function V(y){S.value=y}function K(y,R){O({type:"inject_input",wrapperId:y,input:R})}function z(y,R,ae){O({type:"resize_wrapper",wrapperId:y,cols:R,rows:ae})}function L(y){const R=C.value.get(y);return R?R.join(""):""}function ee(y){const R=C.value.get(y);return R?R.join(""):""}function q(y){const R=C.value.get(y);return R?[...R]:[]}const G=pe(()=>S.value&&v.value.find(y=>y.wrapperId===S.value)||null),te=pe(()=>v.value.filter(y=>y.state!=="ended")),de=pe(()=>v.value.filter(y=>y.state==="waiting_input"));return{connectionStatus:e,sessions:n,events:o,selectedSessionId:l,mode:a,autoScroll:h,filters:w,showHidden:c,showInactiveOnly:u,ctrlPressed:d,hiddenSessionIds:_,draggedSessionId:x,eventDetails:p,loadingDetails:f,wrappers:v,selectedWrapperId:S,wrapperOutputBuffers:C,selectedSession:$,filteredEvents:J,activeSessions:re,sessionHierarchy:Z,toolEvents:ge,tokenTotals:ne,selectedWrapper:G,activeWrappers:te,wrappersWaitingInput:de,connect:N,disconnect:E,send:O,selectSession:H,setFilter:F,toggleEventTypeFilter:P,clearFilters:_e,setAutoScroll:Me,clearEvents:He,hideSession:Ae,deleteSession:tt,hideAllSessions:Ye,deleteAllSessions:gt,unhideSession:We,toggleShowHidden:mt,toggleShowInactive:Gt,setCtrlPressed:bt,setSessionParent:Mt,toggleSessionPin:us,setUserInitiated:g,renameSession:b,setDraggedSession:A,requestEventDetail:D,getEventDetail:T,selectWrapper:V,injectInput:K,resizeWrapper:z,getWrapperOutput:L,getRawWrapperOutput:ee,getWrapperOutputChunks:q,lastWrapperOutput:I}}),sf={class:"px-3 py-2 border-b border-slate-700 text-xs text-monitor-text-muted"},rf={class:"text-monitor-text-primary font-medium"},nf={key:0,class:"ml-2 text-monitor-accent-purple"},of={key:1,class:"ml-2 text-monitor-accent-cyan"},lf={key:0,class:"px-3 py-2 border-b border-slate-700"},af={class:"flex items-center space-x-2"},hf={key:0,class:"ml-auto text-xs text-monitor-text-muted"},cf={key:2,class:"border-t border-slate-700 my-1"},uf={key:5,class:"border-t border-slate-700 my-1"},df={key:6,class:"relative group"},ff={class:"absolute left-full top-0 ml-1 bg-slate-800 border border-slate-600 rounded-lg shadow-xl py-1 min-w-48 hidden group-hover:block max-h-64 overflow-y-auto"},_f=["onClick"],pf={key:0,class:"ml-1 text-xs text-monitor-accent-purple"},gf={key:1,class:"ml-1 text-xs text-monitor-accent-cyan"},mf={key:0,class:"px-3 py-2 text-sm text-monitor-text-muted italic"},vf=Xt({__name:"ContextMenu",props:{x:{},y:{},session:{},allSessions:{}},emits:["close","setParent","togglePin","setUserInitiated","rename"],setup(e,{emit:t}){const s=e,i=t,r=fe(!1),n=fe(""),o=fe(null);function l(){n.value=s.session.label||"",r.value=!0,Js(()=>{var p,f;(p=o.value)==null||p.focus(),(f=o.value)==null||f.select()})}function a(){i("rename",s.session.sessionId,n.value),i("close")}function h(){r.value=!1,n.value=""}function c(p,f){const v=s.allSessions.find(S=>S.sessionId===p);return v?v.parentSessionId===f?!0:v.parentSessionId?c(v.parentSessionId,f):!1:!1}const u=pe(()=>s.allSessions.filter(p=>p.sessionId!==s.session.sessionId&&!c(p.sessionId,s.session.sessionId)&&!s.session.childSessionIds.includes(p.sessionId)).sort((p,f)=>f.startTime-p.startTime));function d(p){i("close")}function _(p){p.key==="Escape"&&i("close")}return Ir(()=>{setTimeout(()=>{document.addEventListener("click",d),document.addEventListener("keydown",_)},10)}),Oi(()=>{document.removeEventListener("click",d),document.removeEventListener("keydown",_)}),(p,f)=>(M(),B("div",{class:"fixed bg-slate-800 border border-slate-600 rounded-lg shadow-xl py-1 min-w-52 z-50",style:Kt({left:e.x+"px",top:e.y+"px"}),onClick:f[4]||(f[4]=ui(()=>{},["stop"]))},[m("div",sf,[m("span",rf,j(e.session.sessionId.slice(0,8)),1),e.session.agentType?(M(),B("span",nf,"("+j(e.session.agentType)+")",1)):Q("",!0),e.session.label?(M(),B("span",of,'"'+j(e.session.label)+'"',1)):Q("",!0)]),r.value?(M(),B("div",lf,[m("div",af,[Ya(m("input",{ref_key:"renameInputRef",ref:o,"onUpdate:modelValue":f[0]||(f[0]=v=>n.value=v),type:"text",class:"flex-1 px-2 py-1 text-sm bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-1 focus:ring-monitor-accent-cyan",placeholder:"Enter label (empty to clear)",onKeydown:[pl(a,["enter"]),pl(h,["escape"])]},null,544),[[Ch,n.value]]),m("button",{class:"px-2 py-1 text-xs bg-monitor-accent-cyan text-slate-900 rounded hover:bg-cyan-400 transition-colors",onClick:a}," OK "),m("button",{class:"px-2 py-1 text-xs bg-slate-600 text-white rounded hover:bg-slate-500 transition-colors",onClick:h}," Cancel ")])])):Q("",!0),r.value?Q("",!0):(M(),B("button",{key:1,class:"w-full px-3 py-2 text-left text-sm hover:bg-slate-700 flex items-center",onClick:l},[f[5]||(f[5]=m("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)),f[6]||(f[6]=m("span",null,"Rename",-1)),e.session.label?(M(),B("span",hf,' "'+j(e.session.label)+'" ',1)):Q("",!0)])),r.value?Q("",!0):(M(),B("div",cf)),r.value?Q("",!0):(M(),B("button",{key:3,class:"w-full px-3 py-2 text-left text-sm hover:bg-slate-700 flex items-center",onClick:f[1]||(f[1]=v=>{i("togglePin",e.session.sessionId),i("close")})},[f[7]||(f[7]=m("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[m("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})],-1)),m("span",{class:Se(e.session.isPinned?"text-monitor-accent-cyan":"")},j(e.session.isPinned?"Unpin Session":"Pin to Top"),3)])),r.value?Q("",!0):(M(),B("button",{key:4,class:"w-full px-3 py-2 text-left text-sm hover:bg-slate-700 flex items-center",onClick:f[2]||(f[2]=v=>{i("setUserInitiated",e.session.sessionId,!e.session.isUserInitiated),i("close")})},[f[8]||(f[8]=m("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),m("span",{class:Se(e.session.isUserInitiated?"text-monitor-accent-cyan":"")},j(e.session.isUserInitiated?"Mark as Sub-Agent":"Mark as Primary"),3)])),r.value?Q("",!0):(M(),B("div",uf)),r.value?Q("",!0):(M(),B("div",df,[f[11]||(f[11]=vh('<button class="w-full px-3 py-2 text-left text-sm hover:bg-slate-700 flex items-center justify-between"><span class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg> Set Parent </span><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>',1)),m("div",ff,[m("button",{class:Se(["w-full px-3 py-2 text-left text-sm hover:bg-slate-700 text-monitor-text-muted flex items-center",{"text-monitor-accent-cyan":!e.session.parentSessionId}]),onClick:f[3]||(f[3]=v=>{i("setParent",e.session.sessionId,null),i("close")})},[...f[9]||(f[9]=[m("svg",{class:"w-3 h-3 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),dt(" (No Parent - Root) ",-1)])],2),f[10]||(f[10]=m("div",{class:"border-t border-slate-700 my-1"},null,-1)),(M(!0),B(ye,null,ft(u.value,v=>(M(),B("button",{key:v.sessionId,class:Se(["w-full px-3 py-2 text-left text-sm hover:bg-slate-700 flex items-center",{"text-monitor-accent-cyan":e.session.parentSessionId===v.sessionId}]),onClick:S=>{i("setParent",e.session.sessionId,v.sessionId),i("close")}},[m("span",{class:Se(["w-2 h-2 rounded-full mr-2",{"bg-green-500":v.status==="active","bg-gray-500":v.status==="completed","bg-red-500":v.status==="error"}])},null,2),m("span",null,j(v.sessionId.slice(0,8)),1),v.agentType?(M(),B("span",pf," ("+j(v.agentType)+") ",1)):Q("",!0),v.isUserInitiated?(M(),B("span",gf," (primary) ")):Q("",!0)],10,_f))),128)),u.value.length===0?(M(),B("div",mf," No eligible parents ")):Q("",!0)])]))],4))}}),Rh=Xt({name:"SessionChild",props:{session:{type:Object,required:!0},depth:{type:Number,required:!0},getChildSessions:{type:Function,required:!0},getTotalChildCount:{type:Function,required:!0},isExpanded:{type:Function,required:!0},toggleExpand:{type:Function,required:!0},selectSession:{type:Function,required:!0},selectedId:{type:String,default:null},formatDuration:{type:Function,required:!0},onContextMenu:{type:Function,required:!0}},render(){const{session:e,depth:t,getChildSessions:s,getTotalChildCount:i,isExpanded:r,toggleExpand:n,selectSession:o,selectedId:l,formatDuration:a,onContextMenu:h}=this,c=i(e.sessionId),u=s(e.sessionId),d=r(e.sessionId);as();const _=["rounded-lg cursor-pointer transition-all duration-200 border-l-4 relative group mb-1",l===e.sessionId?"bg-slate-700 border-l-monitor-accent-purple ring-1 ring-monitor-accent-purple/30":"bg-monitor-bg-tertiary hover:bg-slate-700/50 border-l-monitor-accent-purple/50"];return Xe("div",{class:"ml-3"},[Xe("div",{class:_,onClick:()=>o(e.sessionId),onContextmenu:p=>{p.preventDefault(),h(e,p)}},[Xe("div",{class:"p-2"},[Xe("div",{class:"flex items-center justify-between"},[Xe("div",{class:"flex items-center space-x-2"},[c>0?Xe("button",{class:"w-4 h-4 flex items-center justify-center rounded hover:bg-slate-600 transition-colors",onClick:p=>{p.stopPropagation(),n(e.sessionId,p)}},[Xe("svg",{class:["w-2.5 h-2.5 transition-transform text-monitor-text-muted",d?"rotate-90":""],fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[Xe("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])]):Xe("span",{class:"w-4"}),Xe("svg",{class:"w-3 h-3 text-monitor-accent-purple",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[Xe("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),Xe("span",{class:["w-1.5 h-1.5 rounded-full",e.status==="active"?"bg-purple-400 animate-pulse-dot":"",e.status==="completed"?"bg-gray-500":"",e.status==="error"?"bg-red-500":""]}),e.label?Xe("span",{class:"text-xs font-medium text-monitor-accent-cyan"},e.label):Xe("span",{class:"text-xs font-medium text-monitor-text-secondary"},e.sessionId.slice(0,8)),e.agentType?Xe("span",{class:"px-1 py-0.5 text-xs rounded bg-monitor-accent-purple/20 text-monitor-accent-purple"},e.agentType):null,c>0?Xe("span",{class:"px-1 py-0.5 text-xs rounded bg-slate-600 text-monitor-text-muted"},`+${c}`):null]),Xe("span",{class:"text-xs text-monitor-text-muted"},a(e.startTime,e.endTime))])])]),d?u.map(p=>Xe(Rh,{key:p.sessionId,session:p,depth:t+1,getChildSessions:s,getTotalChildCount:i,isExpanded:r,toggleExpand:n,selectSession:o,selectedId:l,formatDuration:a,onContextMenu:h})):null])}}),Sf=Xt({name:"SessionList",components:{SessionChild:Rh,ContextMenu:vf},setup(){const e=as(),t=fe({visible:!1,x:0,y:0,session:null});function s(f,v){t.value={visible:!0,x:v.clientX,y:v.clientY,session:f}}function i(){t.value.visible=!1,t.value.session=null}function r(){e.ctrlPressed?e.deleteAllSessions():e.hideAllSessions()}const n=fe(new Set),o=pe(()=>e.sessionHierarchy),l=pe(()=>e.selectedSessionId);function a(f){return o.value.childMap.get(f)||[]}function h(f){const v=a(f);let S=v.length;for(const C of v)S+=h(C.sessionId);return S}function c(f){return n.value.has(f)}function u(f,v){v.stopPropagation(),n.value.has(f)?n.value.delete(f):n.value.add(f)}function d(f,v){const S=(v||Date.now())-f,C=Math.floor(S/1e3),I=Math.floor(C/60),w=Math.floor(I/60);return w>0?`${w}h ${I%60}m`:I>0?`${I}m ${C%60}s`:`${C}s`}function _(f,v=30){if(f.length<=v)return f;const S=f.split("/");return S.length<=2?f.slice(-v):".../"+S.slice(-2).join("/")}function p(f){l.value===f?e.selectSession(null):(e.selectSession(f),n.value.add(f))}return{store:e,hierarchy:o,selectedId:l,contextMenu:t,getChildSessions:a,getTotalChildCount:h,isExpanded:c,toggleExpand:u,formatDuration:d,truncatePath:_,selectSession:p,handleClearAll:r,showContextMenu:s,closeContextMenu:i}}}),Bh=(e,t)=>{const s=e.__vccOpts||e;for(const[i,r]of t)s[i]=r;return s},bf={class:"flex flex-col h-full"},yf={class:"px-3 py-2 border-b border-slate-700 space-y-2"},wf=["title"],Cf={class:"flex items-center justify-between text-xs"},xf={class:"flex items-center space-x-2 cursor-pointer"},kf=["checked"],Ef={class:"flex items-center space-x-2 cursor-pointer"},Mf=["checked"],Rf={class:"flex-1 overflow-y-auto"},Bf={key:0,class:"p-2 border-b border-slate-600"},Df={class:"space-y-1"},Tf=["onClick","onContextmenu"],Pf={key:0,class:"absolute -top-1 -right-1 w-4 h-4 bg-monitor-accent-cyan rounded-full flex items-center justify-center shadow"},Lf={class:"p-3"},If={class:"flex items-center justify-between mb-2"},Af={class:"flex items-center space-x-2"},Of=["onClick"],Nf={key:1,class:"w-5"},$f={key:2,class:"text-sm font-medium text-monitor-accent-cyan"},Hf={key:3,class:"text-sm font-medium text-monitor-text-primary"},Wf={key:4,class:"px-1.5 py-0.5 text-xs rounded-full bg-monitor-accent-purple/20 text-monitor-accent-purple"},Ff={class:"text-xs text-monitor-text-muted"},zf={class:"text-xs text-monitor-text-muted pl-7"},Kf={class:"flex items-center"},Uf={key:1,class:"p-2"},Vf={class:"space-y-1"},jf=["onClick","onContextmenu"],qf={class:"p-2"},Yf={class:"flex items-center justify-between"},Xf={class:"flex items-center space-x-2"},Gf=["onClick"],Jf={key:1,class:"w-4"},Zf={key:2,class:"text-xs text-monitor-accent-cyan"},Qf={key:3,class:"text-xs text-monitor-text-secondary"},e_={key:4,class:"px-1 py-0.5 text-xs rounded bg-slate-600 text-monitor-text-muted"},t_={class:"text-xs text-monitor-text-muted"},s_={key:2,class:"text-monitor-text-muted text-sm p-4 text-center"};function i_(e,t,s,i,r,n){const o=Ko("SessionChild"),l=Ko("ContextMenu");return M(),B("div",bf,[m("div",yf,[m("button",{onClick:t[0]||(t[0]=(...a)=>e.handleClearAll&&e.handleClearAll(...a)),class:Se(["w-full px-3 py-1.5 text-xs font-medium rounded transition-colors",e.store.ctrlPressed?"bg-red-600 hover:bg-red-700 text-white":"bg-slate-600 hover:bg-slate-700 text-white"]),title:e.store.ctrlPressed?"Delete All Sessions (Ctrl held)":"Hide All Sessions"},j(e.store.ctrlPressed?"Delete All":"Hide All"),11,wf),m("div",Cf,[m("label",xf,[m("input",{type:"checkbox",checked:e.store.showHidden,onChange:t[1]||(t[1]=a=>e.store.toggleShowHidden()),class:"w-3 h-3 rounded bg-slate-700 border-slate-600 text-monitor-accent-cyan focus:ring-monitor-accent-cyan focus:ring-offset-0"},null,40,kf),t[7]||(t[7]=m("span",{class:"text-monitor-text-secondary"},"Show Hidden",-1))]),m("label",Ef,[m("input",{type:"checkbox",checked:e.store.showInactiveOnly,onChange:t[2]||(t[2]=a=>e.store.toggleShowInactive()),class:"w-3 h-3 rounded bg-slate-700 border-slate-600 text-monitor-accent-cyan focus:ring-monitor-accent-cyan focus:ring-offset-0"},null,40,Mf),t[8]||(t[8]=m("span",{class:"text-monitor-text-secondary"},"Inactive Only",-1))])])]),m("div",Rf,[e.hierarchy.primarySessions.length>0?(M(),B("div",Bf,[t[13]||(t[13]=m("div",{class:"text-xs font-semibold text-monitor-accent-cyan uppercase tracking-wide mb-2 flex items-center"},[m("svg",{class:"w-3 h-3 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20"},[m("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})]),dt(" Primary Sessions ")],-1)),m("div",Df,[(M(!0),B(ye,null,ft(e.hierarchy.primarySessions,a=>(M(),B(ye,{key:a.sessionId},[m("div",{class:Se(["rounded-lg cursor-pointer transition-all duration-200 border-l-4 relative group",[e.selectedId===a.sessionId?"bg-slate-700 border-l-monitor-accent-cyan ring-1 ring-monitor-accent-cyan/30":"bg-slate-800 hover:bg-slate-700/70 border-l-monitor-accent-cyan/70",a.isPinned?"shadow-lg shadow-cyan-500/5":""]]),onClick:h=>e.selectSession(a.sessionId),onContextmenu:ui(h=>e.showContextMenu(a,h),["prevent"])},[a.isPinned?(M(),B("div",Pf,[...t[9]||(t[9]=[m("svg",{class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[m("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})],-1)])])):Q("",!0),m("div",Lf,[m("div",If,[m("div",Af,[e.getTotalChildCount(a.sessionId)>0?(M(),B("button",{key:0,class:"w-5 h-5 flex items-center justify-center rounded hover:bg-slate-600 transition-colors",onClick:ui(h=>e.toggleExpand(a.sessionId,h),["stop"])},[(M(),B("svg",{class:Se(["w-3 h-3 transition-transform text-monitor-text-muted",{"rotate-90":e.isExpanded(a.sessionId)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[10]||(t[10]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],8,Of)):(M(),B("span",Nf)),t[11]||(t[11]=m("svg",{class:"w-4 h-4 text-monitor-accent-cyan",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),m("span",{class:Se(["w-2 h-2 rounded-full",{"bg-green-500 animate-pulse-dot":a.status==="active","bg-gray-500":a.status==="completed","bg-red-500":a.status==="error"}])},null,2),a.label?(M(),B("span",$f,j(a.label),1)):(M(),B("span",Hf,j(a.sessionId.slice(0,8)),1)),e.getTotalChildCount(a.sessionId)>0?(M(),B("span",Wf,j(e.getTotalChildCount(a.sessionId))+" agents ",1)):Q("",!0)]),m("span",Ff,j(e.formatDuration(a.startTime,a.endTime)),1)]),m("div",zf,[m("div",Kf,[t[12]||(t[12]=m("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})],-1)),dt(" "+j(e.truncatePath(a.workingDirectory)),1)])])])],42,Tf),e.isExpanded(a.sessionId)?(M(!0),B(ye,{key:0},ft(e.getChildSessions(a.sessionId),h=>(M(),Qi(o,{key:h.sessionId,session:h,depth:1,"get-child-sessions":e.getChildSessions,"get-total-child-count":e.getTotalChildCount,"is-expanded":e.isExpanded,"toggle-expand":e.toggleExpand,"select-session":e.selectSession,"selected-id":e.selectedId,"format-duration":e.formatDuration,"on-context-menu":e.showContextMenu},null,8,["session","get-child-sessions","get-total-child-count","is-expanded","toggle-expand","select-session","selected-id","format-duration","on-context-menu"]))),128)):Q("",!0)],64))),128))])])):Q("",!0),e.hierarchy.otherSessions.length>0?(M(),B("div",Uf,[t[15]||(t[15]=m("div",{class:"text-xs font-semibold text-monitor-text-muted uppercase tracking-wide mb-2"}," Other Sessions ",-1)),m("div",Vf,[(M(!0),B(ye,null,ft(e.hierarchy.otherSessions,a=>(M(),B(ye,{key:a.sessionId},[m("div",{class:Se(["rounded-lg cursor-pointer transition-all duration-200 border-l-4 relative group",[e.selectedId===a.sessionId?"bg-slate-700 border-l-slate-400 ring-1 ring-slate-400/30":"bg-monitor-bg-tertiary hover:bg-slate-700/50 border-l-slate-600",e.store.hiddenSessionIds.has(a.sessionId)?"opacity-50":""]]),onClick:h=>e.selectSession(a.sessionId),onContextmenu:ui(h=>e.showContextMenu(a,h),["prevent"])},[m("div",qf,[m("div",Yf,[m("div",Xf,[e.getTotalChildCount(a.sessionId)>0?(M(),B("button",{key:0,class:"w-4 h-4 flex items-center justify-center rounded hover:bg-slate-600 transition-colors",onClick:ui(h=>e.toggleExpand(a.sessionId,h),["stop"])},[(M(),B("svg",{class:Se(["w-2.5 h-2.5 transition-transform text-monitor-text-muted",{"rotate-90":e.isExpanded(a.sessionId)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[14]||(t[14]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],8,Gf)):(M(),B("span",Jf)),m("span",{class:Se(["w-1.5 h-1.5 rounded-full",{"bg-green-500 animate-pulse-dot":a.status==="active","bg-gray-500":a.status==="completed","bg-red-500":a.status==="error"}])},null,2),a.label?(M(),B("span",Zf,j(a.label),1)):(M(),B("span",Qf,j(a.sessionId.slice(0,8)),1)),a.agentType?(M(),B("span",e_,j(a.agentType),1)):Q("",!0)]),m("span",t_,j(e.formatDuration(a.startTime,a.endTime)),1)])])],42,jf),e.isExpanded(a.sessionId)?(M(!0),B(ye,{key:0},ft(e.getChildSessions(a.sessionId),h=>(M(),Qi(o,{key:h.sessionId,session:h,depth:1,"get-child-sessions":e.getChildSessions,"get-total-child-count":e.getTotalChildCount,"is-expanded":e.isExpanded,"toggle-expand":e.toggleExpand,"select-session":e.selectSession,"selected-id":e.selectedId,"format-duration":e.formatDuration,"on-context-menu":e.showContextMenu},null,8,["session","get-child-sessions","get-total-child-count","is-expanded","toggle-expand","select-session","selected-id","format-duration","on-context-menu"]))),128)):Q("",!0)],64))),128))])])):Q("",!0),e.hierarchy.primarySessions.length===0&&e.hierarchy.otherSessions.length===0?(M(),B("div",s_," No sessions ")):Q("",!0)]),e.contextMenu.visible&&e.contextMenu.session?(M(),Qi(l,{key:0,x:e.contextMenu.x,y:e.contextMenu.y,session:e.contextMenu.session,"all-sessions":e.store.sessions,onClose:e.closeContextMenu,onSetParent:t[3]||(t[3]=(a,h)=>e.store.setSessionParent(a,h)),onTogglePin:t[4]||(t[4]=a=>e.store.toggleSessionPin(a)),onSetUserInitiated:t[5]||(t[5]=(a,h)=>e.store.setUserInitiated(a,h)),onRename:t[6]||(t[6]=(a,h)=>e.store.renameSession(a,h))},null,8,["x","y","session","all-sessions","onClose"])):Q("",!0)])}const r_=Bh(Sf,[["render",i_]]),n_={class:"h-full flex flex-col"},o_={class:"p-3 border-b border-slate-700 flex items-center justify-between"},l_={class:"text-sm font-medium text-monitor-text-secondary uppercase tracking-wide"},a_={class:"text-monitor-text-muted ml-2"},h_={class:"flex items-center space-x-3"},c_={key:0,class:"text-monitor-text-muted text-sm p-4 text-center"},u_={key:1},d_=["onClick"],f_={class:"text-xs text-monitor-text-muted font-mono w-24 flex-shrink-0"},__=["d"],p_={key:0,class:"px-1.5 py-0.5 text-xs rounded bg-purple-500/20 text-purple-400 mr-2 flex-shrink-0"},g_={class:"text-sm text-monitor-text-primary truncate flex-1"},m_={key:0,class:"px-3 pb-3 border-t border-slate-700"},v_={class:"text-xs text-monitor-text-muted py-2 flex items-center space-x-4"},S_={key:0,class:"mt-2"},b_={class:"code-block text-xs overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-h-48 max-w-full"},y_={key:1,class:"mt-2"},w_={class:"code-block text-xs overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-h-48 max-w-full"},C_={key:2,class:"mt-2"},x_={class:"code-block text-xs overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-h-96 max-w-full bg-cyan-900/20 border-l-2 border-cyan-500"},k_={key:3,class:"mt-2"},E_={class:"code-block text-xs overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-h-96 max-w-full bg-green-900/20 border-l-2 border-green-500"},M_={key:4,class:"mt-2"},R_={class:"code-block text-xs overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-w-full"},B_={key:5,class:"mt-2"},D_={class:"code-block text-xs text-red-300 overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-w-full"},T_={key:6,class:"mt-2 flex items-center space-x-4 text-xs"},P_={class:"text-green-400"},L_={class:"text-blue-400"},I_={key:0,class:"text-purple-400"},A_={key:7,class:"mt-3 flex items-center text-xs text-monitor-text-secondary"},O_={key:8,class:"mt-3"},N_={class:"text-xs text-monitor-text-secondary mb-1 flex items-center"},$_={class:"space-y-2 max-h-64 overflow-y-auto"},H_={class:"whitespace-pre-wrap text-purple-200"},W_={key:9,class:"mt-3"},F_=["onClick"],z_=Xt({__name:"EventStream",setup(e){const t=as(),s=fe(null),i=pe(()=>t.filteredEvents),r=pe(()=>t.autoScroll),n=fe(new Set);function o(v){n.value.has(v.id)?n.value.delete(v.id):(n.value.add(v.id),t.requestEventDetail(v.sessionId,v.id))}function l(v){return t.getEventDetail(v)||i.value.find(S=>S.id===v)}function a(v){const S=new Date(v),C=S.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),I=String(S.getMilliseconds()).padStart(3,"0");return`${C}.${I}`}function h(v){const S={session_start:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z",session_end:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z M9 10h6v4H9v-4z",tool_call:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z",tool_result:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",user_prompt:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",message:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z",notification:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9",thinking:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z",error:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",agent_spawn:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z",agent_complete:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z",subagent_start:"M13 10V3L4 14h7v7l9-11h-7z",subagent_stop:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"};return S[v]||S.message}function c(v){const S=v.toLowerCase();return S.includes("read")?"tool-badge-read":S.includes("write")?"tool-badge-write":S.includes("bash")?"tool-badge-bash":S.includes("edit")?"tool-badge-edit":"tool-badge-other"}function u(v){try{return JSON.stringify(v,null,2)}catch{return String(v)}}function d(v){var C;let S=null;if((C=v.data.subagent)!=null&&C.type)S=v.data.subagent.type;else if(v.data.toolName==="Task"){const I=v.data.toolInput;I!=null&&I.subagent_type&&(S=String(I.subagent_type))}else{const I=t.sessions.find(w=>w.sessionId===v.sessionId);I!=null&&I.agentType&&(S=I.agentType)}return S?S.toLowerCase():null}function _(v){var I;const S=v.data.toolInput;if(!S)return"";const C=((I=v.data.toolName)==null?void 0:I.toLowerCase())||"";if(C==="read"&&S.file_path){const w=String(S.file_path),$=w.split("/");return $.length>3?`.../${$.slice(-2).join("/")}`:w}if(C==="write"&&S.file_path){const w=String(S.file_path),$=w.split("/");return $.length>3?`.../${$.slice(-2).join("/")}`:w}if(C==="edit"&&S.file_path){const w=String(S.file_path),$=w.split("/");return $.length>3?`.../${$.slice(-2).join("/")}`:w}if(C==="bash"&&S.command){const w=String(S.command);return w.length>60?w.slice(0,60)+"...":w}return C==="grep"&&S.pattern?`"${S.pattern}"`:C==="glob"&&S.pattern?`"${S.pattern}"`:C==="task"&&S.subagent_type?String(S.subagent_type):""}function p(v){var C,I,w,$,J,re,X,Z,ge,ne;const S=_(v);switch(v.eventType){case"tool_call":return S?`${v.data.toolName}: ${S}`:`Calling ${v.data.toolName}`;case"tool_result":return S?`${v.data.toolName}: ${S}`:`${v.data.toolName} completed`;case"session_start":return"Session started";case"session_end":if(v.data.assistantResponse){const N=v.data.assistantResponse.slice(0,80);return N.length<v.data.assistantResponse.length?N+"...":N}return"Session ended";case"user_prompt":if(v.data.message){const N=v.data.message.slice(0,80);return N.length<v.data.message.length?N+"...":N}return"User prompt";case"message":return((C=v.data.message)==null?void 0:C.slice(0,100))||"Message";case"notification":return v.data.message||"Notification";case"thinking":return"Thinking...";case"error":return((I=v.data.error)==null?void 0:I.message)||"Error occurred";case"agent_spawn":return`Spawned ${(($=(w=v.data.subagent)==null?void 0:w.type)==null?void 0:$.toLowerCase())||"subagent"}`;case"agent_complete":return"subagent completed";case"subagent_start":return`${((re=(J=v.data.subagent)==null?void 0:J.type)==null?void 0:re.toLowerCase())||"subagent"} started`;case"subagent_stop":if(v.data.assistantResponse){const N=((Z=(X=v.data.subagent)==null?void 0:X.type)==null?void 0:Z.toLowerCase())||"subagent",E=v.data.assistantResponse.slice(0,60),O=E.length<v.data.assistantResponse.length?"...":"";return`${N}: ${E}${O}`}return`${((ne=(ge=v.data.subagent)==null?void 0:ge.type)==null?void 0:ne.toLowerCase())||"subagent"} completed`;default:return v.eventType}}function f(v){var w,$;const S=($=(w=v.data.subagent)==null?void 0:w.type)==null?void 0:$.toLowerCase(),C=v.timestamp,I=t.sessions.find(J=>{var re;return J.parentSessionId===v.sessionId&&((re=J.agentType)==null?void 0:re.toLowerCase())===S&&Math.abs(J.startTime-C)<5e3});I&&t.selectSession(I.sessionId)}return Is(i,async()=>{r.value&&s.value&&(await Js(),s.value.scrollTop=s.value.scrollHeight)}),(v,S)=>(M(),B("div",n_,[m("div",o_,[m("h2",l_,[S[2]||(S[2]=dt(" Event Stream ",-1)),m("span",a_,"("+j(i.value.length)+")",1)]),m("div",h_,[m("button",{class:Se(["text-xs px-2 py-1 rounded",r.value?"bg-monitor-accent-cyan text-white":"bg-slate-700 text-monitor-text-secondary"]),onClick:S[0]||(S[0]=C=>Ne(t).setAutoScroll(!r.value))}," Auto-scroll ",2),m("button",{class:"text-xs px-2 py-1 rounded bg-slate-700 text-monitor-text-secondary hover:bg-slate-600",onClick:S[1]||(S[1]=C=>Ne(t).clearEvents())}," Clear ")])]),m("div",{ref_key:"eventListRef",ref:s,class:"flex-1 overflow-y-auto p-2 space-y-1"},[i.value.length===0?(M(),B("div",c_,[Ne(t).selectedSessionId?(M(),B("p",u_,"Waiting for events...")):(M(),B(ye,{key:0},[S[3]||(S[3]=m("p",null,"Select a session to view its events",-1)),S[4]||(S[4]=m("p",{class:"text-xs mt-2"},"or new events will appear here as they occur",-1))],64))])):Q("",!0),(M(!0),B(ye,null,ft(i.value,C=>{var I,w,$,J,re,X,Z,ge;return M(),B("div",{key:C.id,class:"group rounded-lg bg-monitor-bg-secondary hover:bg-slate-700/70 transition-colors animate-fade-in"},[m("div",{class:"flex items-center px-3 py-2 cursor-pointer",onClick:ne=>o(C)},[m("span",f_,j(a(C.timestamp)),1),(M(),B("svg",{class:Se(["w-4 h-4 mr-2 flex-shrink-0",`event-${C.eventType}`]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:h(C.eventType)},null,8,__)],2)),m("span",{class:Se(["text-xs px-1.5 py-0.5 rounded mr-2 flex-shrink-0",`event-${C.eventType} bg-slate-800`])},j(C.eventType),3),d(C)?(M(),B("span",p_,j(d(C)),1)):Q("",!0),C.data.toolName?(M(),B("span",{key:1,class:Se(["tool-badge mr-2",c(C.data.toolName)])},j(C.data.toolName),3)):Q("",!0),m("span",g_,j(p(C)),1),(M(),B("svg",{class:Se(["w-4 h-4 text-monitor-text-muted transition-transform",{"rotate-180":n.value.has(C.id)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...S[5]||(S[5]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))],8,d_),n.value.has(C.id)?(M(),B("div",m_,[m("div",v_,[m("span",null,"Session: "+j(C.sessionId.slice(0,8)),1),m("span",null,"Machine: "+j(C.machineId),1),m("span",null,j(C.workingDirectory),1)]),C.data.toolInput?(M(),B("div",S_,[S[6]||(S[6]=m("div",{class:"text-xs text-monitor-text-secondary mb-1"},"Input:",-1)),m("pre",b_,j(u(C.data.toolInput)),1)])):Q("",!0),C.data.toolOutput?(M(),B("div",y_,[S[7]||(S[7]=m("div",{class:"text-xs text-monitor-text-secondary mb-1"},"Output:",-1)),m("pre",w_,j(u(C.data.toolOutput)),1)])):Q("",!0),C.eventType==="user_prompt"&&C.data.message?(M(),B("div",C_,[S[8]||(S[8]=m("div",{class:"text-xs text-cyan-400 mb-1 flex items-center"},[m("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),dt(" User Prompt: ")],-1)),m("pre",x_,j(C.data.message),1)])):Q("",!0),C.eventType==="session_end"&&C.data.assistantResponse?(M(),B("div",k_,[S[9]||(S[9]=m("div",{class:"text-xs text-green-400 mb-1 flex items-center"},[m("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),dt(" Final Response: ")],-1)),m("pre",E_,j(C.data.assistantResponse),1)])):Q("",!0),C.data.message&&C.eventType!=="user_prompt"?(M(),B("div",M_,[S[10]||(S[10]=m("div",{class:"text-xs text-monitor-text-secondary mb-1"},"Message:",-1)),m("pre",R_,j(C.data.message),1)])):Q("",!0),C.data.error?(M(),B("div",B_,[S[11]||(S[11]=m("div",{class:"text-xs text-red-400 mb-1"},"Error:",-1)),m("pre",D_,j(C.data.error.message)+`
`+j(C.data.error.stack),1)])):Q("",!0),C.data.tokenUsage?(M(),B("div",T_,[S[12]||(S[12]=m("span",{class:"text-monitor-text-secondary"},"Tokens:",-1)),m("span",P_,"+"+j(C.data.tokenUsage.input)+" in",1),m("span",L_,"+"+j(C.data.tokenUsage.output)+" out",1),C.data.tokenUsage.cacheRead?(M(),B("span",I_,j(C.data.tokenUsage.cacheRead)+" cache read ",1)):Q("",!0)])):Q("",!0),Ne(t).loadingDetails.has(C.id)?(M(),B("div",A_,[...S[13]||(S[13]=[m("svg",{class:"animate-spin h-3 w-3 mr-2",fill:"none",viewBox:"0 0 24 24"},[m("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),m("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),dt(" Loading full event details... ",-1)])])):Q("",!0),($=(w=(I=l(C.id))==null?void 0:I.data)==null?void 0:w.thinkingBlocks)!=null&&$.length?(M(),B("div",O_,[m("div",N_,[S[14]||(S[14]=m("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})],-1)),dt(" Chain of Thought ("+j(((X=(re=(J=l(C.id))==null?void 0:J.data)==null?void 0:re.thinkingBlocks)==null?void 0:X.length)||0)+") ",1)]),m("div",$_,[(M(!0),B(ye,null,ft(((ge=(Z=l(C.id))==null?void 0:Z.data)==null?void 0:ge.thinkingBlocks)||[],(ne,N)=>(M(),B("div",{key:N,class:"code-block text-xs bg-purple-900/20 border-l-2 border-purple-500 p-2"},[m("pre",H_,j(ne.content),1)]))),128))])])):Q("",!0),C.data.toolName==="Task"&&C.data.subagent?(M(),B("div",W_,[m("button",{onClick:ne=>f(C),class:"flex items-center text-xs text-purple-400 hover:text-cyan-400 transition-colors"},[S[15]||(S[15]=m("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),dt(" View "+j(C.data.subagent.type||"subagent")+" session  ",1)],8,F_)])):Q("",!0)])):Q("",!0)])}),128))],512)]))}}),K_={class:"p-2 border-b border-slate-700 flex items-center justify-between"},U_={class:"flex items-center space-x-2 text-xs text-monitor-text-muted"},V_={class:"flex-1 relative overflow-hidden p-2"},j_={key:0,class:"absolute inset-0 flex items-center justify-center text-monitor-text-muted text-sm"},q_={class:"absolute inset-0 flex"},Y_={class:"relative h-full"},X_={class:"absolute left-0 text-xs text-monitor-text-muted w-16 truncate"},G_={class:"absolute left-16 right-0 h-full flex items-center"},J_=["onMouseenter","onClick"],Z_={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-slate-800 rounded shadow-lg text-xs whitespace-nowrap z-20"},Q_={class:"font-medium text-monitor-text-primary"},ep={class:"text-monitor-text-muted"},tp={class:"text-monitor-text-secondary"},sp=Xt({__name:"ToolTimeline",setup(e){const t=as(),s=fe(null),i=fe(null),r=pe(()=>t.toolEvents),n=pe(()=>{if(r.value.length===0)return{start:Date.now()-6e4,end:Date.now()};const u=r.value.map(f=>f.timestamp),d=Math.min(...u),_=Math.max(...u,Date.now()),p=(_-d)*.05||5e3;return{start:d-p,end:_+p}});function o(u){const{start:d,end:_}=n.value,p=_-d;return p===0?50:(u-d)/p*100}function l(u){const d=u.toLowerCase();return d.includes("read")?"bg-blue-500":d.includes("write")?"bg-orange-500":d.includes("bash")?"bg-green-500":d.includes("edit")?"bg-yellow-500":d.includes("glob")?"bg-purple-500":d.includes("grep")?"bg-pink-500":"bg-gray-500"}function a(u){return new Date(u).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}const h=pe(()=>{const u=new Map;return r.value.forEach(d=>{const _=u.get(d.sessionId)||[];_.push(d),u.set(d.sessionId,_)}),u}),c=pe(()=>Array.from(h.value.keys()));return(u,d)=>(M(),B("div",{ref_key:"containerRef",ref:s,class:"h-full flex flex-col"},[m("div",K_,[d[2]||(d[2]=m("h2",{class:"text-xs font-medium text-monitor-text-secondary uppercase tracking-wide"}," Tool Timeline ",-1)),m("div",U_,[m("span",null,j(a(n.value.start)),1),d[1]||(d[1]=m("span",null,"-",-1)),m("span",null,j(a(n.value.end)),1)])]),m("div",V_,[r.value.length===0?(M(),B("div",j_," No tool calls yet ")):Q("",!0),m("div",q_,[(M(),B(ye,null,ft(5,_=>m("div",{key:_,class:"flex-1 border-r border-slate-700/50 last:border-r-0"})),64))]),m("div",Y_,[(M(!0),B(ye,null,ft(c.value,(_,p)=>(M(),B("div",{key:_,class:"absolute left-0 right-0 flex items-center",style:Kt({top:`${p/Math.max(c.value.length,1)*100}%`,height:`${100/Math.max(c.value.length,1)}%`})},[m("div",X_,j(_.slice(0,6)),1),m("div",G_,[(M(!0),B(ye,null,ft(h.value.get(_),f=>(M(),B("div",{key:f.id,class:Se(["absolute transform -translate-x-1/2 cursor-pointer transition-all duration-200",["rounded-full",l(f.data.toolName||""),i.value===f.id?"w-4 h-4 ring-2 ring-white z-10":"w-3 h-3 hover:w-4 hover:h-4"]]),style:Kt({left:`${o(f.timestamp)}%`}),onMouseenter:v=>i.value=f.id,onMouseleave:d[0]||(d[0]=v=>i.value=null),onClick:v=>Ne(t).selectSession(f.sessionId)},[i.value===f.id?(M(),B("div",Z_,[m("div",Q_,j(f.data.toolName),1),m("div",ep,j(a(f.timestamp)),1),m("div",tp,j(f.eventType==="tool_call"?"Called":"Completed"),1)])):Q("",!0)],46,J_))),128))])],4))),128))]),d[3]||(d[3]=vh('<div class="absolute bottom-0 right-0 flex items-center space-x-3 text-xs p-2 bg-monitor-bg-primary/80 rounded"><div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span><span class="text-monitor-text-muted">Read</span></div><div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-orange-500"></span><span class="text-monitor-text-muted">Write</span></div><div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-green-500"></span><span class="text-monitor-text-muted">Bash</span></div><div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-yellow-500"></span><span class="text-monitor-text-muted">Edit</span></div></div>',1))])],512))}}),ip={class:"p-3 space-y-4"},rp={class:"text-xs text-monitor-text-muted"},np={class:"flex items-center justify-between text-sm mb-1"},op={class:"font-mono text-monitor-text-primary"},lp={class:"h-2 bg-slate-700 rounded-full overflow-hidden"},ap={class:"flex items-center justify-between text-sm mb-1"},hp={class:"font-mono text-monitor-text-primary"},cp={class:"h-2 bg-slate-700 rounded-full overflow-hidden"},up={key:0,class:"pt-2 border-t border-slate-700"},dp={class:"grid grid-cols-2 gap-4"},fp={class:"flex items-center justify-between text-xs mb-1"},_p={class:"font-mono text-monitor-text-muted"},pp={class:"h-1 bg-slate-700 rounded-full overflow-hidden"},gp={class:"flex items-center justify-between text-xs mb-1"},mp={class:"font-mono text-monitor-text-muted"},vp={class:"h-1 bg-slate-700 rounded-full overflow-hidden"},Sp={class:"pt-3 border-t border-slate-700"},bp={class:"flex items-center justify-between"},yp={class:"font-mono text-lg text-monitor-text-primary"},wp={class:"flex items-center justify-between mt-2"},Cp={class:"font-mono text-sm text-monitor-accent-cyan"},xp={key:1,class:"pt-3 border-t border-slate-700"},kp={class:"space-y-2 max-h-32 overflow-y-auto"},Ep=["onClick"],Mp={class:"font-mono text-monitor-text-secondary"},Rp=Xt({__name:"TokenMetrics",setup(e){const t=as(),s=pe(()=>t.tokenTotals),i=pe(()=>t.selectedSession),r=pe(()=>{var h,c,u,d;if(!i.value)return null;const a=i.value;return{input:((h=a.tokenUsage)==null?void 0:h.totalInput)||0,output:((c=a.tokenUsage)==null?void 0:c.totalOutput)||0,cacheRead:((u=a.tokenUsage)==null?void 0:u.totalCacheRead)||0,cacheWrite:((d=a.tokenUsage)==null?void 0:d.totalCacheCreation)||0}}),n=pe(()=>{const d=r.value||s.value;return(d.input/1e3*.003+d.output/1e3*.015+(d.cacheRead||0)/1e3*3e-4+(d.cacheWrite||0)/1e3*.00375).toFixed(4)});function o(a){return a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a.toString()}const l=pe(()=>{const a=r.value||s.value;return Math.max(a.input,a.output,1)});return(a,h)=>(M(),B("div",ip,[m("div",rp,j(i.value?`Session: ${i.value.sessionId.slice(0,8)}`:"All Sessions"),1),m("div",null,[m("div",np,[h[0]||(h[0]=m("span",{class:"text-green-400"},"Input",-1)),m("span",op,j(o((r.value||s.value).input)),1)]),m("div",lp,[m("div",{class:"h-full bg-green-500 rounded-full transition-all duration-500",style:Kt({width:`${(r.value||s.value).input/l.value*100}%`})},null,4)])]),m("div",null,[m("div",ap,[h[1]||(h[1]=m("span",{class:"text-blue-400"},"Output",-1)),m("span",hp,j(o((r.value||s.value).output)),1)]),m("div",cp,[m("div",{class:"h-full bg-blue-500 rounded-full transition-all duration-500",style:Kt({width:`${(r.value||s.value).output/l.value*100}%`})},null,4)])]),(r.value||s.value).cacheRead||(r.value||s.value).cacheWrite?(M(),B("div",up,[h[4]||(h[4]=m("div",{class:"text-xs text-monitor-text-secondary mb-2"},"Cache",-1)),m("div",dp,[m("div",null,[m("div",fp,[h[2]||(h[2]=m("span",{class:"text-purple-400"},"Read",-1)),m("span",_p,j(o((r.value||s.value).cacheRead||0)),1)]),m("div",pp,[m("div",{class:"h-full bg-purple-500 rounded-full",style:Kt({width:`${((r.value||s.value).cacheRead||0)/Math.max((r.value||s.value).input,1)*100}%`})},null,4)])]),m("div",null,[m("div",gp,[h[3]||(h[3]=m("span",{class:"text-pink-400"},"Write",-1)),m("span",mp,j(o((r.value||s.value).cacheWrite||0)),1)]),m("div",vp,[m("div",{class:"h-full bg-pink-500 rounded-full",style:Kt({width:`${((r.value||s.value).cacheWrite||0)/Math.max((r.value||s.value).input,1)*100}%`})},null,4)])])])])):Q("",!0),m("div",Sp,[m("div",bp,[h[5]||(h[5]=m("span",{class:"text-sm text-monitor-text-secondary"},"Total Tokens",-1)),m("span",yp,j(o((r.value||s.value).input+(r.value||s.value).output)),1)]),m("div",wp,[h[6]||(h[6]=m("span",{class:"text-xs text-monitor-text-muted"},"Est. Cost",-1)),m("span",Cp," $"+j(n.value),1)])]),!i.value&&Ne(t).sessions.length>0?(M(),B("div",xp,[h[7]||(h[7]=m("div",{class:"text-xs text-monitor-text-secondary mb-2"},"By Session",-1)),m("div",kp,[(M(!0),B(ye,null,ft(Ne(t).sessions,c=>(M(),B("div",{key:c.sessionId,class:"flex items-center justify-between text-xs"},[m("span",{class:"text-monitor-text-muted cursor-pointer hover:text-monitor-text-primary",onClick:u=>Ne(t).selectSession(c.sessionId)},j(c.sessionId.slice(0,8)),9,Ep),m("span",Mp,j(o(c.tokenUsage.totalInput+c.tokenUsage.totalOutput)),1)]))),128))])])):Q("",!0)]))}}),Bp={class:"flex items-center space-x-2"},Dp={key:0,class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Tp={key:1,class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pp={key:0,class:"inline-flex items-center text-xs text-monitor-text-muted"},Lp=Xt({__name:"ModeIndicator",setup(e){const t=as(),s=pe(()=>t.mode),i=pe(()=>t.connectionStatus==="connected");return(r,n)=>(M(),B("div",Bp,[m("span",{class:Se(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",{"bg-blue-900 text-blue-200":s.value==="local","bg-purple-900 text-purple-200":s.value==="redis"}])},[s.value==="local"?(M(),B("svg",Dp,[...n[0]||(n[0]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])])):(M(),B("svg",Tp,[...n[1]||(n[1]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"},null,-1)])])),dt(" "+j(s.value==="local"?"Local":"Redis"),1)],2),i.value?(M(),B("span",Pp,[...n[2]||(n[2]=[m("svg",{class:"w-3 h-3 mr-1 text-green-500",fill:"currentColor",viewBox:"0 0 24 24"},[m("circle",{cx:"12",cy:"12",r:"4"})],-1),dt(" Connected ",-1)])])):Q("",!0)]))}}),Ip={class:"bg-monitor-bg-secondary px-4 py-2"},Ap={class:"flex items-center space-x-4"},Op={class:"relative flex-1 max-w-md"},Np={class:"relative"},$p={key:0,class:"bg-monitor-accent-cyan text-white text-xs px-1.5 rounded-full"},Hp={key:0,class:"absolute top-full left-0 mt-1 w-56 bg-monitor-bg-primary border border-slate-700 rounded-lg shadow-xl z-50"},Wp={class:"p-2 space-y-1 max-h-64 overflow-y-auto"},Fp=["onClick"],zp={key:0,class:"w-4 h-4 text-monitor-accent-cyan",fill:"currentColor",viewBox:"0 0 24 24"},Kp={key:0,class:"flex items-center space-x-2"},Up=["onClick"],Vp={class:"text-xs text-monitor-text-muted"},jp=Xt({__name:"FilterBar",setup(e){const t=as(),s=fe(""),i=fe(!1),r=["session_start","session_end","tool_call","tool_result","message","notification","thinking","error","agent_spawn","agent_complete"],n=pe(()=>t.filters.eventTypes),o=pe(()=>t.filters.eventTypes.length>0||t.filters.searchQuery!=="");function l(){t.setFilter("searchQuery",s.value)}function a(d){t.toggleEventTypeFilter(d)}function h(){s.value="",t.clearFilters()}function c(d){return d.split("_").map(_=>_.charAt(0).toUpperCase()+_.slice(1)).join(" ")}function u(d){return{session_start:"bg-green-500/20 text-green-400 border-green-500",session_end:"bg-gray-500/20 text-gray-400 border-gray-500",tool_call:"bg-blue-500/20 text-blue-400 border-blue-500",tool_result:"bg-cyan-500/20 text-cyan-400 border-cyan-500",message:"bg-white/20 text-white border-white",notification:"bg-yellow-500/20 text-yellow-400 border-yellow-500",thinking:"bg-purple-500/20 text-purple-400 border-purple-500",error:"bg-red-500/20 text-red-400 border-red-500",agent_spawn:"bg-orange-500/20 text-orange-400 border-orange-500",agent_complete:"bg-lime-500/20 text-lime-400 border-lime-500"}[d]||"bg-gray-500/20 text-gray-400 border-gray-500"}return(d,_)=>(M(),B(ye,null,[m("div",Ip,[m("div",Ap,[m("div",Op,[_[3]||(_[3]=m("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-monitor-text-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),Ya(m("input",{"onUpdate:modelValue":_[0]||(_[0]=p=>s.value=p),type:"text",placeholder:"Search events...",class:"w-full pl-10 pr-4 py-1.5 bg-monitor-bg-primary border border-slate-700 rounded-lg text-sm text-monitor-text-primary placeholder-monitor-text-muted focus:outline-none focus:border-monitor-accent-cyan",onInput:l},null,544),[[Ch,s.value]])]),m("div",Np,[m("button",{class:Se(["flex items-center space-x-2 px-3 py-1.5 bg-monitor-bg-primary border border-slate-700 rounded-lg text-sm hover:border-slate-600 transition-colors",{"border-monitor-accent-cyan":n.value.length>0}]),onClick:_[1]||(_[1]=p=>i.value=!i.value)},[_[4]||(_[4]=m("svg",{class:"w-4 h-4 text-monitor-text-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1)),_[5]||(_[5]=m("span",{class:"text-monitor-text-secondary"},"Event Types",-1)),n.value.length>0?(M(),B("span",$p,j(n.value.length),1)):Q("",!0)],2),i.value?(M(),B("div",Hp,[m("div",Wp,[(M(),B(ye,null,ft(r,p=>m("button",{key:p,class:"w-full flex items-center justify-between px-2 py-1.5 rounded hover:bg-slate-700/50 transition-colors",onClick:f=>a(p)},[m("span",{class:Se(["px-2 py-0.5 rounded text-xs border",u(p)])},j(c(p)),3),n.value.includes(p)?(M(),B("svg",zp,[..._[6]||(_[6]=[m("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):Q("",!0)],8,Fp)),64))])])):Q("",!0)]),n.value.length>0?(M(),B("div",Kp,[(M(!0),B(ye,null,ft(n.value,p=>(M(),B("span",{key:p,class:Se(["inline-flex items-center px-2 py-0.5 rounded text-xs border cursor-pointer hover:opacity-80",u(p)]),onClick:f=>a(p)},[dt(j(c(p))+" ",1),_[7]||(_[7]=m("svg",{class:"w-3 h-3 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1))],10,Up))),128))])):Q("",!0),o.value?(M(),B("button",{key:1,class:"text-xs text-monitor-text-muted hover:text-monitor-text-primary transition-colors",onClick:h}," Clear all ")):Q("",!0),m("div",Vp,j(Ne(t).filteredEvents.length)+" events ",1)])]),i.value?(M(),B("div",{key:0,class:"fixed inset-0 z-40",onClick:_[2]||(_[2]=p=>i.value=!1)})):Q("",!0)],64))}});/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var Dh=Object.defineProperty,qp=Object.getOwnPropertyDescriptor,Yp=(e,t)=>{for(var s in t)Dh(e,s,{get:t[s],enumerable:!0})},Ie=(e,t,s,i)=>{for(var r=i>1?void 0:i?qp(t,s):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Dh(t,s,r),r},Y=(e,t)=>(s,i)=>t(s,i,e),Sl="Terminal input",En={get:()=>Sl,set:e=>Sl=e},bl="Too much output to announce, navigate to rows manually to read",Mn={get:()=>bl,set:e=>bl=e};function Xp(e){return e.replace(/\r?\n/g,"\r")}function Gp(e,t){return t?"\x1B[200~"+e+"\x1B[201~":e}function Jp(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()}function Zp(e,t,s,i){if(e.stopPropagation(),e.clipboardData){let r=e.clipboardData.getData("text/plain");Th(r,t,s,i)}}function Th(e,t,s,i){e=Xp(e),e=Gp(e,s.decPrivateModes.bracketedPasteMode&&i.rawOptions.ignoreBracketedPasteMode!==!0),s.triggerDataEvent(e,!0),t.value=""}function Ph(e,t,s){let i=s.getBoundingClientRect(),r=e.clientX-i.left-10,n=e.clientY-i.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${r}px`,t.style.top=`${n}px`,t.style.zIndex="1000",t.focus()}function yl(e,t,s,i,r){Ph(e,t,s),r&&i.rightClickSelect(e),t.value=i.selectionText,t.select()}function Ss(e){return e>65535?(e-=65536,String.fromCharCode((e>>10)+55296)+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)}function Hr(e,t=0,s=e.length){let i="";for(let r=t;r<s;++r){let n=e[r];n>65535?(n-=65536,i+=String.fromCharCode((n>>10)+55296)+String.fromCharCode(n%1024+56320)):i+=String.fromCharCode(n)}return i}var Qp=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){let s=e.length;if(!s)return 0;let i=0,r=0;if(this._interim){let n=e.charCodeAt(r++);56320<=n&&n<=57343?t[i++]=(this._interim-55296)*1024+n-56320+65536:(t[i++]=this._interim,t[i++]=n),this._interim=0}for(let n=r;n<s;++n){let o=e.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=s)return this._interim=o,i;let l=e.charCodeAt(n);56320<=l&&l<=57343?t[i++]=(o-55296)*1024+l-56320+65536:(t[i++]=o,t[i++]=l);continue}o!==65279&&(t[i++]=o)}return i}},eg=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){let s=e.length;if(!s)return 0;let i=0,r,n,o,l,a=0,h=0;if(this.interim[0]){let d=!1,_=this.interim[0];_&=(_&224)===192?31:(_&240)===224?15:7;let p=0,f;for(;(f=this.interim[++p]&63)&&p<4;)_<<=6,_|=f;let v=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,S=v-p;for(;h<S;){if(h>=s)return 0;if(f=e[h++],(f&192)!==128){h--,d=!0;break}else this.interim[p++]=f,_<<=6,_|=f&63}d||(v===2?_<128?h--:t[i++]=_:v===3?_<2048||_>=55296&&_<=57343||_===65279||(t[i++]=_):_<65536||_>1114111||(t[i++]=_)),this.interim.fill(0)}let c=s-4,u=h;for(;u<s;){for(;u<c&&!((r=e[u])&128)&&!((n=e[u+1])&128)&&!((o=e[u+2])&128)&&!((l=e[u+3])&128);)t[i++]=r,t[i++]=n,t[i++]=o,t[i++]=l,u+=4;if(r=e[u++],r<128)t[i++]=r;else if((r&224)===192){if(u>=s)return this.interim[0]=r,i;if(n=e[u++],(n&192)!==128){u--;continue}if(a=(r&31)<<6|n&63,a<128){u--;continue}t[i++]=a}else if((r&240)===224){if(u>=s)return this.interim[0]=r,i;if(n=e[u++],(n&192)!==128){u--;continue}if(u>=s)return this.interim[0]=r,this.interim[1]=n,i;if(o=e[u++],(o&192)!==128){u--;continue}if(a=(r&15)<<12|(n&63)<<6|o&63,a<2048||a>=55296&&a<=57343||a===65279)continue;t[i++]=a}else if((r&248)===240){if(u>=s)return this.interim[0]=r,i;if(n=e[u++],(n&192)!==128){u--;continue}if(u>=s)return this.interim[0]=r,this.interim[1]=n,i;if(o=e[u++],(o&192)!==128){u--;continue}if(u>=s)return this.interim[0]=r,this.interim[1]=n,this.interim[2]=o,i;if(l=e[u++],(l&192)!==128){u--;continue}if(a=(r&7)<<18|(n&63)<<12|(o&63)<<6|l&63,a<65536||a>1114111)continue;t[i++]=a}}return i}},Lh="",bs=" ",$i=class Ih{constructor(){this.fg=0,this.bg=0,this.extended=new mr}static toColorRGB(t){return[t>>>16&255,t>>>8&255,t&255]}static fromColorRGB(t){return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255}clone(){let t=new Ih;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},mr=class Ah{constructor(t=0,s=0){this._ext=0,this._urlId=0,this._ext=t,this._urlId=s}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get urlId(){return this._urlId}set urlId(t){this._urlId=t}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}clone(){return new Ah(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},Tt=class Oh extends $i{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new mr,this.combinedData=""}static fromCharData(t){let s=new Oh;return s.setFromCharData(t),s}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?Ss(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(t){this.fg=t[0],this.bg=0;let s=!1;if(t[1].length>2)s=!0;else if(t[1].length===2){let i=t[1].charCodeAt(0);if(55296<=i&&i<=56319){let r=t[1].charCodeAt(1);56320<=r&&r<=57343?this.content=(i-55296)*1024+r-56320+65536|t[2]<<22:s=!0}else s=!0}else this.content=t[1].charCodeAt(0)|t[2]<<22;s&&(this.combinedData=t[1],this.content=2097152|t[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},wl="di$target",Rn="di$dependencies",en=new Map;function tg(e){return e[Rn]||[]}function et(e){if(en.has(e))return en.get(e);let t=function(s,i,r){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");sg(t,s,r)};return t._id=e,en.set(e,t),t}function sg(e,t,s){t[wl]===t?t[Rn].push({id:e,index:s}):(t[Rn]=[{id:e,index:s}],t[wl]=t)}var _t=et("BufferService"),Nh=et("CoreMouseService"),Hs=et("CoreService"),ig=et("CharsetService"),Eo=et("InstantiationService"),$h=et("LogService"),pt=et("OptionsService"),Hh=et("OscLinkService"),rg=et("UnicodeService"),Hi=et("DecorationService"),Bn=class{constructor(e,t,s){this._bufferService=e,this._optionsService=t,this._oscLinkService=s}provideLinks(e,t){var c;let s=this._bufferService.buffer.lines.get(e-1);if(!s){t(void 0);return}let i=[],r=this._optionsService.rawOptions.linkHandler,n=new Tt,o=s.getTrimmedLength(),l=-1,a=-1,h=!1;for(let u=0;u<o;u++)if(!(a===-1&&!s.hasContent(u))){if(s.loadCell(u,n),n.hasExtendedAttrs()&&n.extended.urlId)if(a===-1){a=u,l=n.extended.urlId;continue}else h=n.extended.urlId!==l;else a!==-1&&(h=!0);if(h||a!==-1&&u===o-1){let d=(c=this._oscLinkService.getLinkData(l))==null?void 0:c.uri;if(d){let _={start:{x:a+1,y:e},end:{x:u+(!h&&u===o-1?1:0),y:e}},p=!1;if(!(r!=null&&r.allowNonHttpProtocols))try{let f=new URL(d);["http:","https:"].includes(f.protocol)||(p=!0)}catch{p=!0}p||i.push({text:d,range:_,activate:(f,v)=>r?r.activate(f,v,_):ng(f,v),hover:(f,v)=>{var S;return(S=r==null?void 0:r.hover)==null?void 0:S.call(r,f,v,_)},leave:(f,v)=>{var S;return(S=r==null?void 0:r.leave)==null?void 0:S.call(r,f,v,_)}})}h=!1,n.hasExtendedAttrs()&&n.extended.urlId?(a=u,l=n.extended.urlId):(a=-1,l=-1)}}t(i)}};Bn=Ie([Y(0,_t),Y(1,pt),Y(2,Hh)],Bn);function ng(e,t){if(confirm(`Do you want to navigate to ${t}?

WARNING: This link could potentially be dangerous`)){let s=window.open();if(s){try{s.opener=null}catch{}s.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}var Wr=et("CharSizeService"),hs=et("CoreBrowserService"),Mo=et("MouseService"),cs=et("RenderService"),og=et("SelectionService"),Wh=et("CharacterJoinerService"),ei=et("ThemeService"),Fh=et("LinkProviderService"),lg=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?Cl.isErrorNoTelemetry(e)?new Cl(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},ag=new lg;function sr(e){hg(e)||ag.onUnexpectedError(e)}var Dn="Canceled";function hg(e){return e instanceof cg?!0:e instanceof Error&&e.name===Dn&&e.message===Dn}var cg=class extends Error{constructor(){super(Dn),this.name=this.message}};function ug(e){return new Error(`Illegal argument: ${e}`)}var Cl=class Tn extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof Tn)return t;let s=new Tn;return s.message=t.message,s.stack=t.stack,s}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}},Pn=class zh extends Error{constructor(t){super(t||"An unexpected bug occurred."),Object.setPrototypeOf(this,zh.prototype)}};function yt(e,t=0){return e[e.length-(1+t)]}var dg;(e=>{function t(n){return n<0}e.isLessThan=t;function s(n){return n<=0}e.isLessThanOrEqual=s;function i(n){return n>0}e.isGreaterThan=i;function r(n){return n===0}e.isNeitherLessOrGreaterThan=r,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(dg||(dg={}));function fg(e,t){let s=this,i=!1,r;return function(){return i||(i=!0,t||(r=e.apply(s,arguments))),r}}var Kh;(e=>{function t(w){return w&&typeof w=="object"&&typeof w[Symbol.iterator]=="function"}e.is=t;let s=Object.freeze([]);function i(){return s}e.empty=i;function*r(w){yield w}e.single=r;function n(w){return t(w)?w:r(w)}e.wrap=n;function o(w){return w||s}e.from=o;function*l(w){for(let $=w.length-1;$>=0;$--)yield w[$]}e.reverse=l;function a(w){return!w||w[Symbol.iterator]().next().done===!0}e.isEmpty=a;function h(w){return w[Symbol.iterator]().next().value}e.first=h;function c(w,$){let J=0;for(let re of w)if($(re,J++))return!0;return!1}e.some=c;function u(w,$){for(let J of w)if($(J))return J}e.find=u;function*d(w,$){for(let J of w)$(J)&&(yield J)}e.filter=d;function*_(w,$){let J=0;for(let re of w)yield $(re,J++)}e.map=_;function*p(w,$){let J=0;for(let re of w)yield*$(re,J++)}e.flatMap=p;function*f(...w){for(let $ of w)yield*$}e.concat=f;function v(w,$,J){let re=J;for(let X of w)re=$(re,X);return re}e.reduce=v;function*S(w,$,J=w.length){for($<0&&($+=w.length),J<0?J+=w.length:J>w.length&&(J=w.length);$<J;$++)yield w[$]}e.slice=S;function C(w,$=Number.POSITIVE_INFINITY){let J=[];if($===0)return[J,w];let re=w[Symbol.iterator]();for(let X=0;X<$;X++){let Z=re.next();if(Z.done)return[J,e.empty()];J.push(Z.value)}return[J,{[Symbol.iterator](){return re}}]}e.consume=C;async function I(w){let $=[];for await(let J of w)$.push(J);return Promise.resolve($)}e.asyncToArray=I})(Kh||(Kh={}));function Ns(e){if(Kh.is(e)){let t=[];for(let s of e)if(s)try{s.dispose()}catch(i){t.push(i)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function _g(...e){return Re(()=>Ns(e))}function Re(e){return{dispose:fg(()=>{e()})}}var Uh=class Vh{constructor(){this._toDispose=new Set,this._isDisposed=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Ns(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?Vh.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),void 0)}};Uh.DISABLE_DISPOSED_WARNING=!1;var ws=Uh,ce=class{constructor(){this._store=new ws,this._store}dispose(){this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};ce.None=Object.freeze({dispose(){}});var Qs=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){var t;this._isDisposed||e===this._value||((t=this._value)==null||t.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){var e;this._isDisposed=!0,(e=this._value)==null||e.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e}},ss=typeof window=="object"?window:globalThis,Ln=class In{constructor(t){this.element=t,this.next=In.Undefined,this.prev=In.Undefined}};Ln.Undefined=new Ln(void 0);var De=Ln,xl=class{constructor(){this._first=De.Undefined,this._last=De.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===De.Undefined}clear(){let e=this._first;for(;e!==De.Undefined;){let t=e.next;e.prev=De.Undefined,e.next=De.Undefined,e=t}this._first=De.Undefined,this._last=De.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){let s=new De(e);if(this._first===De.Undefined)this._first=s,this._last=s;else if(t){let r=this._last;this._last=s,s.prev=r,r.next=s}else{let r=this._first;this._first=s,s.next=r,r.prev=s}this._size+=1;let i=!1;return()=>{i||(i=!0,this._remove(s))}}shift(){if(this._first!==De.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==De.Undefined){let e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==De.Undefined&&e.next!==De.Undefined){let t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===De.Undefined&&e.next===De.Undefined?(this._first=De.Undefined,this._last=De.Undefined):e.next===De.Undefined?(this._last=this._last.prev,this._last.next=De.Undefined):e.prev===De.Undefined&&(this._first=this._first.next,this._first.prev=De.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==De.Undefined;)yield e.element,e=e.next}},pg=globalThis.performance&&typeof globalThis.performance.now=="function",gg=class jh{static create(t){return new jh(t)}constructor(t){this._now=pg&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},it;(e=>{e.None=()=>ce.None;function t(N,E){return u(N,()=>{},0,void 0,!0,void 0,E)}e.defer=t;function s(N){return(E,O=null,U)=>{let H=!1,F;return F=N(P=>{if(!H)return F?F.dispose():H=!0,E.call(O,P)},null,U),H&&F.dispose(),F}}e.once=s;function i(N,E,O){return h((U,H=null,F)=>N(P=>U.call(H,E(P)),null,F),O)}e.map=i;function r(N,E,O){return h((U,H=null,F)=>N(P=>{E(P),U.call(H,P)},null,F),O)}e.forEach=r;function n(N,E,O){return h((U,H=null,F)=>N(P=>E(P)&&U.call(H,P),null,F),O)}e.filter=n;function o(N){return N}e.signal=o;function l(...N){return(E,O=null,U)=>{let H=_g(...N.map(F=>F(P=>E.call(O,P))));return c(H,U)}}e.any=l;function a(N,E,O,U){let H=O;return i(N,F=>(H=E(H,F),H),U)}e.reduce=a;function h(N,E){let O,U={onWillAddFirstListener(){O=N(H.fire,H)},onDidRemoveLastListener(){O==null||O.dispose()}},H=new W(U);return E==null||E.add(H),H.event}function c(N,E){return E instanceof Array?E.push(N):E&&E.add(N),N}function u(N,E,O=100,U=!1,H=!1,F,P){let _e,Me,He,Ae=0,tt,Ye={leakWarningThreshold:F,onWillAddFirstListener(){_e=N(We=>{Ae++,Me=E(Me,We),U&&!He&&(gt.fire(Me),Me=void 0),tt=()=>{let mt=Me;Me=void 0,He=void 0,(!U||Ae>1)&&gt.fire(mt),Ae=0},typeof O=="number"?(clearTimeout(He),He=setTimeout(tt,O)):He===void 0&&(He=0,queueMicrotask(tt))})},onWillRemoveListener(){H&&Ae>0&&(tt==null||tt())},onDidRemoveLastListener(){tt=void 0,_e.dispose()}},gt=new W(Ye);return P==null||P.add(gt),gt.event}e.debounce=u;function d(N,E=0,O){return e.debounce(N,(U,H)=>U?(U.push(H),U):[H],E,void 0,!0,void 0,O)}e.accumulate=d;function _(N,E=(U,H)=>U===H,O){let U=!0,H;return n(N,F=>{let P=U||!E(F,H);return U=!1,H=F,P},O)}e.latch=_;function p(N,E,O){return[e.filter(N,E,O),e.filter(N,U=>!E(U),O)]}e.split=p;function f(N,E=!1,O=[],U){let H=O.slice(),F=N(Me=>{H?H.push(Me):_e.fire(Me)});U&&U.add(F);let P=()=>{H==null||H.forEach(Me=>_e.fire(Me)),H=null},_e=new W({onWillAddFirstListener(){F||(F=N(Me=>_e.fire(Me)),U&&U.add(F))},onDidAddFirstListener(){H&&(E?setTimeout(P):P())},onDidRemoveLastListener(){F&&F.dispose(),F=null}});return U&&U.add(_e),_e.event}e.buffer=f;function v(N,E){return(O,U,H)=>{let F=E(new C);return N(function(P){let _e=F.evaluate(P);_e!==S&&O.call(U,_e)},void 0,H)}}e.chain=v;let S=Symbol("HaltChainable");class C{constructor(){this.steps=[]}map(E){return this.steps.push(E),this}forEach(E){return this.steps.push(O=>(E(O),O)),this}filter(E){return this.steps.push(O=>E(O)?O:S),this}reduce(E,O){let U=O;return this.steps.push(H=>(U=E(U,H),U)),this}latch(E=(O,U)=>O===U){let O=!0,U;return this.steps.push(H=>{let F=O||!E(H,U);return O=!1,U=H,F?H:S}),this}evaluate(E){for(let O of this.steps)if(E=O(E),E===S)break;return E}}function I(N,E,O=U=>U){let U=(..._e)=>P.fire(O(..._e)),H=()=>N.on(E,U),F=()=>N.removeListener(E,U),P=new W({onWillAddFirstListener:H,onDidRemoveLastListener:F});return P.event}e.fromNodeEventEmitter=I;function w(N,E,O=U=>U){let U=(..._e)=>P.fire(O(..._e)),H=()=>N.addEventListener(E,U),F=()=>N.removeEventListener(E,U),P=new W({onWillAddFirstListener:H,onDidRemoveLastListener:F});return P.event}e.fromDOMEventEmitter=w;function $(N){return new Promise(E=>s(N)(E))}e.toPromise=$;function J(N){let E=new W;return N.then(O=>{E.fire(O)},()=>{E.fire(void 0)}).finally(()=>{E.dispose()}),E.event}e.fromPromise=J;function re(N,E){return N(O=>E.fire(O))}e.forward=re;function X(N,E,O){return E(O),N(U=>E(U))}e.runAndSubscribe=X;class Z{constructor(E,O){this._observable=E,this._counter=0,this._hasChanged=!1;let U={onWillAddFirstListener:()=>{E.addObserver(this)},onDidRemoveLastListener:()=>{E.removeObserver(this)}};this.emitter=new W(U),O&&O.add(this.emitter)}beginUpdate(E){this._counter++}handlePossibleChange(E){}handleChange(E,O){this._hasChanged=!0}endUpdate(E){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function ge(N,E){return new Z(N,E).emitter.event}e.fromObservable=ge;function ne(N){return(E,O,U)=>{let H=0,F=!1,P={beginUpdate(){H++},endUpdate(){H--,H===0&&(N.reportChanges(),F&&(F=!1,E.call(O)))},handlePossibleChange(){},handleChange(){F=!0}};N.addObserver(P),N.reportChanges();let _e={dispose(){N.removeObserver(P)}};return U instanceof ws?U.add(_e):Array.isArray(U)&&U.push(_e),_e}}e.fromObservableLight=ne})(it||(it={}));var An=class On{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${On._idPool++}`,On.all.add(this)}start(t){this._stopWatch=new gg,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};An.all=new Set,An._idPool=0;var mg=An,vg=-1,qh=class Yh{constructor(t,s,i=(Yh._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=s,this.name=i,this._warnCountdown=0}dispose(){var t;(t=this._stacks)==null||t.clear()}check(t,s){let i=this.threshold;if(i<=0||s<i)return;this._stacks||(this._stacks=new Map);let r=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,r+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=i*.5;let[n,o]=this.getMostFrequentStack(),l=`[${this.name}] potential listener LEAK detected, having ${s} listeners already. MOST frequent listener (${o}):`;console.warn(l),console.warn(n);let a=new yg(l,n);this._errorHandler(a)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,s=0;for(let[i,r]of this._stacks)(!t||s<r)&&(t=[i,r],s=r);return t}};qh._idPool=1;var Sg=qh,bg=class Xh{constructor(t){this.value=t}static create(){let t=new Error;return new Xh(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},yg=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},wg=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},Cg=0,tn=class{constructor(e){this.value=e,this.id=Cg++}},xg=2,kg,W=class{constructor(e){var t,s,i,r;this._size=0,this._options=e,this._leakageMon=(t=this._options)!=null&&t.leakWarningThreshold?new Sg((e==null?void 0:e.onListenerError)??sr,((s=this._options)==null?void 0:s.leakWarningThreshold)??vg):void 0,this._perfMon=(i=this._options)!=null&&i._profName?new mg(this._options._profName):void 0,this._deliveryQueue=(r=this._options)==null?void 0:r.deliveryQueue}dispose(){var e,t,s,i;this._disposed||(this._disposed=!0,((e=this._deliveryQueue)==null?void 0:e.current)===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),(s=(t=this._options)==null?void 0:t.onDidRemoveLastListener)==null||s.call(t),(i=this._leakageMon)==null||i.dispose())}get event(){return this._event??(this._event=(e,t,s)=>{var o,l,a,h,c;if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let u=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(u);let d=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],_=new wg(`${u}. HINT: Stack shows most frequent listener (${d[1]}-times)`,d[0]);return(((o=this._options)==null?void 0:o.onListenerError)||sr)(_),ce.None}if(this._disposed)return ce.None;t&&(e=e.bind(t));let i=new tn(e),r;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(i.stack=bg.create(),r=this._leakageMon.check(i.stack,this._size+1)),this._listeners?this._listeners instanceof tn?(this._deliveryQueue??(this._deliveryQueue=new Eg),this._listeners=[this._listeners,i]):this._listeners.push(i):((a=(l=this._options)==null?void 0:l.onWillAddFirstListener)==null||a.call(l,this),this._listeners=i,(c=(h=this._options)==null?void 0:h.onDidAddFirstListener)==null||c.call(h,this)),this._size++;let n=Re(()=>{r==null||r(),this._removeListener(i)});return s instanceof ws?s.add(n):Array.isArray(s)&&s.push(n),n}),this._event}_removeListener(e){var r,n,o,l;if((n=(r=this._options)==null?void 0:r.onWillRemoveListener)==null||n.call(r,this),!this._listeners)return;if(this._size===1){this._listeners=void 0,(l=(o=this._options)==null?void 0:o.onDidRemoveLastListener)==null||l.call(o,this),this._size=0;return}let t=this._listeners,s=t.indexOf(e);if(s===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[s]=void 0;let i=this._deliveryQueue.current===this;if(this._size*xg<=t.length){let a=0;for(let h=0;h<t.length;h++)t[h]?t[a++]=t[h]:i&&(this._deliveryQueue.end--,a<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=a}}_deliver(e,t){var i;if(!e)return;let s=((i=this._options)==null?void 0:i.onListenerError)||sr;if(!s){e.value(t);return}try{e.value(t)}catch(r){s(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){var t,s,i,r;if((t=this._deliveryQueue)!=null&&t.current&&(this._deliverQueue(this._deliveryQueue),(s=this._perfMon)==null||s.stop()),(i=this._perfMon)==null||i.start(this._size),this._listeners)if(this._listeners instanceof tn)this._deliver(this._listeners,e);else{let n=this._deliveryQueue;n.enqueue(this,e,this._listeners.length),this._deliverQueue(n)}(r=this._perfMon)==null||r.stop()}hasListeners(){return this._size>0}},Eg=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,s){this.i=0,this.end=s,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},Nn=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new W,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new W,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(t){return this.mapWindowIdToZoomLevel.get(this.getWindowId(t))??0}setZoomLevel(t,s){if(this.getZoomLevel(s)===t)return;let i=this.getWindowId(s);this.mapWindowIdToZoomLevel.set(i,t),this._onDidChangeZoomLevel.fire(i)}getZoomFactor(t){return this.mapWindowIdToZoomFactor.get(this.getWindowId(t))??1}setZoomFactor(t,s){this.mapWindowIdToZoomFactor.set(this.getWindowId(s),t)}setFullscreen(t,s){if(this.isFullscreen(s)===t)return;let i=this.getWindowId(s);this.mapWindowIdToFullScreen.set(i,t),this._onDidChangeFullscreen.fire(i)}isFullscreen(t){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(t))}getWindowId(t){return t.vscodeWindowId}};Nn.INSTANCE=new Nn;var Ro=Nn;function Mg(e,t,s){typeof t=="string"&&(t=e.matchMedia(t)),t.addEventListener("change",s)}Ro.INSTANCE.onDidChangeZoomLevel;function Rg(e){return Ro.INSTANCE.getZoomFactor(e)}Ro.INSTANCE.onDidChangeFullscreen;var ti=typeof navigator=="object"?navigator.userAgent:"",$n=ti.indexOf("Firefox")>=0,Bg=ti.indexOf("AppleWebKit")>=0,Bo=ti.indexOf("Chrome")>=0,Dg=!Bo&&ti.indexOf("Safari")>=0;ti.indexOf("Electron/")>=0;ti.indexOf("Android")>=0;var sn=!1;if(typeof ss.matchMedia=="function"){let e=ss.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),t=ss.matchMedia("(display-mode: fullscreen)");sn=e.matches,Mg(ss,e,({matches:s})=>{sn&&t.matches||(sn=s)})}var js="en",Hn=!1,Wn=!1,ir=!1,Gh=!1,Vi,rr=js,kl=js,Tg,It,Os=globalThis,st,fa;typeof Os.vscode<"u"&&typeof Os.vscode.process<"u"?st=Os.vscode.process:typeof process<"u"&&typeof((fa=process==null?void 0:process.versions)==null?void 0:fa.node)=="string"&&(st=process);var _a,Pg=typeof((_a=st==null?void 0:st.versions)==null?void 0:_a.electron)=="string",Lg=Pg&&(st==null?void 0:st.type)==="renderer",pa;if(typeof st=="object"){Hn=st.platform==="win32",Wn=st.platform==="darwin",ir=st.platform==="linux",ir&&st.env.SNAP&&st.env.SNAP_REVISION,st.env.CI||st.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Vi=js,rr=js;let e=st.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);Vi=t.userLocale,kl=t.osLocale,rr=t.resolvedLanguage||js,Tg=(pa=t.languagePack)==null?void 0:pa.translationsConfigFile}catch{}Gh=!0}else typeof navigator=="object"&&!Lg?(It=navigator.userAgent,Hn=It.indexOf("Windows")>=0,Wn=It.indexOf("Macintosh")>=0,(It.indexOf("Macintosh")>=0||It.indexOf("iPad")>=0||It.indexOf("iPhone")>=0)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0,ir=It.indexOf("Linux")>=0,(It==null?void 0:It.indexOf("Mobi"))>=0,rr=globalThis._VSCODE_NLS_LANGUAGE||js,Vi=navigator.language.toLowerCase(),kl=Vi):console.error("Unable to resolve platform.");var Jh=Hn,jt=Wn,Ig=ir,El=Gh,Yt=It,ds=rr,Ag;(e=>{function t(){return ds}e.value=t;function s(){return ds.length===2?ds==="en":ds.length>=3?ds[0]==="e"&&ds[1]==="n"&&ds[2]==="-":!1}e.isDefaultVariant=s;function i(){return ds==="en"}e.isDefault=i})(Ag||(Ag={}));var Og=typeof Os.postMessage=="function"&&!Os.importScripts;(()=>{if(Og){let e=[];Os.addEventListener("message",s=>{if(s.data&&s.data.vscodeScheduleAsyncWork)for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.id===s.data.vscodeScheduleAsyncWork){e.splice(i,1),n.callback();return}}});let t=0;return s=>{let i=++t;e.push({id:i,callback:s}),Os.postMessage({vscodeScheduleAsyncWork:i},"*")}}return e=>setTimeout(e)})();var Ng=!!(Yt&&Yt.indexOf("Chrome")>=0);Yt&&Yt.indexOf("Firefox")>=0;!Ng&&Yt&&Yt.indexOf("Safari")>=0;Yt&&Yt.indexOf("Edg/")>=0;Yt&&Yt.indexOf("Android")>=0;var zs=typeof navigator=="object"?navigator:{};El||document.queryCommandSupported&&document.queryCommandSupported("copy")||zs&&zs.clipboard&&zs.clipboard.writeText,El||zs&&zs.clipboard&&zs.clipboard.readText;var Do=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}},rn=new Do,Ml=new Do,Rl=new Do,$g=new Array(230),Zh;(e=>{function t(l){return rn.keyCodeToStr(l)}e.toString=t;function s(l){return rn.strToKeyCode(l)}e.fromString=s;function i(l){return Ml.keyCodeToStr(l)}e.toUserSettingsUS=i;function r(l){return Rl.keyCodeToStr(l)}e.toUserSettingsGeneral=r;function n(l){return Ml.strToKeyCode(l)||Rl.strToKeyCode(l)}e.fromUserSettings=n;function o(l){if(l>=98&&l<=113)return null;switch(l){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return rn.keyCodeToStr(l)}e.toElectronAccelerator=o})(Zh||(Zh={}));var Hg=class Qh{constructor(t,s,i,r,n){this.ctrlKey=t,this.shiftKey=s,this.altKey=i,this.metaKey=r,this.keyCode=n}equals(t){return t instanceof Qh&&this.ctrlKey===t.ctrlKey&&this.shiftKey===t.shiftKey&&this.altKey===t.altKey&&this.metaKey===t.metaKey&&this.keyCode===t.keyCode}getHashCode(){let t=this.ctrlKey?"1":"0",s=this.shiftKey?"1":"0",i=this.altKey?"1":"0",r=this.metaKey?"1":"0";return`K${t}${s}${i}${r}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new Wg([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},Wg=class{constructor(e){if(e.length===0)throw ug("chords");this.chords=e}getHashCode(){let e="";for(let t=0,s=this.chords.length;t<s;t++)t!==0&&(e+=";"),e+=this.chords[t].getHashCode();return e}equals(e){if(e===null||this.chords.length!==e.chords.length)return!1;for(let t=0;t<this.chords.length;t++)if(!this.chords[t].equals(e.chords[t]))return!1;return!0}};function Fg(e){if(e.charCode){let s=String.fromCharCode(e.charCode).toUpperCase();return Zh.fromString(s)}let t=e.keyCode;if(t===3)return 7;if($n)switch(t){case 59:return 85;case 60:if(Ig)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(jt)return 57;break}else if(Bg&&(jt&&t===93||!jt&&t===92))return 57;return $g[t]||0}var zg=jt?256:2048,Kg=512,Ug=1024,Vg=jt?2048:256,Bl=class{constructor(e){var s;this._standardKeyboardEventBrand=!0;let t=e;this.browserEvent=t,this.target=t.target,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.altGraphKey=(s=t.getModifierState)==null?void 0:s.call(t,"AltGraph"),this.keyCode=Fg(t),this.code=t.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(e){return this._asKeybinding===e}_computeKeybinding(){let e=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode);let t=0;return this.ctrlKey&&(t|=zg),this.altKey&&(t|=Kg),this.shiftKey&&(t|=Ug),this.metaKey&&(t|=Vg),t|=e,t}_computeKeyCodeChord(){let e=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode),new Hg(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}},Dl=new WeakMap;function jg(e){if(!e.parent||e.parent===e)return null;try{let t=e.location,s=e.parent.location;if(t.origin!=="null"&&s.origin!=="null"&&t.origin!==s.origin)return null}catch{return null}return e.parent}var qg=class{static getSameOriginWindowChain(e){let t=Dl.get(e);if(!t){t=[],Dl.set(e,t);let s=e,i;do i=jg(s),i?t.push({window:new WeakRef(s),iframeElement:s.frameElement||null}):t.push({window:new WeakRef(s),iframeElement:null}),s=i;while(s)}return t.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(e,t){if(!t||e===t)return{top:0,left:0};let s=0,i=0,r=this.getSameOriginWindowChain(e);for(let n of r){let o=n.window.deref();if(s+=(o==null?void 0:o.scrollY)??0,i+=(o==null?void 0:o.scrollX)??0,o===t||!n.iframeElement)break;let l=n.iframeElement.getBoundingClientRect();s+=l.top,i+=l.left}return{top:s,left:i}}},ji=class{constructor(e,t){this.timestamp=Date.now(),this.browserEvent=t,this.leftButton=t.button===0,this.middleButton=t.button===1,this.rightButton=t.button===2,this.buttons=t.buttons,this.target=t.target,this.detail=t.detail||1,t.type==="dblclick"&&(this.detail=2),this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,typeof t.pageX=="number"?(this.posx=t.pageX,this.posy=t.pageY):(this.posx=t.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=t.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let s=qg.getPositionOfChildWindowRelativeToAncestorWindow(e,t.view);this.posx-=s.left,this.posy-=s.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},Tl=class{constructor(e,t=0,s=0){var r;this.browserEvent=e||null,this.target=e?e.target||e.targetNode||e.srcElement:null,this.deltaY=s,this.deltaX=t;let i=!1;if(Bo){let n=navigator.userAgent.match(/Chrome\/(\d+)/);i=(n?parseInt(n[1]):123)<=122}if(e){let n=e,o=e,l=((r=e.view)==null?void 0:r.devicePixelRatio)||1;if(typeof n.wheelDeltaY<"u")i?this.deltaY=n.wheelDeltaY/(120*l):this.deltaY=n.wheelDeltaY/120;else if(typeof o.VERTICAL_AXIS<"u"&&o.axis===o.VERTICAL_AXIS)this.deltaY=-o.detail/3;else if(e.type==="wheel"){let a=e;a.deltaMode===a.DOM_DELTA_LINE?$n&&!jt?this.deltaY=-e.deltaY/3:this.deltaY=-e.deltaY:this.deltaY=-e.deltaY/40}if(typeof n.wheelDeltaX<"u")Dg&&Jh?this.deltaX=-(n.wheelDeltaX/120):i?this.deltaX=n.wheelDeltaX/(120*l):this.deltaX=n.wheelDeltaX/120;else if(typeof o.HORIZONTAL_AXIS<"u"&&o.axis===o.HORIZONTAL_AXIS)this.deltaX=-e.detail/3;else if(e.type==="wheel"){let a=e;a.deltaMode===a.DOM_DELTA_LINE?$n&&!jt?this.deltaX=-e.deltaX/3:this.deltaX=-e.deltaX:this.deltaX=-e.deltaX/40}this.deltaY===0&&this.deltaX===0&&e.wheelDelta&&(i?this.deltaY=e.wheelDelta/(120*l):this.deltaY=e.wheelDelta/120)}}preventDefault(){var e;(e=this.browserEvent)==null||e.preventDefault()}stopPropagation(){var e;(e=this.browserEvent)==null||e.stopPropagation()}},ec=Object.freeze(function(e,t){let s=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(s)}}}),Yg;(e=>{function t(s){return s===e.None||s===e.Cancelled||s instanceof Xg?!0:!s||typeof s!="object"?!1:typeof s.isCancellationRequested=="boolean"&&typeof s.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:it.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:ec})})(Yg||(Yg={}));var Xg=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?ec:(this._emitter||(this._emitter=new W),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},To=class{constructor(e,t){this._isDisposed=!1,this._token=-1,typeof e=="function"&&typeof t=="number"&&this.setIfNotSet(e,t)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(e,t){if(this._isDisposed)throw new Pn("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,e()},t)}setIfNotSet(e,t){if(this._isDisposed)throw new Pn("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,e()},t))}},Gg=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){var e;(e=this.disposable)==null||e.dispose(),this.disposable=void 0}cancelAndSet(e,t,s=globalThis){if(this.isDisposed)throw new Pn("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let i=s.setInterval(()=>{e()},t);this.disposable=Re(()=>{s.clearInterval(i),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},Jg;(e=>{async function t(i){let r,n=await Promise.all(i.map(o=>o.then(l=>l,l=>{r||(r=l)})));if(typeof r<"u")throw r;return n}e.settled=t;function s(i){return new Promise(async(r,n)=>{try{await i(r,n)}catch(o){n(o)}})}e.withAsyncBody=s})(Jg||(Jg={}));var Pl=class Bt{static fromArray(t){return new Bt(s=>{s.emitMany(t)})}static fromPromise(t){return new Bt(async s=>{s.emitMany(await t)})}static fromPromises(t){return new Bt(async s=>{await Promise.all(t.map(async i=>s.emitOne(await i)))})}static merge(t){return new Bt(async s=>{await Promise.all(t.map(async i=>{for await(let r of i)s.emitOne(r)}))})}constructor(t,s){this._state=0,this._results=[],this._error=null,this._onReturn=s,this._onStateChanged=new W,queueMicrotask(async()=>{let i={emitOne:r=>this.emitOne(r),emitMany:r=>this.emitMany(r),reject:r=>this.reject(r)};try{await Promise.resolve(t(i)),this.resolve()}catch(r){this.reject(r)}finally{i.emitOne=void 0,i.emitMany=void 0,i.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await it.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>{var s;return(s=this._onReturn)==null||s.call(this),{done:!0,value:void 0}}}}static map(t,s){return new Bt(async i=>{for await(let r of t)i.emitOne(s(r))})}map(t){return Bt.map(this,t)}static filter(t,s){return new Bt(async i=>{for await(let r of t)s(r)&&i.emitOne(r)})}filter(t){return Bt.filter(this,t)}static coalesce(t){return Bt.filter(t,s=>!!s)}coalesce(){return Bt.coalesce(this)}static async toPromise(t){let s=[];for await(let i of t)s.push(i);return s}toPromise(){return Bt.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};Pl.EMPTY=Pl.fromArray([]);var{getWindow:Ut,getWindowId:Zg,onDidRegisterWindow:Qg}=(function(){let e=new Map,t={window:ss,disposables:new ws};e.set(ss.vscodeWindowId,t);let s=new W,i=new W,r=new W;function n(o,l){return(typeof o=="number"?e.get(o):void 0)??(l?t:void 0)}return{onDidRegisterWindow:s.event,onWillUnregisterWindow:r.event,onDidUnregisterWindow:i.event,registerWindow(o){if(e.has(o.vscodeWindowId))return ce.None;let l=new ws,a={window:o,disposables:l.add(new ws)};return e.set(o.vscodeWindowId,a),l.add(Re(()=>{e.delete(o.vscodeWindowId),i.fire(o)})),l.add(se(o,Ge.BEFORE_UNLOAD,()=>{r.fire(o)})),s.fire(a),l},getWindows(){return e.values()},getWindowsCount(){return e.size},getWindowId(o){return o.vscodeWindowId},hasWindow(o){return e.has(o)},getWindowById:n,getWindow(o){var h;let l=o;if((h=l==null?void 0:l.ownerDocument)!=null&&h.defaultView)return l.ownerDocument.defaultView.window;let a=o;return a!=null&&a.view?a.view.window:ss},getDocument(o){return Ut(o).document}}})(),em=class{constructor(e,t,s,i){this._node=e,this._type=t,this._handler=s,this._options=i||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function se(e,t,s,i){return new em(e,t,s,i)}var Ll=function(e,t,s,i){return se(e,t,s,i)},Po,tm=class extends Gg{constructor(e){super(),this.defaultTarget=e&&Ut(e)}cancelAndSet(e,t,s){return super.cancelAndSet(e,t,s??this.defaultTarget)}},Il=class{constructor(e,t=0){this._runner=e,this.priority=t,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(e){sr(e)}}static sort(e,t){return t.priority-e.priority}};(function(){let e=new Map,t=new Map,s=new Map,i=new Map,r=n=>{s.set(n,!1);let o=e.get(n)??[];for(t.set(n,o),e.set(n,[]),i.set(n,!0);o.length>0;)o.sort(Il.sort),o.shift().execute();i.set(n,!1)};Po=(n,o,l=0)=>{let a=Zg(n),h=new Il(o,l),c=e.get(a);return c||(c=[],e.set(a,c)),c.push(h),s.get(a)||(s.set(a,!0),n.requestAnimationFrame(()=>r(a))),h}})();function sm(e){let t=e.getBoundingClientRect(),s=Ut(e);return{left:t.left+s.scrollX,top:t.top+s.scrollY,width:t.width,height:t.height}}var Ge={CLICK:"click",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",KEY_DOWN:"keydown",KEY_UP:"keyup",BEFORE_UNLOAD:"beforeunload",CHANGE:"change",FOCUS:"focus",BLUR:"blur",INPUT:"input"},im=class{constructor(e){this.domNode=e,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(e){let t=St(e);this._maxWidth!==t&&(this._maxWidth=t,this.domNode.style.maxWidth=this._maxWidth)}setWidth(e){let t=St(e);this._width!==t&&(this._width=t,this.domNode.style.width=this._width)}setHeight(e){let t=St(e);this._height!==t&&(this._height=t,this.domNode.style.height=this._height)}setTop(e){let t=St(e);this._top!==t&&(this._top=t,this.domNode.style.top=this._top)}setLeft(e){let t=St(e);this._left!==t&&(this._left=t,this.domNode.style.left=this._left)}setBottom(e){let t=St(e);this._bottom!==t&&(this._bottom=t,this.domNode.style.bottom=this._bottom)}setRight(e){let t=St(e);this._right!==t&&(this._right=t,this.domNode.style.right=this._right)}setPaddingTop(e){let t=St(e);this._paddingTop!==t&&(this._paddingTop=t,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(e){let t=St(e);this._paddingLeft!==t&&(this._paddingLeft=t,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(e){let t=St(e);this._paddingBottom!==t&&(this._paddingBottom=t,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(e){let t=St(e);this._paddingRight!==t&&(this._paddingRight=t,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(e){let t=St(e);this._fontSize!==t&&(this._fontSize=t,this.domNode.style.fontSize=this._fontSize)}setFontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(e){this._fontFeatureSettings!==e&&(this._fontFeatureSettings=e,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(e){this._fontVariationSettings!==e&&(this._fontVariationSettings=e,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(e){this._textDecoration!==e&&(this._textDecoration=e,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(e){let t=St(e);this._lineHeight!==t&&(this._lineHeight=t,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(e){let t=St(e);this._letterSpacing!==t&&(this._letterSpacing=t,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(e){this._className!==e&&(this._className=e,this.domNode.className=this._className)}toggleClassName(e,t){this.domNode.classList.toggle(e,t),this._className=this.domNode.className}setDisplay(e){this._display!==e&&(this._display=e,this.domNode.style.display=this._display)}setPosition(e){this._position!==e&&(this._position=e,this.domNode.style.position=this._position)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this.domNode.style.visibility=this._visibility)}setColor(e){this._color!==e&&(this._color=e,this.domNode.style.color=this._color)}setBackgroundColor(e){this._backgroundColor!==e&&(this._backgroundColor=e,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(e){this._layerHint!==e&&(this._layerHint=e,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(e){this._boxShadow!==e&&(this._boxShadow=e,this.domNode.style.boxShadow=e)}setContain(e){this._contain!==e&&(this._contain=e,this.domNode.style.contain=this._contain)}setAttribute(e,t){this.domNode.setAttribute(e,t)}removeAttribute(e){this.domNode.removeAttribute(e)}appendChild(e){this.domNode.appendChild(e.domNode)}removeChild(e){this.domNode.removeChild(e.domNode)}};function St(e){return typeof e=="number"?`${e}px`:e}function Ei(e){return new im(e)}var tc=class{constructor(){this._hooks=new ws,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(e,t){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let s=this._onStopCallback;this._onStopCallback=null,e&&s&&s(t)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(e,t,s,i,r){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=i,this._onStopCallback=r;let n=e;try{e.setPointerCapture(t),this._hooks.add(Re(()=>{try{e.releasePointerCapture(t)}catch{}}))}catch{n=Ut(e)}this._hooks.add(se(n,Ge.POINTER_MOVE,o=>{if(o.buttons!==s){this.stopMonitoring(!0);return}o.preventDefault(),this._pointerMoveCallback(o)})),this._hooks.add(se(n,Ge.POINTER_UP,o=>this.stopMonitoring(!0)))}};function rm(e,t,s){let i=null,r=null;if(typeof s.value=="function"?(i="value",r=s.value,r.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof s.get=="function"&&(i="get",r=s.get),!r)throw new Error("not supported");let n=`$memoize$${t}`;s[i]=function(...o){return this.hasOwnProperty(n)||Object.defineProperty(this,n,{configurable:!1,enumerable:!1,writable:!1,value:r.apply(this,o)}),this[n]}}var Wt;(e=>(e.Tap="-xterm-gesturetap",e.Change="-xterm-gesturechange",e.Start="-xterm-gesturestart",e.End="-xterm-gesturesend",e.Contextmenu="-xterm-gesturecontextmenu"))(Wt||(Wt={}));var di=class rt extends ce{constructor(){super(),this.dispatched=!1,this.targets=new xl,this.ignoreTargets=new xl,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(it.runAndSubscribe(Qg,({window:t,disposables:s})=>{s.add(se(t.document,"touchstart",i=>this.onTouchStart(i),{passive:!1})),s.add(se(t.document,"touchend",i=>this.onTouchEnd(t,i))),s.add(se(t.document,"touchmove",i=>this.onTouchMove(i),{passive:!1}))},{window:ss,disposables:this._store}))}static addTarget(t){if(!rt.isTouchDevice())return ce.None;rt.INSTANCE||(rt.INSTANCE=new rt);let s=rt.INSTANCE.targets.push(t);return Re(s)}static ignoreTarget(t){if(!rt.isTouchDevice())return ce.None;rt.INSTANCE||(rt.INSTANCE=new rt);let s=rt.INSTANCE.ignoreTargets.push(t);return Re(s)}static isTouchDevice(){return"ontouchstart"in ss||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(t){let s=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let i=0,r=t.targetTouches.length;i<r;i++){let n=t.targetTouches.item(i);this.activeTouches[n.identifier]={id:n.identifier,initialTarget:n.target,initialTimeStamp:s,initialPageX:n.pageX,initialPageY:n.pageY,rollingTimestamps:[s],rollingPageX:[n.pageX],rollingPageY:[n.pageY]};let o=this.newGestureEvent(Wt.Start,n.target);o.pageX=n.pageX,o.pageY=n.pageY,this.dispatchEvent(o)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}onTouchEnd(t,s){let i=Date.now(),r=Object.keys(this.activeTouches).length;for(let n=0,o=s.changedTouches.length;n<o;n++){let l=s.changedTouches.item(n);if(!this.activeTouches.hasOwnProperty(String(l.identifier))){console.warn("move of an UNKNOWN touch",l);continue}let a=this.activeTouches[l.identifier],h=Date.now()-a.initialTimeStamp;if(h<rt.HOLD_DELAY&&Math.abs(a.initialPageX-yt(a.rollingPageX))<30&&Math.abs(a.initialPageY-yt(a.rollingPageY))<30){let c=this.newGestureEvent(Wt.Tap,a.initialTarget);c.pageX=yt(a.rollingPageX),c.pageY=yt(a.rollingPageY),this.dispatchEvent(c)}else if(h>=rt.HOLD_DELAY&&Math.abs(a.initialPageX-yt(a.rollingPageX))<30&&Math.abs(a.initialPageY-yt(a.rollingPageY))<30){let c=this.newGestureEvent(Wt.Contextmenu,a.initialTarget);c.pageX=yt(a.rollingPageX),c.pageY=yt(a.rollingPageY),this.dispatchEvent(c)}else if(r===1){let c=yt(a.rollingPageX),u=yt(a.rollingPageY),d=yt(a.rollingTimestamps)-a.rollingTimestamps[0],_=c-a.rollingPageX[0],p=u-a.rollingPageY[0],f=[...this.targets].filter(v=>a.initialTarget instanceof Node&&v.contains(a.initialTarget));this.inertia(t,f,i,Math.abs(_)/d,_>0?1:-1,c,Math.abs(p)/d,p>0?1:-1,u)}this.dispatchEvent(this.newGestureEvent(Wt.End,a.initialTarget)),delete this.activeTouches[l.identifier]}this.dispatched&&(s.preventDefault(),s.stopPropagation(),this.dispatched=!1)}newGestureEvent(t,s){let i=document.createEvent("CustomEvent");return i.initEvent(t,!1,!0),i.initialTarget=s,i.tapCount=0,i}dispatchEvent(t){if(t.type===Wt.Tap){let s=new Date().getTime(),i=0;s-this._lastSetTapCountTime>rt.CLEAR_TAP_COUNT_TIME?i=1:i=2,this._lastSetTapCountTime=s,t.tapCount=i}else(t.type===Wt.Change||t.type===Wt.Contextmenu)&&(this._lastSetTapCountTime=0);if(t.initialTarget instanceof Node){for(let i of this.ignoreTargets)if(i.contains(t.initialTarget))return;let s=[];for(let i of this.targets)if(i.contains(t.initialTarget)){let r=0,n=t.initialTarget;for(;n&&n!==i;)r++,n=n.parentElement;s.push([r,i])}s.sort((i,r)=>i[0]-r[0]);for(let[i,r]of s)r.dispatchEvent(t),this.dispatched=!0}}inertia(t,s,i,r,n,o,l,a,h){this.handle=Po(t,()=>{let c=Date.now(),u=c-i,d=0,_=0,p=!0;r+=rt.SCROLL_FRICTION*u,l+=rt.SCROLL_FRICTION*u,r>0&&(p=!1,d=n*r*u),l>0&&(p=!1,_=a*l*u);let f=this.newGestureEvent(Wt.Change);f.translationX=d,f.translationY=_,s.forEach(v=>v.dispatchEvent(f)),p||this.inertia(t,s,c,r,n,o+d,l,a,h+_)})}onTouchMove(t){let s=Date.now();for(let i=0,r=t.changedTouches.length;i<r;i++){let n=t.changedTouches.item(i);if(!this.activeTouches.hasOwnProperty(String(n.identifier))){console.warn("end of an UNKNOWN touch",n);continue}let o=this.activeTouches[n.identifier],l=this.newGestureEvent(Wt.Change,o.initialTarget);l.translationX=n.pageX-yt(o.rollingPageX),l.translationY=n.pageY-yt(o.rollingPageY),l.pageX=n.pageX,l.pageY=n.pageY,this.dispatchEvent(l),o.rollingPageX.length>3&&(o.rollingPageX.shift(),o.rollingPageY.shift(),o.rollingTimestamps.shift()),o.rollingPageX.push(n.pageX),o.rollingPageY.push(n.pageY),o.rollingTimestamps.push(s)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}};di.SCROLL_FRICTION=-.005,di.HOLD_DELAY=700,di.CLEAR_TAP_COUNT_TIME=400,Ie([rm],di,"isTouchDevice",1);var nm=di,Lo=class extends ce{onclick(e,t){this._register(se(e,Ge.CLICK,s=>t(new ji(Ut(e),s))))}onmousedown(e,t){this._register(se(e,Ge.MOUSE_DOWN,s=>t(new ji(Ut(e),s))))}onmouseover(e,t){this._register(se(e,Ge.MOUSE_OVER,s=>t(new ji(Ut(e),s))))}onmouseleave(e,t){this._register(se(e,Ge.MOUSE_LEAVE,s=>t(new ji(Ut(e),s))))}onkeydown(e,t){this._register(se(e,Ge.KEY_DOWN,s=>t(new Bl(s))))}onkeyup(e,t){this._register(se(e,Ge.KEY_UP,s=>t(new Bl(s))))}oninput(e,t){this._register(se(e,Ge.INPUT,t))}onblur(e,t){this._register(se(e,Ge.BLUR,t))}onfocus(e,t){this._register(se(e,Ge.FOCUS,t))}onchange(e,t){this._register(se(e,Ge.CHANGE,t))}ignoreGesture(e){return nm.ignoreTarget(e)}},Al=11,om=class extends Lo{constructor(e){super(),this._onActivate=e.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=e.bgWidth+"px",this.bgDomNode.style.height=e.bgHeight+"px",typeof e.top<"u"&&(this.bgDomNode.style.top="0px"),typeof e.left<"u"&&(this.bgDomNode.style.left="0px"),typeof e.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof e.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=e.className,this.domNode.style.position="absolute",this.domNode.style.width=Al+"px",this.domNode.style.height=Al+"px",typeof e.top<"u"&&(this.domNode.style.top=e.top+"px"),typeof e.left<"u"&&(this.domNode.style.left=e.left+"px"),typeof e.bottom<"u"&&(this.domNode.style.bottom=e.bottom+"px"),typeof e.right<"u"&&(this.domNode.style.right=e.right+"px"),this._pointerMoveMonitor=this._register(new tc),this._register(Ll(this.bgDomNode,Ge.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._register(Ll(this.domNode,Ge.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._pointerdownRepeatTimer=this._register(new tm),this._pointerdownScheduleRepeatTimer=this._register(new To)}_arrowPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),1e3/24,Ut(e))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(t,200),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,s=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),e.preventDefault()}},lm=class Fn{constructor(t,s,i,r,n,o,l){this._forceIntegerValues=t,this._scrollStateBrand=void 0,this._forceIntegerValues&&(s=s|0,i=i|0,r=r|0,n=n|0,o=o|0,l=l|0),this.rawScrollLeft=r,this.rawScrollTop=l,s<0&&(s=0),r+s>i&&(r=i-s),r<0&&(r=0),n<0&&(n=0),l+n>o&&(l=o-n),l<0&&(l=0),this.width=s,this.scrollWidth=i,this.scrollLeft=r,this.height=n,this.scrollHeight=o,this.scrollTop=l}equals(t){return this.rawScrollLeft===t.rawScrollLeft&&this.rawScrollTop===t.rawScrollTop&&this.width===t.width&&this.scrollWidth===t.scrollWidth&&this.scrollLeft===t.scrollLeft&&this.height===t.height&&this.scrollHeight===t.scrollHeight&&this.scrollTop===t.scrollTop}withScrollDimensions(t,s){return new Fn(this._forceIntegerValues,typeof t.width<"u"?t.width:this.width,typeof t.scrollWidth<"u"?t.scrollWidth:this.scrollWidth,s?this.rawScrollLeft:this.scrollLeft,typeof t.height<"u"?t.height:this.height,typeof t.scrollHeight<"u"?t.scrollHeight:this.scrollHeight,s?this.rawScrollTop:this.scrollTop)}withScrollPosition(t){return new Fn(this._forceIntegerValues,this.width,this.scrollWidth,typeof t.scrollLeft<"u"?t.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof t.scrollTop<"u"?t.scrollTop:this.rawScrollTop)}createScrollEvent(t,s){let i=this.width!==t.width,r=this.scrollWidth!==t.scrollWidth,n=this.scrollLeft!==t.scrollLeft,o=this.height!==t.height,l=this.scrollHeight!==t.scrollHeight,a=this.scrollTop!==t.scrollTop;return{inSmoothScrolling:s,oldWidth:t.width,oldScrollWidth:t.scrollWidth,oldScrollLeft:t.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:t.height,oldScrollHeight:t.scrollHeight,oldScrollTop:t.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:i,scrollWidthChanged:r,scrollLeftChanged:n,heightChanged:o,scrollHeightChanged:l,scrollTopChanged:a}}},am=class extends ce{constructor(e){super(),this._scrollableBrand=void 0,this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this._smoothScrollDuration=e.smoothScrollDuration,this._scheduleAtNextAnimationFrame=e.scheduleAtNextAnimationFrame,this._state=new lm(e.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(e){this._smoothScrollDuration=e}validateScrollPosition(e){return this._state.withScrollPosition(e)}getScrollDimensions(){return this._state}setScrollDimensions(e,t){var i;let s=this._state.withScrollDimensions(e,t);this._setState(s,!!this._smoothScrolling),(i=this._smoothScrolling)==null||i.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(e){let t=this._state.withScrollPosition(e);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(t,!1)}setScrollPositionSmooth(e,t){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(e);if(this._smoothScrolling){e={scrollLeft:typeof e.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:e.scrollLeft,scrollTop:typeof e.scrollTop>"u"?this._smoothScrolling.to.scrollTop:e.scrollTop};let s=this._state.withScrollPosition(e);if(this._smoothScrolling.to.scrollLeft===s.scrollLeft&&this._smoothScrolling.to.scrollTop===s.scrollTop)return;let i;t?i=new Nl(this._smoothScrolling.from,s,this._smoothScrolling.startTime,this._smoothScrolling.duration):i=this._smoothScrolling.combine(this._state,s,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=i}else{let s=this._state.withScrollPosition(e);this._smoothScrolling=Nl.start(this._state,s,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let e=this._smoothScrolling.tick(),t=this._state.withScrollPosition(e);if(this._setState(t,!0),!!this._smoothScrolling){if(e.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(e,t){let s=this._state;s.equals(e)||(this._state=e,this._onScroll.fire(this._state.createScrollEvent(s,t)))}},Ol=class{constructor(e,t,s){this.scrollLeft=e,this.scrollTop=t,this.isDone=s}};function nn(e,t){let s=t-e;return function(i){return e+s*um(i)}}function hm(e,t,s){return function(i){return i<s?e(i/s):t((i-s)/(1-s))}}var Nl=class zn{constructor(t,s,i,r){this.from=t,this.to=s,this.duration=r,this.startTime=i,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(t,s,i){if(Math.abs(t-s)>2.5*i){let r,n;return t<s?(r=t+.75*i,n=s-.75*i):(r=t-.75*i,n=s+.75*i),hm(nn(t,r),nn(n,s),.33)}return nn(t,s)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(t){this.to=t.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(t){let s=(t-this.startTime)/this.duration;if(s<1){let i=this.scrollLeft(s),r=this.scrollTop(s);return new Ol(i,r,!1)}return new Ol(this.to.scrollLeft,this.to.scrollTop,!0)}combine(t,s,i){return zn.start(t,s,i)}static start(t,s,i){i=i+10;let r=Date.now()-10;return new zn(t,s,r,i)}};function cm(e){return Math.pow(e,3)}function um(e){return 1-cm(1-e)}var dm=class extends ce{constructor(e,t,s){super(),this._visibility=e,this._visibleClassName=t,this._invisibleClassName=s,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new To)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this._updateShouldBeVisible())}setShouldBeVisible(e){this._rawShouldBeVisible=e,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let e=this._applyVisibilitySetting();this._shouldBeVisible!==e&&(this._shouldBeVisible=e,this.ensureVisibility())}setIsNeeded(e){this._isNeeded!==e&&(this._isNeeded=e,this.ensureVisibility())}setDomNode(e){this._domNode=e,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{var e;(e=this._domNode)==null||e.setClassName(this._visibleClassName)},0))}_hide(e){var t;this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,(t=this._domNode)==null||t.setClassName(this._invisibleClassName+(e?" fade":"")))}},fm=140,sc=class extends Lo{constructor(e){super(),this._lazyRender=e.lazyRender,this._host=e.host,this._scrollable=e.scrollable,this._scrollByPage=e.scrollByPage,this._scrollbarState=e.scrollbarState,this._visibilityController=this._register(new dm(e.visibility,"visible scrollbar "+e.extraScrollbarClassName,"invisible scrollbar "+e.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new tc),this._shouldRender=!0,this.domNode=Ei(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(se(this.domNode.domNode,Ge.POINTER_DOWN,t=>this._domNodePointerDown(t)))}_createArrow(e){let t=this._register(new om(e));this.domNode.domNode.appendChild(t.bgDomNode),this.domNode.domNode.appendChild(t.domNode)}_createSlider(e,t,s,i){this.slider=Ei(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(t),typeof s=="number"&&this.slider.setWidth(s),typeof i=="number"&&this.slider.setHeight(i),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(se(this.slider.domNode,Ge.POINTER_DOWN,r=>{r.button===0&&(r.preventDefault(),this._sliderPointerDown(r))})),this.onclick(this.slider.domNode,r=>{r.leftButton&&r.stopPropagation()})}_onElementSize(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}delegatePointerDown(e){let t=this.domNode.domNode.getClientRects()[0].top,s=t+this._scrollbarState.getSliderPosition(),i=t+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),r=this._sliderPointerPosition(e);s<=r&&r<=i?e.button===0&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}_onPointerDown(e){let t,s;if(e.target===this.domNode.domNode&&typeof e.offsetX=="number"&&typeof e.offsetY=="number")t=e.offsetX,s=e.offsetY;else{let r=sm(this.domNode.domNode);t=e.pageX-r.left,s=e.pageY-r.top}let i=this._pointerDownRelativePosition(t,s);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(i):this._scrollbarState.getDesiredScrollPositionFromOffset(i)),e.button===0&&(e.preventDefault(),this._sliderPointerDown(e))}_sliderPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=this._sliderPointerPosition(e),s=this._sliderOrthogonalPointerPosition(e),i=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,r=>{let n=this._sliderOrthogonalPointerPosition(r),o=Math.abs(n-s);if(Jh&&o>fm){this._setDesiredScrollPositionNow(i.getScrollPosition());return}let l=this._sliderPointerPosition(r)-t;this._setDesiredScrollPositionNow(i.getDesiredScrollPositionFromDelta(l))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(e){let t={};this.writeScrollPosition(t,e),this._scrollable.setScrollPositionNow(t)}updateScrollbarSize(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},ic=class Kn{constructor(t,s,i,r,n,o){this._scrollbarSize=Math.round(s),this._oppositeScrollbarSize=Math.round(i),this._arrowSize=Math.round(t),this._visibleSize=r,this._scrollSize=n,this._scrollPosition=o,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new Kn(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(t){let s=Math.round(t);return this._visibleSize!==s?(this._visibleSize=s,this._refreshComputedValues(),!0):!1}setScrollSize(t){let s=Math.round(t);return this._scrollSize!==s?(this._scrollSize=s,this._refreshComputedValues(),!0):!1}setScrollPosition(t){let s=Math.round(t);return this._scrollPosition!==s?(this._scrollPosition=s,this._refreshComputedValues(),!0):!1}setScrollbarSize(t){this._scrollbarSize=Math.round(t)}setOppositeScrollbarSize(t){this._oppositeScrollbarSize=Math.round(t)}static _computeValues(t,s,i,r,n){let o=Math.max(0,i-t),l=Math.max(0,o-2*s),a=r>0&&r>i;if(!a)return{computedAvailableSize:Math.round(o),computedIsNeeded:a,computedSliderSize:Math.round(l),computedSliderRatio:0,computedSliderPosition:0};let h=Math.round(Math.max(20,Math.floor(i*l/r))),c=(l-h)/(r-i),u=n*c;return{computedAvailableSize:Math.round(o),computedIsNeeded:a,computedSliderSize:Math.round(h),computedSliderRatio:c,computedSliderPosition:Math.round(u)}}_refreshComputedValues(){let t=Kn._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=t.computedAvailableSize,this._computedIsNeeded=t.computedIsNeeded,this._computedSliderSize=t.computedSliderSize,this._computedSliderRatio=t.computedSliderRatio,this._computedSliderPosition=t.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(t){if(!this._computedIsNeeded)return 0;let s=t-this._arrowSize-this._computedSliderSize/2;return Math.round(s/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(t){if(!this._computedIsNeeded)return 0;let s=t-this._arrowSize,i=this._scrollPosition;return s<this._computedSliderPosition?i-=this._visibleSize:i+=this._visibleSize,i}getDesiredScrollPositionFromDelta(t){if(!this._computedIsNeeded)return 0;let s=this._computedSliderPosition+t;return Math.round(s/this._computedSliderRatio)}},_m=class extends sc{constructor(e,t,s){let i=e.getScrollDimensions(),r=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:s,scrollbarState:new ic(t.horizontalHasArrows?t.arrowSize:0,t.horizontal===2?0:t.horizontalScrollbarSize,t.vertical===2?0:t.verticalScrollbarSize,i.width,i.scrollWidth,r.scrollLeft),visibility:t.horizontal,extraScrollbarClassName:"horizontal",scrollable:e,scrollByPage:t.scrollByPage}),t.horizontalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((t.horizontalScrollbarSize-t.horizontalSliderSize)/2),0,void 0,t.horizontalSliderSize)}_updateSlider(e,t){this.slider.setWidth(e),this.slider.setLeft(t)}_renderDomNode(e,t){this.domNode.setWidth(e),this.domNode.setHeight(t),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(e.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return e}_sliderPointerPosition(e){return e.pageX}_sliderOrthogonalPointerPosition(e){return e.pageY}_updateScrollbarSize(e){this.slider.setHeight(e)}writeScrollPosition(e,t){e.scrollLeft=t}updateOptions(e){this.updateScrollbarSize(e.horizontal===2?0:e.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._visibilityController.setVisibility(e.horizontal),this._scrollByPage=e.scrollByPage}},pm=class extends sc{constructor(e,t,s){let i=e.getScrollDimensions(),r=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:s,scrollbarState:new ic(t.verticalHasArrows?t.arrowSize:0,t.vertical===2?0:t.verticalScrollbarSize,0,i.height,i.scrollHeight,r.scrollTop),visibility:t.vertical,extraScrollbarClassName:"vertical",scrollable:e,scrollByPage:t.scrollByPage}),t.verticalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((t.verticalScrollbarSize-t.verticalSliderSize)/2),t.verticalSliderSize,void 0)}_updateSlider(e,t){this.slider.setHeight(e),this.slider.setTop(t)}_renderDomNode(e,t){this.domNode.setWidth(t),this.domNode.setHeight(e),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(e.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return t}_sliderPointerPosition(e){return e.pageY}_sliderOrthogonalPointerPosition(e){return e.pageX}_updateScrollbarSize(e){this.slider.setWidth(e)}writeScrollPosition(e,t){e.scrollTop=t}updateOptions(e){this.updateScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(e.vertical),this._scrollByPage=e.scrollByPage}},gm=500,$l=50,mm=class{constructor(e,t,s){this.timestamp=e,this.deltaX=t,this.deltaY=s,this.score=0}},Un=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let t=1,s=0,i=1,r=this._rear;do{let n=r===this._front?t:Math.pow(2,-i);if(t-=n,s+=this._memory[r].score*n,r===this._front)break;r=(this._capacity+r-1)%this._capacity,i++}while(!0);return s<=.5}acceptStandardWheelEvent(t){if(Bo){let s=Ut(t.browserEvent),i=Rg(s);this.accept(Date.now(),t.deltaX*i,t.deltaY*i)}else this.accept(Date.now(),t.deltaX,t.deltaY)}accept(t,s,i){let r=null,n=new mm(t,s,i);this._front===-1&&this._rear===-1?(this._memory[0]=n,this._front=0,this._rear=0):(r=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=n),n.score=this._computeScore(n,r)}_computeScore(t,s){if(Math.abs(t.deltaX)>0&&Math.abs(t.deltaY)>0)return 1;let i=.5;if((!this._isAlmostInt(t.deltaX)||!this._isAlmostInt(t.deltaY))&&(i+=.25),s){let r=Math.abs(t.deltaX),n=Math.abs(t.deltaY),o=Math.abs(s.deltaX),l=Math.abs(s.deltaY),a=Math.max(Math.min(r,o),1),h=Math.max(Math.min(n,l),1),c=Math.max(r,o),u=Math.max(n,l);c%a===0&&u%h===0&&(i-=.5)}return Math.min(Math.max(i,0),1)}_isAlmostInt(t){return Math.abs(Math.round(t)-t)<.01}};Un.INSTANCE=new Un;var vm=Un,Sm=class extends Lo{constructor(e,t,s){super(),this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new W),this.onWillScroll=this._onWillScroll.event,this._options=ym(t),this._scrollable=s,this._register(this._scrollable.onScroll(r=>{this._onWillScroll.fire(r),this._onDidScroll(r),this._onScroll.fire(r)}));let i={onMouseWheel:r=>this._onMouseWheel(r),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new pm(this._scrollable,this._options,i)),this._horizontalScrollbar=this._register(new _m(this._scrollable,this._options,i)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(e),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=Ei(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=Ei(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=Ei(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,r=>this._onMouseOver(r)),this.onmouseleave(this._listenOnDomNode,r=>this._onMouseLeave(r)),this._hideTimeout=this._register(new To),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=Ns(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(e){this._verticalScrollbar.delegatePointerDown(e)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(e){this._scrollable.setScrollDimensions(e,!1)}updateClassName(e){this._options.className=e,jt&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(e){typeof e.handleMouseWheel<"u"&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof e.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),typeof e.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),typeof e.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),typeof e.horizontal<"u"&&(this._options.horizontal=e.horizontal),typeof e.vertical<"u"&&(this._options.vertical=e.vertical),typeof e.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),typeof e.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),typeof e.scrollByPage<"u"&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(e){this._revealOnScroll=e}delegateScrollFromMouseWheelEvent(e){this._onMouseWheel(new Tl(e))}_setListeningToMouseWheel(e){if(this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=Ns(this._mouseWheelToDispose),e)){let t=s=>{this._onMouseWheel(new Tl(s))};this._mouseWheelToDispose.push(se(this._listenOnDomNode,Ge.MOUSE_WHEEL,t,{passive:!1}))}}_onMouseWheel(e){var r;if((r=e.browserEvent)!=null&&r.defaultPrevented)return;let t=vm.INSTANCE;t.acceptStandardWheelEvent(e);let s=!1;if(e.deltaY||e.deltaX){let n=e.deltaY*this._options.mouseWheelScrollSensitivity,o=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&o+n===0?o=n=0:Math.abs(n)>=Math.abs(o)?o=0:n=0),this._options.flipAxes&&([n,o]=[o,n]);let l=!jt&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||l)&&!o&&(o=n,n=0),e.browserEvent&&e.browserEvent.altKey&&(o=o*this._options.fastScrollSensitivity,n=n*this._options.fastScrollSensitivity);let a=this._scrollable.getFutureScrollPosition(),h={};if(n){let c=$l*n,u=a.scrollTop-(c<0?Math.floor(c):Math.ceil(c));this._verticalScrollbar.writeScrollPosition(h,u)}if(o){let c=$l*o,u=a.scrollLeft-(c<0?Math.floor(c):Math.ceil(c));this._horizontalScrollbar.writeScrollPosition(h,u)}h=this._scrollable.validateScrollPosition(h),(a.scrollLeft!==h.scrollLeft||a.scrollTop!==h.scrollTop)&&(this._options.mouseWheelSmoothScroll&&t.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(h):this._scrollable.setScrollPositionNow(h),s=!0)}let i=s;!i&&this._options.alwaysConsumeMouseWheel&&(i=!0),!i&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(i=!0),i&&(e.preventDefault(),e.stopPropagation())}_onDidScroll(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw new Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let e=this._scrollable.getCurrentScrollPosition(),t=e.scrollTop>0,s=e.scrollLeft>0,i=s?" left":"",r=t?" top":"",n=s||t?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${i}`),this._topShadowDomNode.setClassName(`shadow${r}`),this._topLeftShadowDomNode.setClassName(`shadow${n}${r}${i}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(e){this._mouseIsOver=!1,this._hide()}_onMouseOver(e){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),gm)}},bm=class extends Sm{constructor(e,t,s){super(e,t,s)}setScrollPosition(e){e.reuseAnimation?this._scrollable.setScrollPositionSmooth(e,e.reuseAnimation):this._scrollable.setScrollPositionNow(e)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function ym(e){let t={lazyRender:typeof e.lazyRender<"u"?e.lazyRender:!1,className:typeof e.className<"u"?e.className:"",useShadows:typeof e.useShadows<"u"?e.useShadows:!0,handleMouseWheel:typeof e.handleMouseWheel<"u"?e.handleMouseWheel:!0,flipAxes:typeof e.flipAxes<"u"?e.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof e.consumeMouseWheelIfScrollbarIsNeeded<"u"?e.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof e.alwaysConsumeMouseWheel<"u"?e.alwaysConsumeMouseWheel:!1,scrollYToX:typeof e.scrollYToX<"u"?e.scrollYToX:!1,mouseWheelScrollSensitivity:typeof e.mouseWheelScrollSensitivity<"u"?e.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof e.fastScrollSensitivity<"u"?e.fastScrollSensitivity:5,scrollPredominantAxis:typeof e.scrollPredominantAxis<"u"?e.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof e.mouseWheelSmoothScroll<"u"?e.mouseWheelSmoothScroll:!0,arrowSize:typeof e.arrowSize<"u"?e.arrowSize:11,listenOnDomNode:typeof e.listenOnDomNode<"u"?e.listenOnDomNode:null,horizontal:typeof e.horizontal<"u"?e.horizontal:1,horizontalScrollbarSize:typeof e.horizontalScrollbarSize<"u"?e.horizontalScrollbarSize:10,horizontalSliderSize:typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:0,horizontalHasArrows:typeof e.horizontalHasArrows<"u"?e.horizontalHasArrows:!1,vertical:typeof e.vertical<"u"?e.vertical:1,verticalScrollbarSize:typeof e.verticalScrollbarSize<"u"?e.verticalScrollbarSize:10,verticalHasArrows:typeof e.verticalHasArrows<"u"?e.verticalHasArrows:!1,verticalSliderSize:typeof e.verticalSliderSize<"u"?e.verticalSliderSize:0,scrollByPage:typeof e.scrollByPage<"u"?e.scrollByPage:!1};return t.horizontalSliderSize=typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:t.horizontalScrollbarSize,t.verticalSliderSize=typeof e.verticalSliderSize<"u"?e.verticalSliderSize:t.verticalScrollbarSize,jt&&(t.className+=" mac"),t}var Vn=class extends ce{constructor(e,t,s,i,r,n,o,l){super(),this._bufferService=s,this._optionsService=o,this._renderService=l,this._onRequestScrollLines=this._register(new W),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let a=this._register(new am({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:h=>Po(i.window,h)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{a.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new bm(t,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},a)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(r.onProtocolChange(h=>{this._scrollableElement.updateOptions({handleMouseWheel:!(h&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(it.runAndSubscribe(n.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=n.colors.background.css})),e.appendChild(this._scrollableElement.getDomNode()),this._register(Re(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=i.mainDocument.createElement("style"),t.appendChild(this._styleElement),this._register(Re(()=>this._styleElement.remove())),this._register(it.runAndSubscribe(n.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${n.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${n.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${n.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll(h=>this._handleScroll(h)))}scrollLines(e){let t=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:t.scrollTop+e*this._renderService.dimensions.css.cell.height})}scrollToLine(e,t){t&&(this._latestYDisp=e),this._scrollableElement.setScrollPosition({reuseAnimation:!t,scrollTop:e*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){var e;return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:((e=this._optionsService.rawOptions.overviewRuler)==null?void 0:e.width)||14}}queueSync(e){e!==void 0&&(this._latestYDisp=e),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(e=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,e!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:e*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(e){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let t=Math.round(e.scrollTop/this._renderService.dimensions.css.cell.height),s=t-this._bufferService.buffer.ydisp;s!==0&&(this._latestYDisp=t,this._onRequestScrollLines.fire(s)),this._isHandlingScroll=!1}};Vn=Ie([Y(2,_t),Y(3,hs),Y(4,Nh),Y(5,ei),Y(6,pt),Y(7,cs)],Vn);var jn=class extends ce{constructor(e,t,s,i,r){super(),this._screenElement=e,this._bufferService=t,this._coreBrowserService=s,this._decorationService=i,this._renderService=r,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved(n=>this._removeDecoration(n))),this._register(Re(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var i;let t=this._coreBrowserService.mainDocument.createElement("div");t.classList.add("xterm-decoration"),t.classList.toggle("xterm-decoration-top-layer",((i=e==null?void 0:e.options)==null?void 0:i.layer)==="top"),t.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,t.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,t.style.top=`${(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,t.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let s=e.options.x??0;return s&&s>this._bufferService.cols&&(t.style.display="none"),this._refreshXPosition(e,t),t}_refreshStyle(e){let t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let s=this._decorationElements.get(e);s||(s=this._createElement(e),e.element=s,this._decorationElements.set(e,s),this._container.appendChild(s),e.onDispose(()=>{this._decorationElements.delete(e),s.remove()})),s.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(s.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,s.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,s.style.top=`${t*this._renderService.dimensions.css.cell.height}px`,s.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),e.onRenderEmitter.fire(s)}}_refreshXPosition(e,t=e.element){if(!t)return;let s=e.options.x??0;(e.options.anchor||"left")==="right"?t.style.right=s?`${s*this._renderService.dimensions.css.cell.width}px`:"":t.style.left=s?`${s*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(e){var t;(t=this._decorationElements.get(e))==null||t.remove(),this._decorationElements.delete(e),e.dispose()}};jn=Ie([Y(1,_t),Y(2,hs),Y(3,Hi),Y(4,cs)],jn);var wm=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(let t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position)){this._addLineToZone(t,e.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,s){return t>=e.startBufferLine-this._linePadding[s||"full"]&&t<=e.endBufferLine+this._linePadding[s||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}},$t={full:0,left:0,center:0,right:0},fs={full:0,left:0,center:0,right:0},ri={full:0,left:0,center:0,right:0},vr=class extends ce{constructor(e,t,s,i,r,n,o,l){var h;super(),this._viewportElement=e,this._screenElement=t,this._bufferService=s,this._decorationService=i,this._renderService=r,this._optionsService=n,this._themeService=o,this._coreBrowserService=l,this._colorZoneStore=new wm,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(h=this._viewportElement.parentElement)==null||h.insertBefore(this._canvas,this._viewportElement),this._register(Re(()=>{var c;return(c=this._canvas)==null?void 0:c.remove()}));let a=this._canvas.getContext("2d");if(a)this._ctx=a;else throw new Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){var e;return((e=this._optionsService.options.overviewRuler)==null?void 0:e.width)||0}_refreshDrawConstants(){let e=Math.floor((this._canvas.width-1)/3),t=Math.ceil((this._canvas.width-1)/3);fs.full=this._canvas.width,fs.left=e,fs.center=t,fs.right=e,this._refreshDrawHeightConstants(),ri.full=1,ri.left=1,ri.center=1+fs.left,ri.right=1+fs.left+fs.center}_refreshDrawHeightConstants(){$t.full=Math.round(2*this._coreBrowserService.dpr);let e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);$t.left=t,$t.center=t,$t.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*$t.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*$t.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*$t.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*$t.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let t of this._decorationService.decorations)this._colorZoneStore.addDecoration(t);this._ctx.lineWidth=1,this._renderRulerOutline();let e=this._colorZoneStore.zones;for(let t of e)t.position!=="full"&&this._renderColorZone(t);for(let t of e)t.position==="full"&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(ri[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-$t[e.position||"full"]/2),fs[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+$t[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};vr=Ie([Y(2,_t),Y(3,Hi),Y(4,cs),Y(5,pt),Y(6,ei),Y(7,hs)],vr);var k;(e=>(e.NUL="\0",e.SOH="",e.STX="",e.ETX="",e.EOT="",e.ENQ="",e.ACK="",e.BEL="\x07",e.BS="\b",e.HT="	",e.LF=`
`,e.VT="\v",e.FF="\f",e.CR="\r",e.SO="",e.SI="",e.DLE="",e.DC1="",e.DC2="",e.DC3="",e.DC4="",e.NAK="",e.SYN="",e.ETB="",e.CAN="",e.EM="",e.SUB="",e.ESC="\x1B",e.FS="",e.GS="",e.RS="",e.US="",e.SP=" ",e.DEL=""))(k||(k={}));var nr;(e=>(e.PAD="",e.HOP="",e.BPH="",e.NBH="",e.IND="",e.NEL="",e.SSA="",e.ESA="",e.HTS="",e.HTJ="",e.VTS="",e.PLD="",e.PLU="",e.RI="",e.SS2="",e.SS3="",e.DCS="",e.PU1="",e.PU2="",e.STS="",e.CCH="",e.MW="",e.SPA="",e.EPA="",e.SOS="",e.SGCI="",e.SCI="",e.CSI="",e.ST="",e.OSC="",e.PM="",e.APC=""))(nr||(nr={}));var rc;(e=>e.ST=`${k.ESC}\\`)(rc||(rc={}));var qn=class{constructor(e,t,s,i,r,n){this._textarea=e,this._compositionView=t,this._bufferService=s,this._optionsService=i,this._coreService=r,this._renderService=n,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(e.keyCode===20||e.keyCode===229||e.keyCode===16||e.keyCode===17||e.keyCode===18)return!1;this._finalizeComposition(!1)}return e.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){let t={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let s;t.start+=this._dataAlreadySent.length,this._isComposing?s=this._textarea.value.substring(t.start,this._compositionPosition.start):s=this._textarea.value.substring(t.start),s.length>0&&this._coreService.triggerDataEvent(s,!0)}},0)}else{this._isSendingComposition=!1;let t=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(t,!0)}}_handleAnyTextareaChanges(){let e=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let t=this._textarea.value,s=t.replace(e,"");this._dataAlreadySent=s,t.length>e.length?this._coreService.triggerDataEvent(s,!0):t.length<e.length?this._coreService.triggerDataEvent(`${k.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}},0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let t=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),s=this._renderService.dimensions.css.cell.height,i=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,r=t*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=r+"px",this._compositionView.style.top=i+"px",this._compositionView.style.height=s+"px",this._compositionView.style.lineHeight=s+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let n=this._compositionView.getBoundingClientRect();this._textarea.style.left=r+"px",this._textarea.style.top=i+"px",this._textarea.style.width=Math.max(n.width,1)+"px",this._textarea.style.height=Math.max(n.height,1)+"px",this._textarea.style.lineHeight=n.height+"px"}e||setTimeout(()=>this.updateCompositionElements(!0),0)}}};qn=Ie([Y(2,_t),Y(3,pt),Y(4,Hs),Y(5,cs)],qn);var Je=0,Ze=0,Qe=0,Pe=0,Hl={css:"#00000000",rgba:0},ze;(e=>{function t(r,n,o,l){return l!==void 0?`#${Rs(r)}${Rs(n)}${Rs(o)}${Rs(l)}`:`#${Rs(r)}${Rs(n)}${Rs(o)}`}e.toCss=t;function s(r,n,o,l=255){return(r<<24|n<<16|o<<8|l)>>>0}e.toRgba=s;function i(r,n,o,l){return{css:e.toCss(r,n,o,l),rgba:e.toRgba(r,n,o,l)}}e.toColor=i})(ze||(ze={}));var ke;(e=>{function t(a,h){if(Pe=(h.rgba&255)/255,Pe===1)return{css:h.css,rgba:h.rgba};let c=h.rgba>>24&255,u=h.rgba>>16&255,d=h.rgba>>8&255,_=a.rgba>>24&255,p=a.rgba>>16&255,f=a.rgba>>8&255;Je=_+Math.round((c-_)*Pe),Ze=p+Math.round((u-p)*Pe),Qe=f+Math.round((d-f)*Pe);let v=ze.toCss(Je,Ze,Qe),S=ze.toRgba(Je,Ze,Qe);return{css:v,rgba:S}}e.blend=t;function s(a){return(a.rgba&255)===255}e.isOpaque=s;function i(a,h,c){let u=or.ensureContrastRatio(a.rgba,h.rgba,c);if(u)return ze.toColor(u>>24&255,u>>16&255,u>>8&255)}e.ensureContrastRatio=i;function r(a){let h=(a.rgba|255)>>>0;return[Je,Ze,Qe]=or.toChannels(h),{css:ze.toCss(Je,Ze,Qe),rgba:h}}e.opaque=r;function n(a,h){return Pe=Math.round(h*255),[Je,Ze,Qe]=or.toChannels(a.rgba),{css:ze.toCss(Je,Ze,Qe,Pe),rgba:ze.toRgba(Je,Ze,Qe,Pe)}}e.opacity=n;function o(a,h){return Pe=a.rgba&255,n(a,Pe*h/255)}e.multiplyOpacity=o;function l(a){return[a.rgba>>24&255,a.rgba>>16&255,a.rgba>>8&255]}e.toColorRGB=l})(ke||(ke={}));var Te;(e=>{let t,s;try{let r=document.createElement("canvas");r.width=1,r.height=1;let n=r.getContext("2d",{willReadFrequently:!0});n&&(t=n,t.globalCompositeOperation="copy",s=t.createLinearGradient(0,0,1,1))}catch{}function i(r){if(r.match(/#[\da-f]{3,8}/i))switch(r.length){case 4:return Je=parseInt(r.slice(1,2).repeat(2),16),Ze=parseInt(r.slice(2,3).repeat(2),16),Qe=parseInt(r.slice(3,4).repeat(2),16),ze.toColor(Je,Ze,Qe);case 5:return Je=parseInt(r.slice(1,2).repeat(2),16),Ze=parseInt(r.slice(2,3).repeat(2),16),Qe=parseInt(r.slice(3,4).repeat(2),16),Pe=parseInt(r.slice(4,5).repeat(2),16),ze.toColor(Je,Ze,Qe,Pe);case 7:return{css:r,rgba:(parseInt(r.slice(1),16)<<8|255)>>>0};case 9:return{css:r,rgba:parseInt(r.slice(1),16)>>>0}}let n=r.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(n)return Je=parseInt(n[1]),Ze=parseInt(n[2]),Qe=parseInt(n[3]),Pe=Math.round((n[5]===void 0?1:parseFloat(n[5]))*255),ze.toColor(Je,Ze,Qe,Pe);if(!t||!s)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=s,t.fillStyle=r,typeof t.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[Je,Ze,Qe,Pe]=t.getImageData(0,0,1,1).data,Pe!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:ze.toRgba(Je,Ze,Qe,Pe),css:r}}e.toColor=i})(Te||(Te={}));var ct;(e=>{function t(i){return s(i>>16&255,i>>8&255,i&255)}e.relativeLuminance=t;function s(i,r,n){let o=i/255,l=r/255,a=n/255,h=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),c=l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4),u=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4);return h*.2126+c*.7152+u*.0722}e.relativeLuminance2=s})(ct||(ct={}));var or;(e=>{function t(o,l){if(Pe=(l&255)/255,Pe===1)return l;let a=l>>24&255,h=l>>16&255,c=l>>8&255,u=o>>24&255,d=o>>16&255,_=o>>8&255;return Je=u+Math.round((a-u)*Pe),Ze=d+Math.round((h-d)*Pe),Qe=_+Math.round((c-_)*Pe),ze.toRgba(Je,Ze,Qe)}e.blend=t;function s(o,l,a){let h=ct.relativeLuminance(o>>8),c=ct.relativeLuminance(l>>8);if(Zt(h,c)<a){if(c<h){let _=i(o,l,a),p=Zt(h,ct.relativeLuminance(_>>8));if(p<a){let f=r(o,l,a),v=Zt(h,ct.relativeLuminance(f>>8));return p>v?_:f}return _}let u=r(o,l,a),d=Zt(h,ct.relativeLuminance(u>>8));if(d<a){let _=i(o,l,a),p=Zt(h,ct.relativeLuminance(_>>8));return d>p?u:_}return u}}e.ensureContrastRatio=s;function i(o,l,a){let h=o>>24&255,c=o>>16&255,u=o>>8&255,d=l>>24&255,_=l>>16&255,p=l>>8&255,f=Zt(ct.relativeLuminance2(d,_,p),ct.relativeLuminance2(h,c,u));for(;f<a&&(d>0||_>0||p>0);)d-=Math.max(0,Math.ceil(d*.1)),_-=Math.max(0,Math.ceil(_*.1)),p-=Math.max(0,Math.ceil(p*.1)),f=Zt(ct.relativeLuminance2(d,_,p),ct.relativeLuminance2(h,c,u));return(d<<24|_<<16|p<<8|255)>>>0}e.reduceLuminance=i;function r(o,l,a){let h=o>>24&255,c=o>>16&255,u=o>>8&255,d=l>>24&255,_=l>>16&255,p=l>>8&255,f=Zt(ct.relativeLuminance2(d,_,p),ct.relativeLuminance2(h,c,u));for(;f<a&&(d<255||_<255||p<255);)d=Math.min(255,d+Math.ceil((255-d)*.1)),_=Math.min(255,_+Math.ceil((255-_)*.1)),p=Math.min(255,p+Math.ceil((255-p)*.1)),f=Zt(ct.relativeLuminance2(d,_,p),ct.relativeLuminance2(h,c,u));return(d<<24|_<<16|p<<8|255)>>>0}e.increaseLuminance=r;function n(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]}e.toChannels=n})(or||(or={}));function Rs(e){let t=e.toString(16);return t.length<2?"0"+t:t}function Zt(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}var Cm=class extends $i{constructor(e,t,s){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=s}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},Sr=class{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new Tt}register(e){let t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];let t=this._bufferService.buffer.lines.get(e);if(!t||t.length===0)return[];let s=[],i=t.translateToString(!0),r=0,n=0,o=0,l=t.getFg(0),a=t.getBg(0);for(let h=0;h<t.getTrimmedLength();h++)if(t.loadCell(h,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==l||this._workCell.bg!==a){if(h-r>1){let c=this._getJoinedRanges(i,o,n,t,r);for(let u=0;u<c.length;u++)s.push(c[u])}r=h,o=n,l=this._workCell.fg,a=this._workCell.bg}n+=this._workCell.getChars().length||bs.length}if(this._bufferService.cols-r>1){let h=this._getJoinedRanges(i,o,n,t,r);for(let c=0;c<h.length;c++)s.push(h[c])}return s}_getJoinedRanges(e,t,s,i,r){let n=e.substring(t,s),o=[];try{o=this._characterJoiners[0].handler(n)}catch(l){console.error(l)}for(let l=1;l<this._characterJoiners.length;l++)try{let a=this._characterJoiners[l].handler(n);for(let h=0;h<a.length;h++)Sr._mergeRanges(o,a[h])}catch(a){console.error(a)}return this._stringRangesToCellRanges(o,i,r),o}_stringRangesToCellRanges(e,t,s){let i=0,r=!1,n=0,o=e[i];if(o){for(let l=s;l<this._bufferService.cols;l++){let a=t.getWidth(l),h=t.getString(l).length||bs.length;if(a!==0){if(!r&&o[0]<=n&&(o[0]=l,r=!0),o[1]<=n){if(o[1]=l,o=e[++i],!o)break;o[0]<=n?(o[0]=l,r=!0):r=!1}n+=h}}o&&(o[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let s=!1;for(let i=0;i<e.length;i++){let r=e[i];if(s){if(t[1]<=r[0])return e[i-1][1]=t[1],e;if(t[1]<=r[1])return e[i-1][1]=Math.max(t[1],r[1]),e.splice(i,1),e;e.splice(i,1),i--}else{if(t[1]<=r[0])return e.splice(i,0,t),e;if(t[1]<=r[1])return r[0]=Math.min(t[0],r[0]),e;t[0]<r[1]&&(r[0]=Math.min(t[0],r[0]),s=!0);continue}}return s?e[e.length-1][1]=t[1]:e.push(t),e}};Sr=Ie([Y(0,_t)],Sr);function xm(e){return 57508<=e&&e<=57558}function km(e){return 9472<=e&&e<=9631}function Em(e){return xm(e)||km(e)}function Mm(){return{css:{canvas:qi(),cell:qi()},device:{canvas:qi(),cell:qi(),char:{width:0,height:0,left:0,top:0}}}}function qi(){return{width:0,height:0}}var Yn=class{constructor(e,t,s,i,r,n,o){this._document=e,this._characterJoinerService=t,this._optionsService=s,this._coreBrowserService=i,this._coreService=r,this._decorationService=n,this._themeService=o,this._workCell=new Tt,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,t,s){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=s}createRow(e,t,s,i,r,n,o,l,a,h,c){let u=[],d=this._characterJoinerService.getJoinedCharacters(t),_=this._themeService.colors,p=e.getNoBgTrimmedLength();s&&p<n+1&&(p=n+1);let f,v=0,S="",C=0,I=0,w=0,$=0,J=!1,re=0,X=!1,Z=0,ge=0,ne=[],N=h!==-1&&c!==-1;for(let E=0;E<p;E++){e.loadCell(E,this._workCell);let O=this._workCell.getWidth();if(O===0)continue;let U=!1,H=E>=ge,F=E,P=this._workCell;if(d.length>0&&E===d[0][0]&&H){let b=d.shift(),x=this._isCellInSelection(b[0],t);for(C=b[0]+1;C<b[1];C++)H&&(H=x===this._isCellInSelection(C,t));H&&(H=!s||n<b[0]||n>=b[1]),H?(U=!0,P=new Cm(this._workCell,e.translateToString(!0,b[0],b[1]),b[1]-b[0]),F=b[1]-1,O=P.getWidth()):ge=b[1]}let _e=this._isCellInSelection(E,t),Me=s&&E===n,He=N&&E>=h&&E<=c,Ae=!1;this._decorationService.forEachDecorationAtCell(E,t,void 0,b=>{Ae=!0});let tt=P.getChars()||bs;if(tt===" "&&(P.isUnderline()||P.isOverline())&&(tt=""),Z=O*l-a.get(tt,P.isBold(),P.isItalic()),!f)f=this._document.createElement("span");else if(v&&(_e&&X||!_e&&!X&&P.bg===I)&&(_e&&X&&_.selectionForeground||P.fg===w)&&P.extended.ext===$&&He===J&&Z===re&&!Me&&!U&&!Ae&&H){P.isInvisible()?S+=bs:S+=tt,v++;continue}else v&&(f.textContent=S),f=this._document.createElement("span"),v=0,S="";if(I=P.bg,w=P.fg,$=P.extended.ext,J=He,re=Z,X=_e,U&&n>=E&&n<=F&&(n=E),!this._coreService.isCursorHidden&&Me&&this._coreService.isCursorInitialized){if(ne.push("xterm-cursor"),this._coreBrowserService.isFocused)o&&ne.push("xterm-cursor-blink"),ne.push(i==="bar"?"xterm-cursor-bar":i==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(r)switch(r){case"outline":ne.push("xterm-cursor-outline");break;case"block":ne.push("xterm-cursor-block");break;case"bar":ne.push("xterm-cursor-bar");break;case"underline":ne.push("xterm-cursor-underline");break}}if(P.isBold()&&ne.push("xterm-bold"),P.isItalic()&&ne.push("xterm-italic"),P.isDim()&&ne.push("xterm-dim"),P.isInvisible()?S=bs:S=P.getChars()||bs,P.isUnderline()&&(ne.push(`xterm-underline-${P.extended.underlineStyle}`),S===" "&&(S=""),!P.isUnderlineColorDefault()))if(P.isUnderlineColorRGB())f.style.textDecorationColor=`rgb(${$i.toColorRGB(P.getUnderlineColor()).join(",")})`;else{let b=P.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&P.isBold()&&b<8&&(b+=8),f.style.textDecorationColor=_.ansi[b].css}P.isOverline()&&(ne.push("xterm-overline"),S===" "&&(S="")),P.isStrikethrough()&&ne.push("xterm-strikethrough"),He&&(f.style.textDecoration="underline");let Ye=P.getFgColor(),gt=P.getFgColorMode(),We=P.getBgColor(),mt=P.getBgColorMode(),Gt=!!P.isInverse();if(Gt){let b=Ye;Ye=We,We=b;let x=gt;gt=mt,mt=x}let bt,Mt,us=!1;this._decorationService.forEachDecorationAtCell(E,t,void 0,b=>{b.options.layer!=="top"&&us||(b.backgroundColorRGB&&(mt=50331648,We=b.backgroundColorRGB.rgba>>8&16777215,bt=b.backgroundColorRGB),b.foregroundColorRGB&&(gt=50331648,Ye=b.foregroundColorRGB.rgba>>8&16777215,Mt=b.foregroundColorRGB),us=b.options.layer==="top")}),!us&&_e&&(bt=this._coreBrowserService.isFocused?_.selectionBackgroundOpaque:_.selectionInactiveBackgroundOpaque,We=bt.rgba>>8&16777215,mt=50331648,us=!0,_.selectionForeground&&(gt=50331648,Ye=_.selectionForeground.rgba>>8&16777215,Mt=_.selectionForeground)),us&&ne.push("xterm-decoration-top");let g;switch(mt){case 16777216:case 33554432:g=_.ansi[We],ne.push(`xterm-bg-${We}`);break;case 50331648:g=ze.toColor(We>>16,We>>8&255,We&255),this._addStyle(f,`background-color:#${Wl((We>>>0).toString(16),"0",6)}`);break;case 0:default:Gt?(g=_.foreground,ne.push("xterm-bg-257")):g=_.background}switch(bt||P.isDim()&&(bt=ke.multiplyOpacity(g,.5)),gt){case 16777216:case 33554432:P.isBold()&&Ye<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(Ye+=8),this._applyMinimumContrast(f,g,_.ansi[Ye],P,bt,void 0)||ne.push(`xterm-fg-${Ye}`);break;case 50331648:let b=ze.toColor(Ye>>16&255,Ye>>8&255,Ye&255);this._applyMinimumContrast(f,g,b,P,bt,Mt)||this._addStyle(f,`color:#${Wl(Ye.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(f,g,_.foreground,P,bt,Mt)||Gt&&ne.push("xterm-fg-257")}ne.length&&(f.className=ne.join(" "),ne.length=0),!Me&&!U&&!Ae&&H?v++:f.textContent=S,Z!==this.defaultSpacing&&(f.style.letterSpacing=`${Z}px`),u.push(f),E=F}return f&&v&&(f.textContent=S),u}_applyMinimumContrast(e,t,s,i,r,n){if(this._optionsService.rawOptions.minimumContrastRatio===1||Em(i.getCode()))return!1;let o=this._getContrastCache(i),l;if(!r&&!n&&(l=o.getColor(t.rgba,s.rgba)),l===void 0){let a=this._optionsService.rawOptions.minimumContrastRatio/(i.isDim()?2:1);l=ke.ensureContrastRatio(r||t,n||s,a),o.setColor((r||t).rgba,(n||s).rgba,l??null)}return l?(this._addStyle(e,`color:${l.css}`),!0):!1}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){let s=this._selectionStart,i=this._selectionEnd;return!s||!i?!1:this._columnSelectMode?s[0]<=i[0]?e>=s[0]&&t>=s[1]&&e<i[0]&&t<=i[1]:e<s[0]&&t>=s[1]&&e>=i[0]&&t<=i[1]:t>s[1]&&t<i[1]||s[1]===i[1]&&t===s[1]&&e>=s[0]&&e<i[0]||s[1]<i[1]&&t===i[1]&&e<i[0]||s[1]<i[1]&&t===s[1]&&e>=s[0]}};Yn=Ie([Y(1,Wh),Y(2,pt),Y(3,hs),Y(4,Hs),Y(5,Hi),Y(6,ei)],Yn);function Wl(e,t,s){for(;e.length<s;)e=t+e;return e}var Rm=class{constructor(e,t){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let s=e.createElement("span");s.classList.add("xterm-char-measure-element");let i=e.createElement("span");i.classList.add("xterm-char-measure-element"),i.style.fontWeight="bold";let r=e.createElement("span");r.classList.add("xterm-char-measure-element"),r.style.fontStyle="italic";let n=e.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontWeight="bold",n.style.fontStyle="italic",this._measureElements=[s,i,r,n],this._container.appendChild(s),this._container.appendChild(i),this._container.appendChild(r),this._container.appendChild(n),t.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(e,t,s,i){e===this._font&&t===this._fontSize&&s===this._weight&&i===this._weightBold||(this._font=e,this._fontSize=t,this._weight=s,this._weightBold=i,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${s}`,this._measureElements[1].style.fontWeight=`${i}`,this._measureElements[2].style.fontWeight=`${s}`,this._measureElements[3].style.fontWeight=`${i}`,this.clear())}get(e,t,s){let i=0;if(!t&&!s&&e.length===1&&(i=e.charCodeAt(0))<256){if(this._flat[i]!==-9999)return this._flat[i];let o=this._measure(e,0);return o>0&&(this._flat[i]=o),o}let r=e;t&&(r+="B"),s&&(r+="I");let n=this._holey.get(r);if(n===void 0){let o=0;t&&(o|=1),s&&(o|=2),n=this._measure(e,o),n>0&&this._holey.set(r,n)}return n}_measure(e,t){let s=this._measureElements[t];return s.textContent=e.repeat(32),s.offsetWidth/32}},Bm=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,s,i=!1){if(this.selectionStart=t,this.selectionEnd=s,!t||!s||t[0]===s[0]&&t[1]===s[1]){this.clear();return}let r=e.buffers.active.ydisp,n=t[1]-r,o=s[1]-r,l=Math.max(n,0),a=Math.min(o,e.rows-1);if(l>=e.rows||a<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=i,this.viewportStartRow=n,this.viewportEndRow=o,this.viewportCappedStartRow=l,this.viewportCappedEndRow=a,this.startCol=t[0],this.endCol=s[0]}isCellSelected(e,t,s){return this.hasSelection?(s-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&s>=this.viewportCappedStartRow&&t<this.endCol&&s<=this.viewportCappedEndRow:t<this.startCol&&s>=this.viewportCappedStartRow&&t>=this.endCol&&s<=this.viewportCappedEndRow:s>this.viewportStartRow&&s<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&s===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&s===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&s===this.viewportStartRow&&t>=this.startCol):!1}};function Dm(){return new Bm}var on="xterm-dom-renderer-owner-",Rt="xterm-rows",Yi="xterm-fg-",Fl="xterm-bg-",ni="xterm-focus",Xi="xterm-selection",Tm=1,Xn=class extends ce{constructor(e,t,s,i,r,n,o,l,a,h,c,u,d,_){super(),this._terminal=e,this._document=t,this._element=s,this._screenElement=i,this._viewportElement=r,this._helperContainer=n,this._linkifier2=o,this._charSizeService=a,this._optionsService=h,this._bufferService=c,this._coreService=u,this._coreBrowserService=d,this._themeService=_,this._terminalClass=Tm++,this._rowElements=[],this._selectionRenderModel=Dm(),this.onRequestRedraw=this._register(new W).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(Rt),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(Xi),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=Mm(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors(p=>this._injectCss(p))),this._injectCss(this._themeService.colors),this._rowFactory=l.createInstance(Yn,document),this._element.classList.add(on+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline(p=>this._handleLinkHover(p))),this._register(this._linkifier2.onHideLinkUnderline(p=>this._handleLinkLeave(p))),this._register(Re(()=>{this._element.classList.remove(on+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new Rm(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let s of this._rowElements)s.style.width=`${this.dimensions.css.canvas.width}px`,s.style.height=`${this.dimensions.css.cell.height}px`,s.style.lineHeight=`${this.dimensions.css.cell.height}px`,s.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let t=`${this._terminalSelector} .${Rt} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .${Rt} { pointer-events: none; color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;t+=`${this._terminalSelector} .${Rt} .xterm-dim { color: ${ke.multiplyOpacity(e.foreground,.5).css};}`,t+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let s=`blink_underline_${this._terminalClass}`,i=`blink_bar_${this._terminalClass}`,r=`blink_block_${this._terminalClass}`;t+=`@keyframes ${s} { 50% {  border-bottom-style: hidden; }}`,t+=`@keyframes ${i} { 50% {  box-shadow: none; }}`,t+=`@keyframes ${r} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .${Rt}.${ni} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${s} 1s step-end infinite;}${this._terminalSelector} .${Rt}.${ni} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${i} 1s step-end infinite;}${this._terminalSelector} .${Rt}.${ni} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${r} 1s step-end infinite;}${this._terminalSelector} .${Rt} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${Rt} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${Rt} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${Rt} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${Rt} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,t+=`${this._terminalSelector} .${Xi} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${Xi} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${Xi} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(let[n,o]of e.ansi.entries())t+=`${this._terminalSelector} .${Yi}${n} { color: ${o.css}; }${this._terminalSelector} .${Yi}${n}.xterm-dim { color: ${ke.multiplyOpacity(o,.5).css}; }${this._terminalSelector} .${Fl}${n} { background-color: ${o.css}; }`;t+=`${this._terminalSelector} .${Yi}257 { color: ${ke.opaque(e.background).css}; }${this._terminalSelector} .${Yi}257.xterm-dim { color: ${ke.multiplyOpacity(ke.opaque(e.background),.5).css}; }${this._terminalSelector} .${Fl}257 { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}_setDefaultSpacing(){let e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,t){for(let s=this._rowElements.length;s<=t;s++){let i=this._document.createElement("div");this._rowContainer.appendChild(i),this._rowElements.push(i)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(ni),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(ni),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,t,s){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,t,s),this.renderRows(0,this._bufferService.rows-1),!e||!t||(this._selectionRenderModel.update(this._terminal,e,t,s),!this._selectionRenderModel.hasSelection))return;let i=this._selectionRenderModel.viewportStartRow,r=this._selectionRenderModel.viewportEndRow,n=this._selectionRenderModel.viewportCappedStartRow,o=this._selectionRenderModel.viewportCappedEndRow,l=this._document.createDocumentFragment();if(s){let a=e[0]>t[0];l.appendChild(this._createSelectionElement(n,a?t[0]:e[0],a?e[0]:t[0],o-n+1))}else{let a=i===n?e[0]:0,h=n===r?t[0]:this._bufferService.cols;l.appendChild(this._createSelectionElement(n,a,h));let c=o-n-1;if(l.appendChild(this._createSelectionElement(n+1,0,this._bufferService.cols,c)),n!==o){let u=r===o?t[0]:this._bufferService.cols;l.appendChild(this._createSelectionElement(o,0,u))}}this._selectionContainer.appendChild(l)}_createSelectionElement(e,t,s,i=1){let r=this._document.createElement("div"),n=t*this.dimensions.css.cell.width,o=this.dimensions.css.cell.width*(s-t);return n+o>this.dimensions.css.canvas.width&&(o=this.dimensions.css.canvas.width-n),r.style.height=`${i*this.dimensions.css.cell.height}px`,r.style.top=`${e*this.dimensions.css.cell.height}px`,r.style.left=`${n}px`,r.style.width=`${o}px`,r}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let e of this._rowElements)e.replaceChildren()}renderRows(e,t){let s=this._bufferService.buffer,i=s.ybase+s.y,r=Math.min(s.x,this._bufferService.cols-1),n=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,o=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,l=this._optionsService.rawOptions.cursorInactiveStyle;for(let a=e;a<=t;a++){let h=a+s.ydisp,c=this._rowElements[a],u=s.lines.get(h);if(!c||!u)break;c.replaceChildren(...this._rowFactory.createRow(u,h,h===i,o,l,r,n,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${on}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,s,i,r,n){s<0&&(e=0),i<0&&(t=0);let o=this._bufferService.rows-1;s=Math.max(Math.min(s,o),0),i=Math.max(Math.min(i,o),0),r=Math.min(r,this._bufferService.cols);let l=this._bufferService.buffer,a=l.ybase+l.y,h=Math.min(l.x,r-1),c=this._optionsService.rawOptions.cursorBlink,u=this._optionsService.rawOptions.cursorStyle,d=this._optionsService.rawOptions.cursorInactiveStyle;for(let _=s;_<=i;++_){let p=_+l.ydisp,f=this._rowElements[_],v=l.lines.get(p);if(!f||!v)break;f.replaceChildren(...this._rowFactory.createRow(v,p,p===a,u,d,h,c,this.dimensions.css.cell.width,this._widthCache,n?_===s?e:0:-1,n?(_===i?t:r)-1:-1))}}};Xn=Ie([Y(7,Eo),Y(8,Wr),Y(9,pt),Y(10,_t),Y(11,Hs),Y(12,hs),Y(13,ei)],Xn);var Gn=class extends ce{constructor(e,t,s){super(),this._optionsService=s,this.width=0,this.height=0,this._onCharSizeChange=this._register(new W),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new Lm(this._optionsService))}catch{this._measureStrategy=this._register(new Pm(e,t,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let e=this._measureStrategy.measure();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};Gn=Ie([Y(2,pt)],Gn);var nc=class extends ce{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(e,t){e!==void 0&&e>0&&t!==void 0&&t>0&&(this._result.width=e,this._result.height=t)}},Pm=class extends nc{constructor(e,t,s){super(),this._document=e,this._parentElement=t,this._optionsService=s,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},Lm=class extends nc{constructor(e){super(),this._optionsService=e,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let t=this._ctx.measureText("W");if(!("width"in t&&"fontBoundingBoxAscent"in t&&"fontBoundingBoxDescent"in t))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}},Im=class extends ce{constructor(e,t,s){super(),this._textarea=e,this._window=t,this.mainDocument=s,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new Am(this._window)),this._onDprChange=this._register(new W),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new W),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange(i=>this._screenDprMonitor.setWindow(i))),this._register(it.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(se(this._textarea,"focus",()=>this._isFocused=!0)),this._register(se(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},Am=class extends ce{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this._register(new Qs),this._onDprChange=this._register(new W),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(Re(()=>this.clearListener()))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=se(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var e;this._outerListener&&((e=this._resolutionMediaMatchList)==null||e.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},Om=class extends ce{constructor(){super(),this.linkProviders=[],this._register(Re(()=>this.linkProviders.length=0))}registerLinkProvider(e){return this.linkProviders.push(e),{dispose:()=>{let t=this.linkProviders.indexOf(e);t!==-1&&this.linkProviders.splice(t,1)}}}};function Io(e,t,s){let i=s.getBoundingClientRect(),r=e.getComputedStyle(s),n=parseInt(r.getPropertyValue("padding-left")),o=parseInt(r.getPropertyValue("padding-top"));return[t.clientX-i.left-n,t.clientY-i.top-o]}function Nm(e,t,s,i,r,n,o,l,a){if(!n)return;let h=Io(e,t,s);if(h)return h[0]=Math.ceil((h[0]+(a?o/2:0))/o),h[1]=Math.ceil(h[1]/l),h[0]=Math.min(Math.max(h[0],1),i+(a?1:0)),h[1]=Math.min(Math.max(h[1],1),r),h}var Jn=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,s,i,r){return Nm(window,e,t,s,i,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,r)}getMouseReportCoords(e,t){let s=Io(window,e,t);if(this._charSizeService.hasValidSize)return s[0]=Math.min(Math.max(s[0],0),this._renderService.dimensions.css.canvas.width-1),s[1]=Math.min(Math.max(s[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(s[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(s[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(s[0]),y:Math.floor(s[1])}}};Jn=Ie([Y(0,cs),Y(1,Wr)],Jn);var $m=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(e,t,s){this._rowCount=s,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}},oc={};Yp(oc,{getSafariVersion:()=>Wm,isChromeOS:()=>cc,isFirefox:()=>lc,isIpad:()=>Fm,isIphone:()=>zm,isLegacyEdge:()=>Hm,isLinux:()=>Ao,isMac:()=>br,isNode:()=>Fr,isSafari:()=>ac,isWindows:()=>hc});var Fr=typeof process<"u"&&"title"in process,Wi=Fr?"node":navigator.userAgent,Fi=Fr?"node":navigator.platform,lc=Wi.includes("Firefox"),Hm=Wi.includes("Edge"),ac=/^((?!chrome|android).)*safari/i.test(Wi);function Wm(){if(!ac)return 0;let e=Wi.match(/Version\/(\d+)/);return e===null||e.length<2?0:parseInt(e[1])}var br=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(Fi),Fm=Fi==="iPad",zm=Fi==="iPhone",hc=["Windows","Win16","Win32","WinCE"].includes(Fi),Ao=Fi.indexOf("Linux")>=0,cc=/\bCrOS\b/.test(Wi),uc=class{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,s=0,i=e.timeRemaining(),r=0;for(;this._i<this._tasks.length;){if(t=performance.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,performance.now()-t),s=Math.max(t,s),r=e.timeRemaining(),s*1.5>r){i-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(i-t))}ms`),this._start();return}i=r}this.clear()}},Km=class extends uc{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let t=performance.now()+e;return{timeRemaining:()=>Math.max(0,t-performance.now())}}},Um=class extends uc{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},yr=!Fr&&"requestIdleCallback"in window?Um:Km,Vm=class{constructor(){this._queue=new yr}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}},Zn=class extends ce{constructor(e,t,s,i,r,n,o,l,a){super(),this._rowCount=e,this._optionsService=s,this._charSizeService=i,this._coreService=r,this._coreBrowserService=l,this._renderer=this._register(new Qs),this._pausedResizeTask=new Vm,this._observerDisposable=this._register(new Qs),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new W),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new W),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new W),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new W),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new $m((h,c)=>this._renderRows(h,c),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new jm(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(Re(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(o.onResize(()=>this._fullRefresh())),this._register(o.buffers.onBufferActivate(()=>{var h;return(h=this._renderer.value)==null?void 0:h.clear()})),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(n.onDecorationRegistered(()=>this._fullRefresh())),this._register(n.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(o.cols,o.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(o.buffer.y,o.buffer.y,!0))),this._register(a.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,t),this._register(this._coreBrowserService.onWindowChange(h=>this._registerIntersectionObserver(h,t)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){let s=new e.IntersectionObserver(i=>this._handleIntersectionChange(i[i.length-1]),{threshold:0});s.observe(t),this._observerDisposable.value=Re(()=>s.disconnect())}}_handleIntersectionChange(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,s=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}let i=this._syncOutputHandler.flush();i&&(e=Math.min(e,i.start),t=Math.max(t,i.end)),s||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount)}_renderRows(e,t){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0}}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(t=>this.refreshRows(t.start,t.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var e,t;this._renderer.value&&((t=(e=this._renderer.value).clearTextureAtlas)==null||t.call(e),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>{var s;return(s=this._renderer.value)==null?void 0:s.handleResize(e,t)}):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){var e;(e=this._renderer.value)==null||e.handleCharSizeChanged()}handleBlur(){var e;(e=this._renderer.value)==null||e.handleBlur()}handleFocus(){var e;(e=this._renderer.value)==null||e.handleFocus()}handleSelectionChanged(e,t,s){var i;this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=s,(i=this._renderer.value)==null||i.handleSelectionChanged(e,t,s)}handleCursorMove(){var e;(e=this._renderer.value)==null||e.handleCursorMove()}clear(){var e;(e=this._renderer.value)==null||e.clear()}};Zn=Ie([Y(2,pt),Y(3,Wr),Y(4,Hs),Y(5,Hi),Y(6,_t),Y(7,hs),Y(8,ei)],Zn);var jm=class{constructor(e,t,s){this._coreBrowserService=e,this._coreService=t,this._onTimeout=s,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(e,t){this._isBuffering?(this._start=Math.min(this._start,e),this._end=Math.max(this._end,t)):(this._start=e,this._end=t,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1e3))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let e={start:this._start,end:this._end};return this._isBuffering=!1,e}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function qm(e,t,s,i){let r=s.buffer.x,n=s.buffer.y;if(!s.buffer.hasScrollback)return Gm(r,n,e,t,s,i)+zr(n,t,s,i)+Jm(r,n,e,t,s,i);let o;if(n===t)return o=r>e?"D":"C",Li(Math.abs(r-e),Pi(o,i));o=n>t?"D":"C";let l=Math.abs(n-t),a=Xm(n>t?e:r,s)+(l-1)*s.cols+1+Ym(n>t?r:e);return Li(a,Pi(o,i))}function Ym(e,t){return e-1}function Xm(e,t){return t.cols-e}function Gm(e,t,s,i,r,n){return zr(t,i,r,n).length===0?"":Li(fc(e,t,e,t-$s(t,r),!1,r).length,Pi("D",n))}function zr(e,t,s,i){let r=e-$s(e,s),n=t-$s(t,s),o=Math.abs(r-n)-Zm(e,t,s);return Li(o,Pi(dc(e,t),i))}function Jm(e,t,s,i,r,n){let o;zr(t,i,r,n).length>0?o=i-$s(i,r):o=t;let l=i,a=Qm(e,t,s,i,r,n);return Li(fc(e,o,s,l,a==="C",r).length,Pi(a,n))}function Zm(e,t,s){var o;let i=0,r=e-$s(e,s),n=t-$s(t,s);for(let l=0;l<Math.abs(r-n);l++){let a=dc(e,t)==="A"?-1:1;(o=s.buffer.lines.get(r+a*l))!=null&&o.isWrapped&&i++}return i}function $s(e,t){let s=0,i=t.buffer.lines.get(e),r=i==null?void 0:i.isWrapped;for(;r&&e>=0&&e<t.rows;)s++,i=t.buffer.lines.get(--e),r=i==null?void 0:i.isWrapped;return s}function Qm(e,t,s,i,r,n){let o;return zr(s,i,r,n).length>0?o=i-$s(i,r):o=t,e<s&&o<=i||e>=s&&o<i?"C":"D"}function dc(e,t){return e>t?"A":"B"}function fc(e,t,s,i,r,n){let o=e,l=t,a="";for(;(o!==s||l!==i)&&l>=0&&l<n.buffer.lines.length;)o+=r?1:-1,r&&o>n.cols-1?(a+=n.buffer.translateBufferLineToString(l,!1,e,o),o=0,e=0,l++):!r&&o<0&&(a+=n.buffer.translateBufferLineToString(l,!1,0,e+1),o=n.cols-1,e=o,l--);return a+n.buffer.translateBufferLineToString(l,!1,e,o)}function Pi(e,t){let s=t?"O":"[";return k.ESC+s+e}function Li(e,t){e=Math.floor(e);let s="";for(let i=0;i<e;i++)s+=t;return s}var ev=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let e=this.selectionStart,t=this.selectionEnd;return!e||!t?!1:e[1]>t[1]||e[1]===t[1]&&e[0]>t[0]}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function zl(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}var ln=50,tv=15,sv=50,iv=500,rv="",nv=new RegExp(rv,"g"),Qn=class extends ce{constructor(e,t,s,i,r,n,o,l,a){super(),this._element=e,this._screenElement=t,this._linkifier=s,this._bufferService=i,this._coreService=r,this._mouseService=n,this._optionsService=o,this._renderService=l,this._coreBrowserService=a,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new Tt,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new W),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new W),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new W),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new W),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=h=>this._handleMouseMove(h),this._mouseUpListener=h=>this._handleMouseUp(h),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(h=>this._handleTrim(h)),this._register(this._bufferService.buffers.onBufferActivate(h=>this._handleBufferActivate(h))),this.enable(),this._model=new ev(this._bufferService),this._activeSelectionMode=0,this._register(Re(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize(h=>{h.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!e||!t?!1:e[0]!==t[0]||e[1]!==t[1]}get selectionText(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";let s=this._bufferService.buffer,i=[];if(this._activeSelectionMode===3){if(e[0]===t[0])return"";let r=e[0]<t[0]?e[0]:t[0],n=e[0]<t[0]?t[0]:e[0];for(let o=e[1];o<=t[1];o++){let l=s.translateBufferLineToString(o,!0,r,n);i.push(l)}}else{let r=e[1]===t[1]?t[0]:void 0;i.push(s.translateBufferLineToString(e[1],!0,e[0],r));for(let n=e[1]+1;n<=t[1]-1;n++){let o=s.lines.get(n),l=s.translateBufferLineToString(n,!0);o!=null&&o.isWrapped?i[i.length-1]+=l:i.push(l)}if(e[1]!==t[1]){let n=s.lines.get(t[1]),o=s.translateBufferLineToString(t[1],!0,0,t[0]);n&&n.isWrapped?i[i.length-1]+=o:i.push(o)}}return i.map(r=>r.replace(nv," ")).join(hc?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),Ao&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(e){let t=this._getMouseBufferCoords(e),s=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!s||!i||!t?!1:this._areCoordsInSelection(t,s,i)}isCellInSelection(e,t){let s=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!s||!i?!1:this._areCoordsInSelection([e,t],s,i)}_areCoordsInSelection(e,t,s){return e[1]>t[1]&&e[1]<s[1]||t[1]===s[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<s[0]||t[1]<s[1]&&e[1]===s[1]&&e[0]<s[0]||t[1]<s[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){var r,n;let s=(n=(r=this._linkifier.currentLink)==null?void 0:r.link)==null?void 0:n.range;if(s)return this._model.selectionStart=[s.start.x-1,s.start.y-1],this._model.selectionStartLength=zl(s,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let i=this._getMouseBufferCoords(e);return i?(this._selectWordAt(i,t),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){let t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=Io(this._coreBrowserService.window,e,this._screenElement)[1],s=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=s?0:(t>s&&(t-=s),t=Math.min(Math.max(t,-ln),ln),t/=ln,t/Math.abs(t)+Math.round(t*(tv-1)))}shouldForceSelection(e){return br?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,!(e.button===2&&this.hasSelection)&&e.button===0){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):e.detail===1?this._handleSingleClick(e):e.detail===2?this._handleDoubleClick(e):e.detail===3&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),sv)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&t.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){let t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!(br&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;let t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let s=this._bufferService.buffer;if(this._model.selectionEnd[1]<s.lines.length){let i=s.lines.get(this._model.selectionEnd[1]);i&&i.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!t||t[0]!==this._model.selectionEnd[0]||t[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let e=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){let t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<iv&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let s=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(s&&s[0]!==void 0&&s[1]!==void 0){let i=qm(s[0]-1,s[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(i,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,s=!!e&&!!t&&(e[0]!==t[0]||e[1]!==t[1]);if(!s){this._oldHasSelection&&this._fireOnSelectionChange(e,t,s);return}!e||!t||(!this._oldSelectionStart||!this._oldSelectionEnd||e[0]!==this._oldSelectionStart[0]||e[1]!==this._oldSelectionStart[1]||t[0]!==this._oldSelectionEnd[0]||t[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(e,t,s)}_fireOnSelectionChange(e,t,s){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=s,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(t=>this._handleTrim(t))}_convertViewportColToCharacterIndex(e,t){let s=t;for(let i=0;t>=i;i++){let r=e.loadCell(i,this._workCell).getChars().length;this._workCell.getWidth()===0?s--:r>1&&t!==i&&(s+=r-1)}return s}setSelection(e,t,s){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=s,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,s=!0,i=!0){if(e[0]>=this._bufferService.cols)return;let r=this._bufferService.buffer,n=r.lines.get(e[1]);if(!n)return;let o=r.translateBufferLineToString(e[1],!1),l=this._convertViewportColToCharacterIndex(n,e[0]),a=l,h=e[0]-l,c=0,u=0,d=0,_=0;if(o.charAt(l)===" "){for(;l>0&&o.charAt(l-1)===" ";)l--;for(;a<o.length&&o.charAt(a+1)===" ";)a++}else{let v=e[0],S=e[0];n.getWidth(v)===0&&(c++,v--),n.getWidth(S)===2&&(u++,S++);let C=n.getString(S).length;for(C>1&&(_+=C-1,a+=C-1);v>0&&l>0&&!this._isCharWordSeparator(n.loadCell(v-1,this._workCell));){n.loadCell(v-1,this._workCell);let I=this._workCell.getChars().length;this._workCell.getWidth()===0?(c++,v--):I>1&&(d+=I-1,l-=I-1),l--,v--}for(;S<n.length&&a+1<o.length&&!this._isCharWordSeparator(n.loadCell(S+1,this._workCell));){n.loadCell(S+1,this._workCell);let I=this._workCell.getChars().length;this._workCell.getWidth()===2?(u++,S++):I>1&&(_+=I-1,a+=I-1),a++,S++}}a++;let p=l+h-c+d,f=Math.min(this._bufferService.cols,a-l+c+u-d-_);if(!(!t&&o.slice(l,a).trim()==="")){if(s&&p===0&&n.getCodePoint(0)!==32){let v=r.lines.get(e[1]-1);if(v&&n.isWrapped&&v.getCodePoint(this._bufferService.cols-1)!==32){let S=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(S){let C=this._bufferService.cols-S.start;p-=C,f+=C}}}if(i&&p+f===this._bufferService.cols&&n.getCodePoint(this._bufferService.cols-1)!==32){let v=r.lines.get(e[1]+1);if(v!=null&&v.isWrapped&&v.getCodePoint(0)!==32){let S=this._getWordAt([0,e[1]+1],!1,!1,!0);S&&(f+=S.length)}}return{start:p,length:f}}}_selectWordAt(e,t){let s=this._getWordAt(e,t);if(s){for(;s.start<0;)s.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[s.start,e[1]],this._model.selectionStartLength=s.length}}_selectToWordAt(e){let t=this._getWordAt(e,!0);if(t){let s=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,s--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,s++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,s]}}_isCharWordSeparator(e){return e.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){let t=this._bufferService.buffer.getWrappedRangeForLine(e),s={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=zl(s,this._bufferService.cols)}};Qn=Ie([Y(3,_t),Y(4,Hs),Y(5,Mo),Y(6,pt),Y(7,cs),Y(8,hs)],Qn);var Kl=class{constructor(){this._data={}}set(e,t,s){this._data[e]||(this._data[e]={}),this._data[e][t]=s}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}},Ul=class{constructor(){this._color=new Kl,this._css=new Kl}setCss(e,t,s){this._css.set(e,t,s)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,s){this._color.set(e,t,s)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}},Ve=Object.freeze((()=>{let e=[Te.toColor("#2e3436"),Te.toColor("#cc0000"),Te.toColor("#4e9a06"),Te.toColor("#c4a000"),Te.toColor("#3465a4"),Te.toColor("#75507b"),Te.toColor("#06989a"),Te.toColor("#d3d7cf"),Te.toColor("#555753"),Te.toColor("#ef2929"),Te.toColor("#8ae234"),Te.toColor("#fce94f"),Te.toColor("#729fcf"),Te.toColor("#ad7fa8"),Te.toColor("#34e2e2"),Te.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let s=0;s<216;s++){let i=t[s/36%6|0],r=t[s/6%6|0],n=t[s%6];e.push({css:ze.toCss(i,r,n),rgba:ze.toRgba(i,r,n)})}for(let s=0;s<24;s++){let i=8+s*10;e.push({css:ze.toCss(i,i,i),rgba:ze.toRgba(i,i,i)})}return e})()),Ds=Te.toColor("#ffffff"),fi=Te.toColor("#000000"),Vl=Te.toColor("#ffffff"),jl=fi,oi={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},ov=Ds,eo=class extends ce{constructor(e){super(),this._optionsService=e,this._contrastCache=new Ul,this._halfContrastCache=new Ul,this._onChangeColors=this._register(new W),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:Ds,background:fi,cursor:Vl,cursorAccent:jl,selectionForeground:void 0,selectionBackgroundTransparent:oi,selectionBackgroundOpaque:ke.blend(fi,oi),selectionInactiveBackgroundTransparent:oi,selectionInactiveBackgroundOpaque:ke.blend(fi,oi),scrollbarSliderBackground:ke.opacity(Ds,.2),scrollbarSliderHoverBackground:ke.opacity(Ds,.4),scrollbarSliderActiveBackground:ke.opacity(Ds,.5),overviewRulerBorder:Ds,ansi:Ve.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(e={}){let t=this._colors;if(t.foreground=we(e.foreground,Ds),t.background=we(e.background,fi),t.cursor=ke.blend(t.background,we(e.cursor,Vl)),t.cursorAccent=ke.blend(t.background,we(e.cursorAccent,jl)),t.selectionBackgroundTransparent=we(e.selectionBackground,oi),t.selectionBackgroundOpaque=ke.blend(t.background,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundTransparent=we(e.selectionInactiveBackground,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundOpaque=ke.blend(t.background,t.selectionInactiveBackgroundTransparent),t.selectionForeground=e.selectionForeground?we(e.selectionForeground,Hl):void 0,t.selectionForeground===Hl&&(t.selectionForeground=void 0),ke.isOpaque(t.selectionBackgroundTransparent)&&(t.selectionBackgroundTransparent=ke.opacity(t.selectionBackgroundTransparent,.3)),ke.isOpaque(t.selectionInactiveBackgroundTransparent)&&(t.selectionInactiveBackgroundTransparent=ke.opacity(t.selectionInactiveBackgroundTransparent,.3)),t.scrollbarSliderBackground=we(e.scrollbarSliderBackground,ke.opacity(t.foreground,.2)),t.scrollbarSliderHoverBackground=we(e.scrollbarSliderHoverBackground,ke.opacity(t.foreground,.4)),t.scrollbarSliderActiveBackground=we(e.scrollbarSliderActiveBackground,ke.opacity(t.foreground,.5)),t.overviewRulerBorder=we(e.overviewRulerBorder,ov),t.ansi=Ve.slice(),t.ansi[0]=we(e.black,Ve[0]),t.ansi[1]=we(e.red,Ve[1]),t.ansi[2]=we(e.green,Ve[2]),t.ansi[3]=we(e.yellow,Ve[3]),t.ansi[4]=we(e.blue,Ve[4]),t.ansi[5]=we(e.magenta,Ve[5]),t.ansi[6]=we(e.cyan,Ve[6]),t.ansi[7]=we(e.white,Ve[7]),t.ansi[8]=we(e.brightBlack,Ve[8]),t.ansi[9]=we(e.brightRed,Ve[9]),t.ansi[10]=we(e.brightGreen,Ve[10]),t.ansi[11]=we(e.brightYellow,Ve[11]),t.ansi[12]=we(e.brightBlue,Ve[12]),t.ansi[13]=we(e.brightMagenta,Ve[13]),t.ansi[14]=we(e.brightCyan,Ve[14]),t.ansi[15]=we(e.brightWhite,Ve[15]),e.extendedAnsi){let s=Math.min(t.ansi.length-16,e.extendedAnsi.length);for(let i=0;i<s;i++)t.ansi[i+16]=we(e.extendedAnsi[i],Ve[i+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(e===void 0){for(let t=0;t<this._restoreColors.ansi.length;++t)this._colors.ansi[t]=this._restoreColors.ansi[t];return}switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};eo=Ie([Y(0,pt)],eo);function we(e,t){if(e!==void 0)try{return Te.toColor(e)}catch{}return t}var lv=class{constructor(...e){this._entries=new Map;for(let[t,s]of e)this.set(t,s)}set(e,t){let s=this._entries.get(e);return this._entries.set(e,t),s}forEach(e){for(let[t,s]of this._entries.entries())e(t,s)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}},av=class{constructor(){this._services=new lv,this._services.set(Eo,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){let s=tg(e).sort((n,o)=>n.index-o.index),i=[];for(let n of s){let o=this._services.get(n.id);if(!o)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${n.id._id}.`);i.push(o)}let r=s.length>0?s[0].index:t.length;if(t.length!==r)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${r+1} conflicts with ${t.length} static arguments`);return new e(...t,...i)}},hv={trace:0,debug:1,info:2,warn:3,error:4,off:5},cv="xterm.js: ",to=class extends ce{constructor(e){super(),this._optionsService=e,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=hv[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)typeof e[t]=="function"&&(e[t]=e[t]())}_log(e,t,s){this._evalLazyOptionalParams(s),e.call(console,(this._optionsService.options.logger?"":cv)+t,...s)}trace(e,...t){var s;this._logLevel<=0&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.trace.bind(this._optionsService.options.logger))??console.log,e,t)}debug(e,...t){var s;this._logLevel<=1&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.debug.bind(this._optionsService.options.logger))??console.log,e,t)}info(e,...t){var s;this._logLevel<=2&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.info.bind(this._optionsService.options.logger))??console.info,e,t)}warn(e,...t){var s;this._logLevel<=3&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.warn.bind(this._optionsService.options.logger))??console.warn,e,t)}error(e,...t){var s;this._logLevel<=4&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.error.bind(this._optionsService.options.logger))??console.error,e,t)}};to=Ie([Y(0,pt)],to);var ql=class extends ce{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this._register(new W),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new W),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new W),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;let t=new Array(e);for(let s=0;s<Math.min(e,this.length);s++)t[s]=this._array[this._getCyclicIndex(s)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...s){if(t){for(let i=e;i<this._length-t;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let i=this._length-1;i>=e;i--)this._array[this._getCyclicIndex(i+s.length)]=this._array[this._getCyclicIndex(i)];for(let i=0;i<s.length;i++)this._array[this._getCyclicIndex(e+i)]=s[i];if(s.length&&this.onInsertEmitter.fire({index:e,amount:s.length}),this._length+s.length>this._maxLength){let i=this._length+s.length-this._maxLength;this._startIndex+=i,this._length=this._maxLength,this.onTrimEmitter.fire(i)}else this._length+=s.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,s){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+s<0)throw new Error("Cannot shift elements in list beyond index 0");if(s>0){for(let r=t-1;r>=0;r--)this.set(e+r+s,this.get(e+r));let i=e+t+s-this._length;if(i>0)for(this._length+=i;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let i=0;i<t;i++)this.set(e+i+s,this.get(e+i))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}},he=3,Fe=Object.freeze(new $i),Gi=0,an=2,_i=class _c{constructor(t,s,i=!1){this.isWrapped=i,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(t*he);let r=s||Tt.fromCharData([0,Lh,1,0]);for(let n=0;n<t;++n)this.setCell(n,r);this.length=t}get(t){let s=this._data[t*he+0],i=s&2097151;return[this._data[t*he+1],s&2097152?this._combined[t]:i?Ss(i):"",s>>22,s&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):i]}set(t,s){this._data[t*he+1]=s[0],s[1].length>1?(this._combined[t]=s[1],this._data[t*he+0]=t|2097152|s[2]<<22):this._data[t*he+0]=s[1].charCodeAt(0)|s[2]<<22}getWidth(t){return this._data[t*he+0]>>22}hasWidth(t){return this._data[t*he+0]&12582912}getFg(t){return this._data[t*he+1]}getBg(t){return this._data[t*he+2]}hasContent(t){return this._data[t*he+0]&4194303}getCodePoint(t){let s=this._data[t*he+0];return s&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):s&2097151}isCombined(t){return this._data[t*he+0]&2097152}getString(t){let s=this._data[t*he+0];return s&2097152?this._combined[t]:s&2097151?Ss(s&2097151):""}isProtected(t){return this._data[t*he+2]&536870912}loadCell(t,s){return Gi=t*he,s.content=this._data[Gi+0],s.fg=this._data[Gi+1],s.bg=this._data[Gi+2],s.content&2097152&&(s.combinedData=this._combined[t]),s.bg&268435456&&(s.extended=this._extendedAttrs[t]),s}setCell(t,s){s.content&2097152&&(this._combined[t]=s.combinedData),s.bg&268435456&&(this._extendedAttrs[t]=s.extended),this._data[t*he+0]=s.content,this._data[t*he+1]=s.fg,this._data[t*he+2]=s.bg}setCellFromCodepoint(t,s,i,r){r.bg&268435456&&(this._extendedAttrs[t]=r.extended),this._data[t*he+0]=s|i<<22,this._data[t*he+1]=r.fg,this._data[t*he+2]=r.bg}addCodepointToCell(t,s,i){let r=this._data[t*he+0];r&2097152?this._combined[t]+=Ss(s):r&2097151?(this._combined[t]=Ss(r&2097151)+Ss(s),r&=-2097152,r|=2097152):r=s|1<<22,i&&(r&=-12582913,r|=i<<22),this._data[t*he+0]=r}insertCells(t,s,i){if(t%=this.length,t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),s<this.length-t){let r=new Tt;for(let n=this.length-t-s-1;n>=0;--n)this.setCell(t+s+n,this.loadCell(t+n,r));for(let n=0;n<s;++n)this.setCell(t+n,i)}else for(let r=t;r<this.length;++r)this.setCell(r,i);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,i)}deleteCells(t,s,i){if(t%=this.length,s<this.length-t){let r=new Tt;for(let n=0;n<this.length-t-s;++n)this.setCell(t+n,this.loadCell(t+s+n,r));for(let n=this.length-s;n<this.length;++n)this.setCell(n,i)}else for(let r=t;r<this.length;++r)this.setCell(r,i);t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),this.getWidth(t)===0&&!this.hasContent(t)&&this.setCellFromCodepoint(t,0,1,i)}replaceCells(t,s,i,r=!1){if(r){for(t&&this.getWidth(t-1)===2&&!this.isProtected(t-1)&&this.setCellFromCodepoint(t-1,0,1,i),s<this.length&&this.getWidth(s-1)===2&&!this.isProtected(s)&&this.setCellFromCodepoint(s,0,1,i);t<s&&t<this.length;)this.isProtected(t)||this.setCell(t,i),t++;return}for(t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),s<this.length&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s,0,1,i);t<s&&t<this.length;)this.setCell(t++,i)}resize(t,s){if(t===this.length)return this._data.length*4*an<this._data.buffer.byteLength;let i=t*he;if(t>this.length){if(this._data.buffer.byteLength>=i*4)this._data=new Uint32Array(this._data.buffer,0,i);else{let r=new Uint32Array(i);r.set(this._data),this._data=r}for(let r=this.length;r<t;++r)this.setCell(r,s)}else{this._data=this._data.subarray(0,i);let r=Object.keys(this._combined);for(let o=0;o<r.length;o++){let l=parseInt(r[o],10);l>=t&&delete this._combined[l]}let n=Object.keys(this._extendedAttrs);for(let o=0;o<n.length;o++){let l=parseInt(n[o],10);l>=t&&delete this._extendedAttrs[l]}}return this.length=t,i*4*an<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*an<this._data.buffer.byteLength){let t=new Uint32Array(this._data.length);return t.set(this._data),this._data=t,1}return 0}fill(t,s=!1){if(s){for(let i=0;i<this.length;++i)this.isProtected(i)||this.setCell(i,t);return}this._combined={},this._extendedAttrs={};for(let i=0;i<this.length;++i)this.setCell(i,t)}copyFrom(t){this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={};for(let s in t._combined)this._combined[s]=t._combined[s];this._extendedAttrs={};for(let s in t._extendedAttrs)this._extendedAttrs[s]=t._extendedAttrs[s];this.isWrapped=t.isWrapped}clone(){let t=new _c(0);t._data=new Uint32Array(this._data),t.length=this.length;for(let s in this._combined)t._combined[s]=this._combined[s];for(let s in this._extendedAttrs)t._extendedAttrs[s]=this._extendedAttrs[s];return t.isWrapped=this.isWrapped,t}getTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*he+0]&4194303)return t+(this._data[t*he+0]>>22);return 0}getNoBgTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*he+0]&4194303||this._data[t*he+2]&50331648)return t+(this._data[t*he+0]>>22);return 0}copyCellsFrom(t,s,i,r,n){let o=t._data;if(n)for(let a=r-1;a>=0;a--){for(let h=0;h<he;h++)this._data[(i+a)*he+h]=o[(s+a)*he+h];o[(s+a)*he+2]&268435456&&(this._extendedAttrs[i+a]=t._extendedAttrs[s+a])}else for(let a=0;a<r;a++){for(let h=0;h<he;h++)this._data[(i+a)*he+h]=o[(s+a)*he+h];o[(s+a)*he+2]&268435456&&(this._extendedAttrs[i+a]=t._extendedAttrs[s+a])}let l=Object.keys(t._combined);for(let a=0;a<l.length;a++){let h=parseInt(l[a],10);h>=s&&(this._combined[h-s+i]=t._combined[h])}}translateToString(t,s,i,r){s=s??0,i=i??this.length,t&&(i=Math.min(i,this.getTrimmedLength())),r&&(r.length=0);let n="";for(;s<i;){let o=this._data[s*he+0],l=o&2097151,a=o&2097152?this._combined[s]:l?Ss(l):bs;if(n+=a,r)for(let h=0;h<a.length;++h)r.push(s);s+=o>>22||1}return r&&r.push(s),n}};function uv(e,t,s,i,r,n){let o=[];for(let l=0;l<e.length-1;l++){let a=l,h=e.get(++a);if(!h.isWrapped)continue;let c=[e.get(l)];for(;a<e.length&&h.isWrapped;)c.push(h),h=e.get(++a);if(!n&&i>=l&&i<a){l+=c.length-1;continue}let u=0,d=Ii(c,u,t),_=1,p=0;for(;_<c.length;){let v=Ii(c,_,t),S=v-p,C=s-d,I=Math.min(S,C);c[u].copyCellsFrom(c[_],p,d,I,!1),d+=I,d===s&&(u++,d=0),p+=I,p===v&&(_++,p=0),d===0&&u!==0&&c[u-1].getWidth(s-1)===2&&(c[u].copyCellsFrom(c[u-1],s-1,d++,1,!1),c[u-1].setCell(s-1,r))}c[u].replaceCells(d,s,r);let f=0;for(let v=c.length-1;v>0&&(v>u||c[v].getTrimmedLength()===0);v--)f++;f>0&&(o.push(l+c.length-f),o.push(f)),l+=c.length-1}return o}function dv(e,t){let s=[],i=0,r=t[i],n=0;for(let o=0;o<e.length;o++)if(r===o){let l=t[++i];e.onDeleteEmitter.fire({index:o-n,amount:l}),o+=l-1,n+=l,r=t[++i]}else s.push(o);return{layout:s,countRemoved:n}}function fv(e,t){let s=[];for(let i=0;i<t.length;i++)s.push(e.get(t[i]));for(let i=0;i<s.length;i++)e.set(i,s[i]);e.length=t.length}function _v(e,t,s){let i=[],r=e.map((a,h)=>Ii(e,h,t)).reduce((a,h)=>a+h),n=0,o=0,l=0;for(;l<r;){if(r-l<s){i.push(r-l);break}n+=s;let a=Ii(e,o,t);n>a&&(n-=a,o++);let h=e[o].getWidth(n-1)===2;h&&n--;let c=h?s-1:s;i.push(c),l+=c}return i}function Ii(e,t,s){if(t===e.length-1)return e[t].getTrimmedLength();let i=!e[t].hasContent(s-1)&&e[t].getWidth(s-1)===1,r=e[t+1].getWidth(0)===2;return i&&r?s-1:s}var pc=class gc{constructor(t){this.line=t,this.isDisposed=!1,this._disposables=[],this._id=gc._nextId++,this._onDispose=this.register(new W),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),Ns(this._disposables),this._disposables.length=0)}register(t){return this._disposables.push(t),t}};pc._nextId=1;var pv=pc,qe={},Ts=qe.B;qe[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""};qe.A={"#":""};qe.B=void 0;qe[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""};qe.C=qe[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};qe.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};qe.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};qe.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};qe.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""};qe.E=qe[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};qe.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""};qe.H=qe[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};qe["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var Yl=4294967295,Xl=class{constructor(e,t,s){this._hasScrollback=e,this._optionsService=t,this._bufferService=s,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=Fe.clone(),this.savedCharset=Ts,this.markers=[],this._nullCell=Tt.fromCharData([0,Lh,1,0]),this._whitespaceCell=Tt.fromCharData([0,bs,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new yr,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new ql(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new mr),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new mr),this._whitespaceCell}getBlankLine(e,t){return new _i(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;let t=e+this._optionsService.rawOptions.scrollback;return t>Yl?Yl:t}fillViewportRows(e){if(this.lines.length===0){e===void 0&&(e=Fe);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new ql(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){let s=this.getNullCell(Fe),i=0,r=this._getCorrectBufferLength(t);if(r>this.lines.maxLength&&(this.lines.maxLength=r),this.lines.length>0){if(this._cols<e)for(let o=0;o<this.lines.length;o++)i+=+this.lines.get(o).resize(e,s);let n=0;if(this._rows<t)for(let o=this._rows;o<t;o++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new _i(e,s)):this.ybase>0&&this.lines.length<=this.ybase+this.y+n+1?(this.ybase--,n++,this.ydisp>0&&this.ydisp--):this.lines.push(new _i(e,s)));else for(let o=this._rows;o>t;o--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(r<this.lines.maxLength){let o=this.lines.length-r;o>0&&(this.lines.trimStart(o),this.ybase=Math.max(this.ybase-o,0),this.ydisp=Math.max(this.ydisp-o,0),this.savedY=Math.max(this.savedY-o,0)),this.lines.maxLength=r}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),n&&(this.y+=n),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let n=0;n<this.lines.length;n++)i+=+this.lines.get(n).resize(e,s);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),i>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){let e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&e.backend==="conpty"&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){let s=this._optionsService.rawOptions.reflowCursorLine,i=uv(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(Fe),s);if(i.length>0){let r=dv(this.lines,i);fv(this.lines,r.layout),this._reflowLargerAdjustViewport(e,t,r.countRemoved)}}_reflowLargerAdjustViewport(e,t,s){let i=this.getNullCell(Fe),r=s;for(;r-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new _i(e,i))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-s,0)}_reflowSmaller(e,t){let s=this._optionsService.rawOptions.reflowCursorLine,i=this.getNullCell(Fe),r=[],n=0;for(let o=this.lines.length-1;o>=0;o--){let l=this.lines.get(o);if(!l||!l.isWrapped&&l.getTrimmedLength()<=e)continue;let a=[l];for(;l.isWrapped&&o>0;)l=this.lines.get(--o),a.unshift(l);if(!s){let I=this.ybase+this.y;if(I>=o&&I<o+a.length)continue}let h=a[a.length-1].getTrimmedLength(),c=_v(a,this._cols,e),u=c.length-a.length,d;this.ybase===0&&this.y!==this.lines.length-1?d=Math.max(0,this.y-this.lines.maxLength+u):d=Math.max(0,this.lines.length-this.lines.maxLength+u);let _=[];for(let I=0;I<u;I++){let w=this.getBlankLine(Fe,!0);_.push(w)}_.length>0&&(r.push({start:o+a.length+n,newLines:_}),n+=_.length),a.push(..._);let p=c.length-1,f=c[p];f===0&&(p--,f=c[p]);let v=a.length-u-1,S=h;for(;v>=0;){let I=Math.min(S,f);if(a[p]===void 0)break;if(a[p].copyCellsFrom(a[v],S-I,f-I,I,!0),f-=I,f===0&&(p--,f=c[p]),S-=I,S===0){v--;let w=Math.max(v,0);S=Ii(a,w,this._cols)}}for(let I=0;I<a.length;I++)c[I]<e&&a[I].setCell(c[I],i);let C=u-d;for(;C-- >0;)this.ybase===0?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+n)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+u,this.ybase+t-1)}if(r.length>0){let o=[],l=[];for(let f=0;f<this.lines.length;f++)l.push(this.lines.get(f));let a=this.lines.length,h=a-1,c=0,u=r[c];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+n);let d=0;for(let f=Math.min(this.lines.maxLength-1,a+n-1);f>=0;f--)if(u&&u.start>h+d){for(let v=u.newLines.length-1;v>=0;v--)this.lines.set(f--,u.newLines[v]);f++,o.push({index:h+1,amount:u.newLines.length}),d+=u.newLines.length,u=r[++c]}else this.lines.set(f,l[h--]);let _=0;for(let f=o.length-1;f>=0;f--)o[f].index+=_,this.lines.onInsertEmitter.fire(o[f]),_+=o[f].amount;let p=Math.max(0,a+n-this.lines.maxLength);p>0&&this.lines.onTrimEmitter.fire(p)}}translateBufferLineToString(e,t,s=0,i){let r=this.lines.get(e);return r?r.translateToString(t,s,i):""}getWrappedRangeForLine(e){let t=e,s=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;s+1<this.lines.length&&this.lines.get(s+1).isWrapped;)s++;return{first:t,last:s}}setupTabStops(e){for(e!=null?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(e==null&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(e==null&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose();this.markers.length=0,this._isClearing=!1}addMarker(e){let t=new pv(e);return this.markers.push(t),t.register(this.lines.onTrim(s=>{t.line-=s,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(s=>{t.line>=s.index&&(t.line+=s.amount)})),t.register(this.lines.onDelete(s=>{t.line>=s.index&&t.line<s.index+s.amount&&t.dispose(),t.line>s.index&&(t.line-=s.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}},gv=class extends ce{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this._register(new W),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new Xl(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new Xl(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}},mc=2,vc=1,so=class extends ce{constructor(e){super(),this.isUserScrolling=!1,this._onResize=this._register(new W),this.onResize=this._onResize.event,this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,mc),this.rows=Math.max(e.rawOptions.rows||0,vc),this.buffers=this._register(new gv(e,this)),this._register(this.buffers.onBufferActivate(t=>{this._onScroll.fire(t.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(e,t){let s=this.cols!==e,i=this.rows!==t;this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t,colsChanged:s,rowsChanged:i})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){let s=this.buffer,i;i=this._cachedBlankLine,(!i||i.length!==this.cols||i.getFg(0)!==e.fg||i.getBg(0)!==e.bg)&&(i=s.getBlankLine(e,t),this._cachedBlankLine=i),i.isWrapped=t;let r=s.ybase+s.scrollTop,n=s.ybase+s.scrollBottom;if(s.scrollTop===0){let o=s.lines.isFull;n===s.lines.length-1?o?s.lines.recycle().copyFrom(i):s.lines.push(i.clone()):s.lines.splice(n+1,0,i.clone()),o?this.isUserScrolling&&(s.ydisp=Math.max(s.ydisp-1,0)):(s.ybase++,this.isUserScrolling||s.ydisp++)}else{let o=n-r+1;s.lines.shiftElements(r+1,o-1,-1),s.lines.set(n,i.clone())}this.isUserScrolling||(s.ydisp=s.ybase),this._onScroll.fire(s.ydisp)}scrollLines(e,t){let s=this.buffer;if(e<0){if(s.ydisp===0)return;this.isUserScrolling=!0}else e+s.ydisp>=s.ybase&&(this.isUserScrolling=!1);let i=s.ydisp;s.ydisp=Math.max(Math.min(s.ydisp+e,s.ybase),0),i!==s.ydisp&&(t||this._onScroll.fire(s.ydisp))}};so=Ie([Y(0,pt)],so);var Ks={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:br,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},mv=["normal","bold","100","200","300","400","500","600","700","800","900"],vv=class extends ce{constructor(e){super(),this._onOptionChange=this._register(new W),this.onOptionChange=this._onOptionChange.event;let t={...Ks};for(let s in e)if(s in t)try{let i=e[s];t[s]=this._sanitizeAndValidateOption(s,i)}catch(i){console.error(i)}this.rawOptions=t,this.options={...t},this._setupOptions(),this._register(Re(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(e,t){return this.onOptionChange(s=>{s===e&&t(this.rawOptions[e])})}onMultipleOptionChange(e,t){return this.onOptionChange(s=>{e.indexOf(s)!==-1&&t()})}_setupOptions(){let e=s=>{if(!(s in Ks))throw new Error(`No option with key "${s}"`);return this.rawOptions[s]},t=(s,i)=>{if(!(s in Ks))throw new Error(`No option with key "${s}"`);i=this._sanitizeAndValidateOption(s,i),this.rawOptions[s]!==i&&(this.rawOptions[s]=i,this._onOptionChange.fire(s))};for(let s in this.rawOptions){let i={get:e.bind(this,s),set:t.bind(this,s)};Object.defineProperty(this.options,s,i)}}_sanitizeAndValidateOption(e,t){switch(e){case"cursorStyle":if(t||(t=Ks[e]),!Sv(t))throw new Error(`"${t}" is not a valid value for ${e}`);break;case"wordSeparator":t||(t=Ks[e]);break;case"fontWeight":case"fontWeightBold":if(typeof t=="number"&&1<=t&&t<=1e3)break;t=mv.includes(t)?t:Ks[e];break;case"cursorWidth":t=Math.floor(t);case"lineHeight":case"tabStopWidth":if(t<1)throw new Error(`${e} cannot be less than 1, value: ${t}`);break;case"minimumContrastRatio":t=Math.max(1,Math.min(21,Math.round(t*10)/10));break;case"scrollback":if(t=Math.min(t,4294967295),t<0)throw new Error(`${e} cannot be less than 0, value: ${t}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(t<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${t}`);break;case"rows":case"cols":if(!t&&t!==0)throw new Error(`${e} must be numeric, value: ${t}`);break;case"windowsPty":t=t??{};break}return t}};function Sv(e){return e==="block"||e==="underline"||e==="bar"}function pi(e,t=5){if(typeof e!="object")return e;let s=Array.isArray(e)?[]:{};for(let i in e)s[i]=t<=1?e[i]:e[i]&&pi(e[i],t-1);return s}var Gl=Object.freeze({insertMode:!1}),Jl=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),io=class extends ce{constructor(e,t,s){super(),this._bufferService=e,this._logService=t,this._optionsService=s,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new W),this.onData=this._onData.event,this._onUserInput=this._register(new W),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new W),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new W),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=pi(Gl),this.decPrivateModes=pi(Jl)}reset(){this.modes=pi(Gl),this.decPrivateModes=pi(Jl)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;let s=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&s.ybase!==s.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`),this._logService.trace("sending data (codes)",()=>e.split("").map(i=>i.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`),this._logService.trace("sending binary (codes)",()=>e.split("").map(t=>t.charCodeAt(0))),this._onBinary.fire(e))}};io=Ie([Y(0,_t),Y(1,$h),Y(2,pt)],io);var Zl={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>e.button===4||e.action!==1?!1:(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>e.action!==32},DRAG:{events:23,restrict:e=>!(e.action===32&&e.button===3)},ANY:{events:31,restrict:e=>!0}};function hn(e,t){let s=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return e.button===4?(s|=64,s|=e.action):(s|=e.button&3,e.button&4&&(s|=64),e.button&8&&(s|=128),e.action===32?s|=32:e.action===0&&!t&&(s|=3)),s}var cn=String.fromCharCode,Ql={DEFAULT:e=>{let t=[hn(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`\x1B[M${cn(t[0])}${cn(t[1])}${cn(t[2])}`},SGR:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${hn(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${hn(e,!0)};${e.x};${e.y}${t}`}},ro=class extends ce{constructor(e,t,s){super(),this._bufferService=e,this._coreService=t,this._optionsService=s,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new W),this.onProtocolChange=this._onProtocolChange.event;for(let i of Object.keys(Zl))this.addProtocol(i,Zl[i]);for(let i of Object.keys(Ql))this.addEncoding(i,Ql[i]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(e,t,s){if(e.deltaY===0||e.shiftKey||t===void 0||s===void 0)return 0;let i=t/s,r=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(r/=i+0,Math.abs(e.deltaY)<50&&(r*=.3),this._wheelPartialScroll+=r,r=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(r*=this._bufferService.rows),r}_applyScrollModifier(e,t){return t.altKey||t.ctrlKey||t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows||e.button===4&&e.action===32||e.button===3&&e.action!==32||e.button!==4&&(e.action===2||e.action===3)||(e.col++,e.row++,e.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,e,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(e))return!1;let t=this._encodings[this._activeEncoding](e);return t&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(e&1),up:!!(e&2),drag:!!(e&4),move:!!(e&8),wheel:!!(e&16)}}_equalEvents(e,t,s){if(s){if(e.x!==t.x||e.y!==t.y)return!1}else if(e.col!==t.col||e.row!==t.row)return!1;return!(e.button!==t.button||e.action!==t.action||e.ctrl!==t.ctrl||e.alt!==t.alt||e.shift!==t.shift)}};ro=Ie([Y(0,_t),Y(1,Hs),Y(2,pt)],ro);var un=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],bv=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],je;function yv(e,t){let s=0,i=t.length-1,r;if(e<t[0][0]||e>t[i][1])return!1;for(;i>=s;)if(r=s+i>>1,e>t[r][1])s=r+1;else if(e<t[r][0])i=r-1;else return!0;return!1}var wv=class{constructor(){if(this.version="6",!je){je=new Uint8Array(65536),je.fill(1),je[0]=0,je.fill(0,1,32),je.fill(0,127,160),je.fill(2,4352,4448),je[9001]=2,je[9002]=2,je.fill(2,11904,42192),je[12351]=1,je.fill(2,44032,55204),je.fill(2,63744,64256),je.fill(2,65040,65050),je.fill(2,65072,65136),je.fill(2,65280,65377),je.fill(2,65504,65511);for(let e=0;e<un.length;++e)je.fill(0,un[e][0],un[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?je[e]:yv(e,bv)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let s=this.wcwidth(e),i=s===0&&t!==0;if(i){let r=Ps.extractWidth(t);r===0?i=!1:r>s&&(s=r)}return Ps.createPropertyValue(0,s,i)}},Ps=class lr{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new W,this.onChange=this._onChange.event;let t=new wv;this.register(t),this._active=t.version,this._activeProvider=t}static extractShouldJoin(t){return(t&1)!==0}static extractWidth(t){return t>>1&3}static extractCharKind(t){return t>>3}static createPropertyValue(t,s,i=!1){return(t&16777215)<<3|(s&3)<<1|(i?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let s=0,i=0,r=t.length;for(let n=0;n<r;++n){let o=t.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=r)return s+this.wcwidth(o);let h=t.charCodeAt(n);56320<=h&&h<=57343?o=(o-55296)*1024+h-56320+65536:s+=this.wcwidth(h)}let l=this.charProperties(o,i),a=lr.extractWidth(l);lr.extractShouldJoin(l)&&(a-=lr.extractWidth(i)),s+=a,i=l}return s}charProperties(t,s){return this._activeProvider.charProperties(t,s)}},Cv=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}};function ea(e){var i;let t=(i=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1))==null?void 0:i.get(e.cols-1),s=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);s&&t&&(s.isWrapped=t[3]!==0&&t[3]!==32)}var li=2147483647,xv=256,Sc=class no{constructor(t=32,s=32){if(this.maxLength=t,this.maxSubParamsLength=s,s>xv)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(t),this.length=0,this._subParams=new Int32Array(s),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(t),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(t){let s=new no;if(!t.length)return s;for(let i=Array.isArray(t[0])?1:0;i<t.length;++i){let r=t[i];if(Array.isArray(r))for(let n=0;n<r.length;++n)s.addSubParam(r[n]);else s.addParam(r)}return s}clone(){let t=new no(this.maxLength,this.maxSubParamsLength);return t.params.set(this.params),t.length=this.length,t._subParams.set(this._subParams),t._subParamsLength=this._subParamsLength,t._subParamsIdx.set(this._subParamsIdx),t._rejectDigits=this._rejectDigits,t._rejectSubDigits=this._rejectSubDigits,t._digitIsSub=this._digitIsSub,t}toArray(){let t=[];for(let s=0;s<this.length;++s){t.push(this.params[s]);let i=this._subParamsIdx[s]>>8,r=this._subParamsIdx[s]&255;r-i>0&&t.push(Array.prototype.slice.call(this._subParams,i,r))}return t}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(t){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=t>li?li:t}addSubParam(t){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=t>li?li:t,this._subParamsIdx[this.length-1]++}}hasSubParams(t){return(this._subParamsIdx[t]&255)-(this._subParamsIdx[t]>>8)>0}getSubParams(t){let s=this._subParamsIdx[t]>>8,i=this._subParamsIdx[t]&255;return i-s>0?this._subParams.subarray(s,i):null}getSubParamsAll(){let t={};for(let s=0;s<this.length;++s){let i=this._subParamsIdx[s]>>8,r=this._subParamsIdx[s]&255;r-i>0&&(t[s]=this._subParams.slice(i,r))}return t}addDigit(t){let s;if(this._rejectDigits||!(s=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let i=this._digitIsSub?this._subParams:this.params,r=i[s-1];i[s-1]=~r?Math.min(r*10+t,li):t}},ai=[],kv=class{constructor(){this._state=0,this._active=ai,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let s=this._handlers[e];return s.push(t),{dispose:()=>{let i=s.indexOf(t);i!==-1&&s.splice(i,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=ai}reset(){if(this._state===2)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=ai,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||ai,!this._active.length)this._handlerFb(this._id,"START");else for(let e=this._active.length-1;e>=0;e--)this._active[e].start()}_put(e,t,s){if(!this._active.length)this._handlerFb(this._id,"PUT",Hr(e,t,s));else for(let i=this._active.length-1;i>=0;i--)this._active[i].put(e,t,s)}start(){this.reset(),this._state=1}put(e,t,s){if(this._state!==3){if(this._state===1)for(;t<s;){let i=e[t++];if(i===59){this._state=2,this._start();break}if(i<48||57<i){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+i-48}this._state===2&&s-t>0&&this._put(e,t,s)}}end(e,t=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",e);else{let s=!1,i=this._active.length-1,r=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,s=t,r=this._stack.fallThrough,this._stack.paused=!1),!r&&s===!1){for(;i>=0&&(s=this._active[i].end(e),s!==!0);i--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,s;i--}for(;i>=0;i--)if(s=this._active[i].end(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,s}this._active=ai,this._id=-1,this._state=0}}},wt=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,s){this._hitLimit||(this._data+=Hr(e,t,s),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then(s=>(this._data="",this._hitLimit=!1,s));return this._data="",this._hitLimit=!1,t}},hi=[],Ev=class{constructor(){this._handlers=Object.create(null),this._active=hi,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=hi}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let s=this._handlers[e];return s.push(t),{dispose:()=>{let i=s.indexOf(t);i!==-1&&s.splice(i,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=hi,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||hi,!this._active.length)this._handlerFb(this._ident,"HOOK",t);else for(let s=this._active.length-1;s>=0;s--)this._active[s].hook(t)}put(e,t,s){if(!this._active.length)this._handlerFb(this._ident,"PUT",Hr(e,t,s));else for(let i=this._active.length-1;i>=0;i--)this._active[i].put(e,t,s)}unhook(e,t=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",e);else{let s=!1,i=this._active.length-1,r=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,s=t,r=this._stack.fallThrough,this._stack.paused=!1),!r&&s===!1){for(;i>=0&&(s=this._active[i].unhook(e),s!==!0);i--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,s;i--}for(;i>=0;i--)if(s=this._active[i].unhook(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,s}this._active=hi,this._ident=0}},gi=new Sc;gi.addParam(0);var ta=class{constructor(e){this._handler=e,this._data="",this._params=gi,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():gi,this._data="",this._hitLimit=!1}put(e,t,s){this._hitLimit||(this._data+=Hr(e,t,s),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then(s=>(this._params=gi,this._data="",this._hitLimit=!1,s));return this._params=gi,this._data="",this._hitLimit=!1,t}},Mv=class{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,s,i){this.table[t<<8|e]=s<<4|i}addMany(e,t,s,i){for(let r=0;r<e.length;r++)this.table[t<<8|e[r]]=s<<4|i}},Dt=160,Rv=(function(){let e=new Mv(4095),t=Array.apply(null,Array(256)).map((l,a)=>a),s=(l,a)=>t.slice(l,a),i=s(32,127),r=s(0,24);r.push(25),r.push.apply(r,s(28,32));let n=s(0,14),o;e.setDefault(1,0),e.addMany(i,0,2,0);for(o in n)e.addMany([24,26,153,154],o,3,0),e.addMany(s(128,144),o,3,0),e.addMany(s(144,152),o,3,0),e.add(156,o,0,0),e.add(27,o,11,1),e.add(157,o,4,8),e.addMany([152,158,159],o,0,7),e.add(155,o,11,3),e.add(144,o,11,9);return e.addMany(r,0,3,0),e.addMany(r,1,3,1),e.add(127,1,0,1),e.addMany(r,8,0,8),e.addMany(r,3,3,3),e.add(127,3,0,3),e.addMany(r,4,3,4),e.add(127,4,0,4),e.addMany(r,6,3,6),e.addMany(r,5,3,5),e.add(127,5,0,5),e.addMany(r,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(i,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(s(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(i,7,0,7),e.addMany(r,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(s(64,127),3,7,0),e.addMany(s(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(s(48,60),4,8,4),e.addMany(s(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(s(32,64),6,0,6),e.add(127,6,0,6),e.addMany(s(64,127),6,0,0),e.addMany(s(32,48),3,9,5),e.addMany(s(32,48),5,9,5),e.addMany(s(48,64),5,0,6),e.addMany(s(64,127),5,7,0),e.addMany(s(32,48),4,9,5),e.addMany(s(32,48),1,9,2),e.addMany(s(32,48),2,9,2),e.addMany(s(48,127),2,10,0),e.addMany(s(48,80),1,10,0),e.addMany(s(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(s(96,127),1,10,0),e.add(80,1,11,9),e.addMany(r,9,0,9),e.add(127,9,0,9),e.addMany(s(28,32),9,0,9),e.addMany(s(32,48),9,9,12),e.addMany(s(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(r,11,0,11),e.addMany(s(32,128),11,0,11),e.addMany(s(28,32),11,0,11),e.addMany(r,10,0,10),e.add(127,10,0,10),e.addMany(s(28,32),10,0,10),e.addMany(s(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(s(32,48),10,9,12),e.addMany(r,12,0,12),e.add(127,12,0,12),e.addMany(s(28,32),12,0,12),e.addMany(s(32,48),12,9,12),e.addMany(s(48,64),12,0,11),e.addMany(s(64,127),12,12,13),e.addMany(s(64,127),10,12,13),e.addMany(s(64,127),9,12,13),e.addMany(r,13,13,13),e.addMany(i,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(Dt,0,2,0),e.add(Dt,8,5,8),e.add(Dt,6,0,6),e.add(Dt,11,0,11),e.add(Dt,13,13,13),e})(),Bv=class extends ce{constructor(e=Rv){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new Sc,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(t,s,i)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,s)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(Re(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new kv),this._dcsParser=this._register(new Ev),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(e,t=[64,126]){let s=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(s=e.prefix.charCodeAt(0),s&&60>s||s>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let r=0;r<e.intermediates.length;++r){let n=e.intermediates.charCodeAt(r);if(32>n||n>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");s<<=8,s|=n}}if(e.final.length!==1)throw new Error("final must be a single byte");let i=e.final.charCodeAt(0);if(t[0]>i||i>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return s<<=8,s|=i,s}identToString(e){let t=[];for(;e;)t.push(String.fromCharCode(e&255)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){let s=this._identifier(e,[48,126]);this._escHandlers[s]===void 0&&(this._escHandlers[s]=[]);let i=this._escHandlers[s];return i.push(t),{dispose:()=>{let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){let s=this._identifier(e);this._csiHandlers[s]===void 0&&(this._csiHandlers[s]=[]);let i=this._csiHandlers[s];return i.push(t),{dispose:()=>{let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,s,i,r){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=s,this._parseStack.transition=i,this._parseStack.chunkPos=r}parse(e,t,s){let i=0,r=0,n=0,o;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,n=this._parseStack.chunkPos+1;else{if(s===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let l=this._parseStack.handlers,a=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(s===!1&&a>-1){for(;a>=0&&(o=l[a](this._params),o!==!0);a--)if(o instanceof Promise)return this._parseStack.handlerPos=a,o}this._parseStack.handlers=[];break;case 4:if(s===!1&&a>-1){for(;a>=0&&(o=l[a](),o!==!0);a--)if(o instanceof Promise)return this._parseStack.handlerPos=a,o}this._parseStack.handlers=[];break;case 6:if(i=e[this._parseStack.chunkPos],o=this._dcsParser.unhook(i!==24&&i!==26,s),o)return o;i===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(i=e[this._parseStack.chunkPos],o=this._oscParser.end(i!==24&&i!==26,s),o)return o;i===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,n=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let l=n;l<t;++l){switch(i=e[l],r=this._transitions.table[this.currentState<<8|(i<160?i:Dt)],r>>4){case 2:for(let d=l+1;;++d){if(d>=t||(i=e[d])<32||i>126&&i<Dt){this._printHandler(e,l,d),l=d-1;break}if(++d>=t||(i=e[d])<32||i>126&&i<Dt){this._printHandler(e,l,d),l=d-1;break}if(++d>=t||(i=e[d])<32||i>126&&i<Dt){this._printHandler(e,l,d),l=d-1;break}if(++d>=t||(i=e[d])<32||i>126&&i<Dt){this._printHandler(e,l,d),l=d-1;break}}break;case 3:this._executeHandlers[i]?this._executeHandlers[i]():this._executeHandlerFb(i),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:l,code:i,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let a=this._csiHandlers[this._collect<<8|i],h=a?a.length-1:-1;for(;h>=0&&(o=a[h](this._params),o!==!0);h--)if(o instanceof Promise)return this._preserveStack(3,a,h,r,l),o;h<0&&this._csiHandlerFb(this._collect<<8|i,this._params),this.precedingJoinState=0;break;case 8:do switch(i){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(i-48)}while(++l<t&&(i=e[l])>47&&i<60);l--;break;case 9:this._collect<<=8,this._collect|=i;break;case 10:let c=this._escHandlers[this._collect<<8|i],u=c?c.length-1:-1;for(;u>=0&&(o=c[u](),o!==!0);u--)if(o instanceof Promise)return this._preserveStack(4,c,u,r,l),o;u<0&&this._escHandlerFb(this._collect<<8|i),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|i,this._params);break;case 13:for(let d=l+1;;++d)if(d>=t||(i=e[d])===24||i===26||i===27||i>127&&i<Dt){this._dcsParser.put(e,l,d),l=d-1;break}break;case 14:if(o=this._dcsParser.unhook(i!==24&&i!==26),o)return this._preserveStack(6,[],0,r,l),o;i===27&&(r|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let d=l+1;;d++)if(d>=t||(i=e[d])<32||i>127&&i<Dt){this._oscParser.put(e,l,d),l=d-1;break}break;case 6:if(o=this._oscParser.end(i!==24&&i!==26),o)return this._preserveStack(5,[],0,r,l),o;i===27&&(r|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=r&15}}},Dv=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,Tv=/^[\da-f]+$/;function sa(e){if(!e)return;let t=e.toLowerCase();if(t.indexOf("rgb:")===0){t=t.slice(4);let s=Dv.exec(t);if(s){let i=s[1]?15:s[4]?255:s[7]?4095:65535;return[Math.round(parseInt(s[1]||s[4]||s[7]||s[10],16)/i*255),Math.round(parseInt(s[2]||s[5]||s[8]||s[11],16)/i*255),Math.round(parseInt(s[3]||s[6]||s[9]||s[12],16)/i*255)]}}else if(t.indexOf("#")===0&&(t=t.slice(1),Tv.exec(t)&&[3,6,9,12].includes(t.length))){let s=t.length/3,i=[0,0,0];for(let r=0;r<3;++r){let n=parseInt(t.slice(s*r,s*r+s),16);i[r]=s===1?n<<4:s===2?n:s===3?n>>4:n>>8}return i}}function dn(e,t){let s=e.toString(16),i=s.length<2?"0"+s:s;switch(t){case 4:return s[0];case 8:return i;case 12:return(i+i).slice(0,3);default:return i+i}}function Pv(e,t=16){let[s,i,r]=e;return`rgb:${dn(s,t)}/${dn(i,t)}/${dn(r,t)}`}var Lv={"(":0,")":1,"*":2,"+":3,"-":1,".":2},_s=131072,ia=10;function ra(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var na=5e3,oa=0,Iv=class extends ce{constructor(e,t,s,i,r,n,o,l,a=new Bv){super(),this._bufferService=e,this._charsetService=t,this._coreService=s,this._logService=i,this._optionsService=r,this._oscLinkService=n,this._coreMouseService=o,this._unicodeService=l,this._parser=a,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new Qp,this._utf8Decoder=new eg,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=Fe.clone(),this._eraseAttrDataInternal=Fe.clone(),this._onRequestBell=this._register(new W),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new W),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new W),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new W),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new W),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new W),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new W),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new W),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new W),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new W),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new W),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new W),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new oo(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate(h=>this._activeBuffer=h.activeBuffer)),this._parser.setCsiHandlerFallback((h,c)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(h),params:c.toArray()})}),this._parser.setEscHandlerFallback(h=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(h)})}),this._parser.setExecuteHandlerFallback(h=>{this._logService.debug("Unknown EXECUTE code: ",{code:h})}),this._parser.setOscHandlerFallback((h,c,u)=>{this._logService.debug("Unknown OSC code: ",{identifier:h,action:c,data:u})}),this._parser.setDcsHandlerFallback((h,c,u)=>{c==="HOOK"&&(u=u.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(h),action:c,payload:u})}),this._parser.setPrintHandler((h,c,u)=>this.print(h,c,u)),this._parser.registerCsiHandler({final:"@"},h=>this.insertChars(h)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},h=>this.scrollLeft(h)),this._parser.registerCsiHandler({final:"A"},h=>this.cursorUp(h)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},h=>this.scrollRight(h)),this._parser.registerCsiHandler({final:"B"},h=>this.cursorDown(h)),this._parser.registerCsiHandler({final:"C"},h=>this.cursorForward(h)),this._parser.registerCsiHandler({final:"D"},h=>this.cursorBackward(h)),this._parser.registerCsiHandler({final:"E"},h=>this.cursorNextLine(h)),this._parser.registerCsiHandler({final:"F"},h=>this.cursorPrecedingLine(h)),this._parser.registerCsiHandler({final:"G"},h=>this.cursorCharAbsolute(h)),this._parser.registerCsiHandler({final:"H"},h=>this.cursorPosition(h)),this._parser.registerCsiHandler({final:"I"},h=>this.cursorForwardTab(h)),this._parser.registerCsiHandler({final:"J"},h=>this.eraseInDisplay(h,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},h=>this.eraseInDisplay(h,!0)),this._parser.registerCsiHandler({final:"K"},h=>this.eraseInLine(h,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},h=>this.eraseInLine(h,!0)),this._parser.registerCsiHandler({final:"L"},h=>this.insertLines(h)),this._parser.registerCsiHandler({final:"M"},h=>this.deleteLines(h)),this._parser.registerCsiHandler({final:"P"},h=>this.deleteChars(h)),this._parser.registerCsiHandler({final:"S"},h=>this.scrollUp(h)),this._parser.registerCsiHandler({final:"T"},h=>this.scrollDown(h)),this._parser.registerCsiHandler({final:"X"},h=>this.eraseChars(h)),this._parser.registerCsiHandler({final:"Z"},h=>this.cursorBackwardTab(h)),this._parser.registerCsiHandler({final:"`"},h=>this.charPosAbsolute(h)),this._parser.registerCsiHandler({final:"a"},h=>this.hPositionRelative(h)),this._parser.registerCsiHandler({final:"b"},h=>this.repeatPrecedingCharacter(h)),this._parser.registerCsiHandler({final:"c"},h=>this.sendDeviceAttributesPrimary(h)),this._parser.registerCsiHandler({prefix:">",final:"c"},h=>this.sendDeviceAttributesSecondary(h)),this._parser.registerCsiHandler({final:"d"},h=>this.linePosAbsolute(h)),this._parser.registerCsiHandler({final:"e"},h=>this.vPositionRelative(h)),this._parser.registerCsiHandler({final:"f"},h=>this.hVPosition(h)),this._parser.registerCsiHandler({final:"g"},h=>this.tabClear(h)),this._parser.registerCsiHandler({final:"h"},h=>this.setMode(h)),this._parser.registerCsiHandler({prefix:"?",final:"h"},h=>this.setModePrivate(h)),this._parser.registerCsiHandler({final:"l"},h=>this.resetMode(h)),this._parser.registerCsiHandler({prefix:"?",final:"l"},h=>this.resetModePrivate(h)),this._parser.registerCsiHandler({final:"m"},h=>this.charAttributes(h)),this._parser.registerCsiHandler({final:"n"},h=>this.deviceStatus(h)),this._parser.registerCsiHandler({prefix:"?",final:"n"},h=>this.deviceStatusPrivate(h)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},h=>this.softReset(h)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},h=>this.setCursorStyle(h)),this._parser.registerCsiHandler({final:"r"},h=>this.setScrollRegion(h)),this._parser.registerCsiHandler({final:"s"},h=>this.saveCursor(h)),this._parser.registerCsiHandler({final:"t"},h=>this.windowOptions(h)),this._parser.registerCsiHandler({final:"u"},h=>this.restoreCursor(h)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},h=>this.insertColumns(h)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},h=>this.deleteColumns(h)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},h=>this.selectProtected(h)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},h=>this.requestMode(h,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},h=>this.requestMode(h,!1)),this._parser.setExecuteHandler(k.BEL,()=>this.bell()),this._parser.setExecuteHandler(k.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(k.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(k.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(k.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(k.BS,()=>this.backspace()),this._parser.setExecuteHandler(k.HT,()=>this.tab()),this._parser.setExecuteHandler(k.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(k.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(nr.IND,()=>this.index()),this._parser.setExecuteHandler(nr.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(nr.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new wt(h=>(this.setTitle(h),this.setIconName(h),!0))),this._parser.registerOscHandler(1,new wt(h=>this.setIconName(h))),this._parser.registerOscHandler(2,new wt(h=>this.setTitle(h))),this._parser.registerOscHandler(4,new wt(h=>this.setOrReportIndexedColor(h))),this._parser.registerOscHandler(8,new wt(h=>this.setHyperlink(h))),this._parser.registerOscHandler(10,new wt(h=>this.setOrReportFgColor(h))),this._parser.registerOscHandler(11,new wt(h=>this.setOrReportBgColor(h))),this._parser.registerOscHandler(12,new wt(h=>this.setOrReportCursorColor(h))),this._parser.registerOscHandler(104,new wt(h=>this.restoreIndexedColor(h))),this._parser.registerOscHandler(110,new wt(h=>this.restoreFgColor(h))),this._parser.registerOscHandler(111,new wt(h=>this.restoreBgColor(h))),this._parser.registerOscHandler(112,new wt(h=>this.restoreCursorColor(h))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let h in qe)this._parser.registerEscHandler({intermediates:"(",final:h},()=>this.selectCharset("("+h)),this._parser.registerEscHandler({intermediates:")",final:h},()=>this.selectCharset(")"+h)),this._parser.registerEscHandler({intermediates:"*",final:h},()=>this.selectCharset("*"+h)),this._parser.registerEscHandler({intermediates:"+",final:h},()=>this.selectCharset("+"+h)),this._parser.registerEscHandler({intermediates:"-",final:h},()=>this.selectCharset("-"+h)),this._parser.registerEscHandler({intermediates:".",final:h},()=>this.selectCharset("."+h)),this._parser.registerEscHandler({intermediates:"/",final:h},()=>this.selectCharset("/"+h));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(h=>(this._logService.error("Parsing error: ",h),h)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new ta((h,c)=>this.requestStatusString(h,c)))}getAttrData(){return this._curAttrData}_preserveStack(e,t,s,i){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=s,this._parseStack.position=i}_logSlowResolvingAsync(e){this._logService.logLevel<=3&&Promise.race([e,new Promise((t,s)=>setTimeout(()=>s("#SLOW_TIMEOUT"),na))]).catch(t=>{if(t!=="#SLOW_TIMEOUT")throw t;console.warn(`async parser handler taking longer than ${na} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let s,i=this._activeBuffer.x,r=this._activeBuffer.y,n=0,o=this._parseStack.paused;if(o){if(s=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(s),s;i=this._parseStack.cursorStartX,r=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>_s&&(n=this._parseStack.position+_s)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof e=="string"?` "${e}"`:` "${Array.prototype.map.call(e,h=>String.fromCharCode(h)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof e=="string"?e.split("").map(h=>h.charCodeAt(0)):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<_s&&(this._parseBuffer=new Uint32Array(Math.min(e.length,_s))),o||this._dirtyRowTracker.clearRange(),e.length>_s)for(let h=n;h<e.length;h+=_s){let c=h+_s<e.length?h+_s:e.length,u=typeof e=="string"?this._stringDecoder.decode(e.substring(h,c),this._parseBuffer):this._utf8Decoder.decode(e.subarray(h,c),this._parseBuffer);if(s=this._parser.parse(this._parseBuffer,u))return this._preserveStack(i,r,u,h),this._logSlowResolvingAsync(s),s}else if(!o){let h=typeof e=="string"?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(s=this._parser.parse(this._parseBuffer,h))return this._preserveStack(i,r,h,0),this._logSlowResolvingAsync(s),s}(this._activeBuffer.x!==i||this._activeBuffer.y!==r)&&this._onCursorMove.fire();let l=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),a=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);a<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(a,this._bufferService.rows-1),end:Math.min(l,this._bufferService.rows-1)})}print(e,t,s){let i,r,n=this._charsetService.charset,o=this._optionsService.rawOptions.screenReaderMode,l=this._bufferService.cols,a=this._coreService.decPrivateModes.wraparound,h=this._coreService.modes.insertMode,c=this._curAttrData,u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&s-t>0&&u.getWidth(this._activeBuffer.x-1)===2&&u.setCellFromCodepoint(this._activeBuffer.x-1,0,1,c);let d=this._parser.precedingJoinState;for(let _=t;_<s;++_){if(i=e[_],i<127&&n){let S=n[String.fromCharCode(i)];S&&(i=S.charCodeAt(0))}let p=this._unicodeService.charProperties(i,d);r=Ps.extractWidth(p);let f=Ps.extractShouldJoin(p),v=f?Ps.extractWidth(d):0;if(d=p,o&&this._onA11yChar.fire(Ss(i)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+r-v>l){if(a){let S=u,C=this._activeBuffer.x-v;for(this._activeBuffer.x=v,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),v>0&&u instanceof _i&&u.copyCellsFrom(S,C,0,v,!1);C<l;)S.setCellFromCodepoint(C++,0,1,c)}else if(this._activeBuffer.x=l-1,r===2)continue}if(f&&this._activeBuffer.x){let S=u.getWidth(this._activeBuffer.x-1)?1:2;u.addCodepointToCell(this._activeBuffer.x-S,i,r);for(let C=r-v;--C>=0;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,c);continue}if(h&&(u.insertCells(this._activeBuffer.x,r-v,this._activeBuffer.getNullCell(c)),u.getWidth(l-1)===2&&u.setCellFromCodepoint(l-1,0,1,c)),u.setCellFromCodepoint(this._activeBuffer.x++,i,r,c),r>0)for(;--r;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,c)}this._parser.precedingJoinState=d,this._activeBuffer.x<l&&s-t>0&&u.getWidth(this._activeBuffer.x)===0&&!u.hasContent(this._activeBuffer.x)&&u.setCellFromCodepoint(this._activeBuffer.x,0,1,c),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return e.final==="t"&&!e.prefix&&!e.intermediates?this._parser.registerCsiHandler(e,s=>ra(s.params[0],this._optionsService.rawOptions.windowOptions)?t(s):!0):this._parser.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new ta(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new wt(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var e;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&e.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);t.hasWidth(this._activeBuffer.x)&&!t.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){let t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){let t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){let t=e.params[0];return t===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:t===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){let t=e.params[0];return t===1&&(this._curAttrData.bg|=536870912),(t===2||t===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,s,i=!1,r=!1){let n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.replaceCells(t,s,this._activeBuffer.getNullCell(this._eraseAttrData()),r),i&&(n.isWrapped=!1)}_resetBufferLine(e,t=!1){let s=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);s&&(s.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),s.isWrapped=!1)}eraseInDisplay(e,t=!1){var i;this._restrictCursor(this._bufferService.cols);let s;switch(e.params[0]){case 0:for(s=this._activeBuffer.y,this._dirtyRowTracker.markDirty(s),this._eraseInBufferLine(s++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);s<this._bufferService.rows;s++)this._resetBufferLine(s,t);this._dirtyRowTracker.markDirty(s);break;case 1:for(s=this._activeBuffer.y,this._dirtyRowTracker.markDirty(s),this._eraseInBufferLine(s,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(s+1).isWrapped=!1);s--;)this._resetBufferLine(s,t);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(s=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,s-1);s--&&!((i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s))!=null&&i.getTrimmedLength()););for(;s>=0;s--)this._bufferService.scroll(this._eraseAttrData())}else{for(s=this._bufferService.rows,this._dirtyRowTracker.markDirty(s-1);s--;)this._resetBufferLine(s,t);this._dirtyRowTracker.markDirty(0)}break;case 3:let r=this._activeBuffer.lines.length-this._bufferService.rows;r>0&&(this._activeBuffer.lines.trimStart(r),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-r,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-r,0),this._onScroll.fire(0));break}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let s=this._activeBuffer.ybase+this._activeBuffer.y,i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-i+1;for(;t--;)this._activeBuffer.lines.splice(r-1,1),this._activeBuffer.lines.splice(s,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let s=this._activeBuffer.ybase+this._activeBuffer.y,i;for(i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,i=this._bufferService.rows-1+this._activeBuffer.ybase-i;t--;)this._activeBuffer.lines.splice(s,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(Fe));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){let t=this._parser.precedingJoinState;if(!t)return!0;let s=e.params[0]||1,i=Ps.extractWidth(t),r=this._activeBuffer.x-i,n=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(r),o=new Uint32Array(n.length*s),l=0;for(let h=0;h<n.length;){let c=n.codePointAt(h)||0;o[l++]=c,h+=c>65535?2:1}let a=l;for(let h=1;h<s;++h)o.copyWithin(a,0,l),a+=l;return this.print(o,0,a),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(k.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(k.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(k.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(k.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(k.ESC+"[>83;40003;0c")),!0}_is(e){return(this._optionsService.rawOptions.termName+"").indexOf(e)===0}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,Ts),this._charsetService.setgCharset(1,Ts),this._charsetService.setgCharset(2,Ts),this._charsetService.setgCharset(3,Ts);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),e.params[t]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode(e,t){(f=>(f[f.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",f[f.SET=1]="SET",f[f.RESET=2]="RESET",f[f.PERMANENTLY_SET=3]="PERMANENTLY_SET",f[f.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(void 0||(s={}));let i=this._coreService.decPrivateModes,{activeProtocol:r,activeEncoding:n}=this._coreMouseService,o=this._coreService,{buffers:l,cols:a}=this._bufferService,{active:h,alt:c}=l,u=this._optionsService.rawOptions,d=(f,v)=>(o.triggerDataEvent(`${k.ESC}[${t?"":"?"}${f};${v}$y`),!0),_=f=>f?1:2,p=e.params[0];return t?p===2?d(p,4):p===4?d(p,_(o.modes.insertMode)):p===12?d(p,3):p===20?d(p,_(u.convertEol)):d(p,0):p===1?d(p,_(i.applicationCursorKeys)):p===3?d(p,u.windowOptions.setWinLines?a===80?2:a===132?1:0:0):p===6?d(p,_(i.origin)):p===7?d(p,_(i.wraparound)):p===8?d(p,3):p===9?d(p,_(r==="X10")):p===12?d(p,_(u.cursorBlink)):p===25?d(p,_(!o.isCursorHidden)):p===45?d(p,_(i.reverseWraparound)):p===66?d(p,_(i.applicationKeypad)):p===67?d(p,4):p===1e3?d(p,_(r==="VT200")):p===1002?d(p,_(r==="DRAG")):p===1003?d(p,_(r==="ANY")):p===1004?d(p,_(i.sendFocus)):p===1005?d(p,4):p===1006?d(p,_(n==="SGR")):p===1015?d(p,4):p===1016?d(p,_(n==="SGR_PIXELS")):p===1048?d(p,1):p===47||p===1047||p===1049?d(p,_(h===c)):p===2004?d(p,_(i.bracketedPasteMode)):p===2026?d(p,_(i.synchronizedOutput)):d(p,0)}_updateAttrColor(e,t,s,i,r){return t===2?(e|=50331648,e&=-16777216,e|=$i.fromColorRGB([s,i,r])):t===5&&(e&=-50331904,e|=33554432|s&255),e}_extractColor(e,t,s){let i=[0,0,-1,0,0,0],r=0,n=0;do{if(i[n+r]=e.params[t+n],e.hasSubParams(t+n)){let o=e.getSubParams(t+n),l=0;do i[1]===5&&(r=1),i[n+l+1+r]=o[l];while(++l<o.length&&l+n+1+r<i.length);break}if(i[1]===5&&n+r>=2||i[1]===2&&n+r>=5)break;i[1]&&(r=1)}while(++n+t<e.length&&n+r<i.length);for(let o=2;o<i.length;++o)i[o]===-1&&(i[o]=0);switch(i[0]){case 38:s.fg=this._updateAttrColor(s.fg,i[1],i[3],i[4],i[5]);break;case 48:s.bg=this._updateAttrColor(s.bg,i[1],i[3],i[4],i[5]);break;case 58:s.extended=s.extended.clone(),s.extended.underlineColor=this._updateAttrColor(s.extended.underlineColor,i[1],i[3],i[4],i[5])}return n}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,e===0&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=Fe.fg,e.bg=Fe.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(e.length===1&&e.params[0]===0)return this._processSGR0(this._curAttrData),!0;let t=e.length,s,i=this._curAttrData;for(let r=0;r<t;r++)s=e.params[r],s>=30&&s<=37?(i.fg&=-50331904,i.fg|=16777216|s-30):s>=40&&s<=47?(i.bg&=-50331904,i.bg|=16777216|s-40):s>=90&&s<=97?(i.fg&=-50331904,i.fg|=16777216|s-90|8):s>=100&&s<=107?(i.bg&=-50331904,i.bg|=16777216|s-100|8):s===0?this._processSGR0(i):s===1?i.fg|=134217728:s===3?i.bg|=67108864:s===4?(i.fg|=268435456,this._processUnderline(e.hasSubParams(r)?e.getSubParams(r)[0]:1,i)):s===5?i.fg|=536870912:s===7?i.fg|=67108864:s===8?i.fg|=1073741824:s===9?i.fg|=2147483648:s===2?i.bg|=134217728:s===21?this._processUnderline(2,i):s===22?(i.fg&=-134217729,i.bg&=-134217729):s===23?i.bg&=-67108865:s===24?(i.fg&=-268435457,this._processUnderline(0,i)):s===25?i.fg&=-536870913:s===27?i.fg&=-67108865:s===28?i.fg&=-1073741825:s===29?i.fg&=2147483647:s===39?(i.fg&=-67108864,i.fg|=Fe.fg&16777215):s===49?(i.bg&=-67108864,i.bg|=Fe.bg&16777215):s===38||s===48||s===58?r+=this._extractColor(e,r,i):s===53?i.bg|=1073741824:s===55?i.bg&=-1073741825:s===59?(i.extended=i.extended.clone(),i.extended.underlineColor=-1,i.updateExtended()):s===100?(i.fg&=-67108864,i.fg|=Fe.fg&16777215,i.bg&=-67108864,i.bg|=Fe.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",s);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${k.ESC}[0n`);break;case 6:let t=this._activeBuffer.y+1,s=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${k.ESC}[${t};${s}R`);break}return!0}deviceStatusPrivate(e){switch(e.params[0]){case 6:let t=this._activeBuffer.y+1,s=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${k.ESC}[?${t};${s}R`);break}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=Fe.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){let t=e.length===0?1:e.params[0];if(t===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(t){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let s=t%2===1;this._coreService.decPrivateModes.cursorBlink=s}return!0}setScrollRegion(e){let t=e.params[0]||1,s;return(e.length<2||(s=e.params[1])>this._bufferService.rows||s===0)&&(s=this._bufferService.rows),s>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=s-1,this._setCursor(0,0)),!0}windowOptions(e){if(!ra(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;let t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:t!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${k.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(t===0||t===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>ia&&this._windowTitleStack.shift()),(t===0||t===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>ia&&this._iconNameStack.shift());break;case 23:(t===0||t===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(t===0||t===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){let t=[],s=e.split(";");for(;s.length>1;){let i=s.shift(),r=s.shift();if(/^\d+$/.exec(i)){let n=parseInt(i);if(la(n))if(r==="?")t.push({type:0,index:n});else{let o=sa(r);o&&t.push({type:1,index:n,color:o})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){let t=e.indexOf(";");if(t===-1)return!0;let s=e.slice(0,t).trim(),i=e.slice(t+1);return i?this._createHyperlink(s,i):s.trim()?!1:this._finishHyperlink()}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();let s=e.split(":"),i,r=s.findIndex(n=>n.startsWith("id="));return r!==-1&&(i=s[r].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:i,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){let s=e.split(";");for(let i=0;i<s.length&&!(t>=this._specialColors.length);++i,++t)if(s[i]==="?")this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{let r=sa(s[i]);r&&this._onColor.fire([{type:1,index:this._specialColors[t],color:r}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;let t=[],s=e.split(";");for(let i=0;i<s.length;++i)if(/^\d+$/.exec(s[i])){let r=parseInt(s[i]);la(r)&&t.push({type:2,index:r})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,Ts),!0}selectCharset(e){return e.length!==2?(this.selectDefaultCharset(),!0):(e[0]==="/"||this._charsetService.setgCharset(Lv[e[0]],qe[e[1]]||Ts),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=Fe.clone(),this._eraseAttrDataInternal=Fe.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){let e=new Tt;e.content=1<<22|69,e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){let s=this._activeBuffer.ybase+this._activeBuffer.y+t,i=this._activeBuffer.lines.get(s);i&&(i.fill(e),i.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){let s=o=>(this._coreService.triggerDataEvent(`${k.ESC}${o}${k.ESC}\\`),!0),i=this._bufferService.buffer,r=this._optionsService.rawOptions;return s(e==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:e==='"p'?'P1$r61;1"p':e==="r"?`P1$r${i.scrollTop+1};${i.scrollBottom+1}r`:e==="m"?"P1$r0m":e===" q"?`P1$r${{block:2,underline:4,bar:6}[r.cursorStyle]-(r.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}},oo=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(oa=e,e=t,t=oa),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};oo=Ie([Y(0,_t)],oo);function la(e){return 0<=e&&e<256}var Av=5e7,aa=12,Ov=50,Nv=class extends ce{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new W),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(t!==void 0&&this._syncCalls>t){this._syncCalls=0;return}if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let s;for(;s=this._writeBuffer.shift();){this._action(s);let i=this._callbacks.shift();i&&i()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>Av)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){let s=e||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let i=this._writeBuffer[this._bufferOffset],r=this._action(i,t);if(r){let o=l=>performance.now()-s>=aa?setTimeout(()=>this._innerWrite(0,l)):this._innerWrite(s,l);r.catch(l=>(queueMicrotask(()=>{throw l}),Promise.resolve(!1))).then(o);return}let n=this._callbacks[this._bufferOffset];if(n&&n(),this._bufferOffset++,this._pendingData-=i.length,performance.now()-s>=aa)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>Ov&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},lo=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){let t=this._bufferService.buffer;if(e.id===void 0){let l=t.addMarker(t.ybase+t.y),a={data:e,id:this._nextId++,lines:[l]};return l.onDispose(()=>this._removeMarkerFromLink(a,l)),this._dataByLinkId.set(a.id,a),a.id}let s=e,i=this._getEntryIdKey(s),r=this._entriesWithId.get(i);if(r)return this.addLineToLink(r.id,t.ybase+t.y),r.id;let n=t.addMarker(t.ybase+t.y),o={id:this._nextId++,key:this._getEntryIdKey(s),data:s,lines:[n]};return n.onDispose(()=>this._removeMarkerFromLink(o,n)),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(e,t){let s=this._dataByLinkId.get(e);if(s&&s.lines.every(i=>i.line!==t)){let i=this._bufferService.buffer.addMarker(t);s.lines.push(i),i.onDispose(()=>this._removeMarkerFromLink(s,i))}}getLinkData(e){var t;return(t=this._dataByLinkId.get(e))==null?void 0:t.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){let s=e.lines.indexOf(t);s!==-1&&(e.lines.splice(s,1),e.lines.length===0&&(e.data.id!==void 0&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};lo=Ie([Y(0,_t)],lo);var ha=!1,$v=class extends ce{constructor(e){super(),this._windowsWrappingHeuristics=this._register(new Qs),this._onBinary=this._register(new W),this.onBinary=this._onBinary.event,this._onData=this._register(new W),this.onData=this._onData.event,this._onLineFeed=this._register(new W),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new W),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new W),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new W),this._instantiationService=new av,this.optionsService=this._register(new vv(e)),this._instantiationService.setService(pt,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(so)),this._instantiationService.setService(_t,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(to)),this._instantiationService.setService($h,this._logService),this.coreService=this._register(this._instantiationService.createInstance(io)),this._instantiationService.setService(Hs,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(ro)),this._instantiationService.setService(Nh,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(Ps)),this._instantiationService.setService(rg,this.unicodeService),this._charsetService=this._instantiationService.createInstance(Cv),this._instantiationService.setService(ig,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(lo),this._instantiationService.setService(Hh,this._oscLinkService),this._inputHandler=this._register(new Iv(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(it.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(it.forward(this._bufferService.onResize,this._onResize)),this._register(it.forward(this.coreService.onData,this._onData)),this._register(it.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new Nv((t,s)=>this._inputHandler.parse(t,s))),this._register(it.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new W),this._onScroll.event(e=>{var t;(t=this._onScrollApi)==null||t.fire(e.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(let t in e)this.optionsService.options[t]=e[t]}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=3&&!ha&&(this._logService.warn("writeSync is unreliable and will be removed soon."),ha=!0),this._writeBuffer.writeSync(e,t)}input(e,t=!0){this.coreService.triggerDataEvent(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,mc),t=Math.max(t,vc),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t){this._bufferService.scrollLines(e,t)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1,t=this.optionsService.rawOptions.windowsPty;t&&t.buildNumber!==void 0&&t.buildNumber!==void 0?e=t.backend==="conpty"&&t.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let e=[];e.push(this.onLineFeed(ea.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},()=>(ea(this._bufferService),!1))),this._windowsWrappingHeuristics.value=Re(()=>{for(let t of e)t.dispose()})}}},Hv={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function Wv(e,t,s,i){var o;let r={type:0,cancel:!1,key:void 0},n=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:e.key==="UIKeyInputUpArrow"?t?r.key=k.ESC+"OA":r.key=k.ESC+"[A":e.key==="UIKeyInputLeftArrow"?t?r.key=k.ESC+"OD":r.key=k.ESC+"[D":e.key==="UIKeyInputRightArrow"?t?r.key=k.ESC+"OC":r.key=k.ESC+"[C":e.key==="UIKeyInputDownArrow"&&(t?r.key=k.ESC+"OB":r.key=k.ESC+"[B");break;case 8:r.key=e.ctrlKey?"\b":k.DEL,e.altKey&&(r.key=k.ESC+r.key);break;case 9:if(e.shiftKey){r.key=k.ESC+"[Z";break}r.key=k.HT,r.cancel=!0;break;case 13:r.key=e.altKey?k.ESC+k.CR:k.CR,r.cancel=!0;break;case 27:r.key=k.ESC,e.altKey&&(r.key=k.ESC+k.ESC),r.cancel=!0;break;case 37:if(e.metaKey)break;n?r.key=k.ESC+"[1;"+(n+1)+"D":t?r.key=k.ESC+"OD":r.key=k.ESC+"[D";break;case 39:if(e.metaKey)break;n?r.key=k.ESC+"[1;"+(n+1)+"C":t?r.key=k.ESC+"OC":r.key=k.ESC+"[C";break;case 38:if(e.metaKey)break;n?r.key=k.ESC+"[1;"+(n+1)+"A":t?r.key=k.ESC+"OA":r.key=k.ESC+"[A";break;case 40:if(e.metaKey)break;n?r.key=k.ESC+"[1;"+(n+1)+"B":t?r.key=k.ESC+"OB":r.key=k.ESC+"[B";break;case 45:!e.shiftKey&&!e.ctrlKey&&(r.key=k.ESC+"[2~");break;case 46:n?r.key=k.ESC+"[3;"+(n+1)+"~":r.key=k.ESC+"[3~";break;case 36:n?r.key=k.ESC+"[1;"+(n+1)+"H":t?r.key=k.ESC+"OH":r.key=k.ESC+"[H";break;case 35:n?r.key=k.ESC+"[1;"+(n+1)+"F":t?r.key=k.ESC+"OF":r.key=k.ESC+"[F";break;case 33:e.shiftKey?r.type=2:e.ctrlKey?r.key=k.ESC+"[5;"+(n+1)+"~":r.key=k.ESC+"[5~";break;case 34:e.shiftKey?r.type=3:e.ctrlKey?r.key=k.ESC+"[6;"+(n+1)+"~":r.key=k.ESC+"[6~";break;case 112:n?r.key=k.ESC+"[1;"+(n+1)+"P":r.key=k.ESC+"OP";break;case 113:n?r.key=k.ESC+"[1;"+(n+1)+"Q":r.key=k.ESC+"OQ";break;case 114:n?r.key=k.ESC+"[1;"+(n+1)+"R":r.key=k.ESC+"OR";break;case 115:n?r.key=k.ESC+"[1;"+(n+1)+"S":r.key=k.ESC+"OS";break;case 116:n?r.key=k.ESC+"[15;"+(n+1)+"~":r.key=k.ESC+"[15~";break;case 117:n?r.key=k.ESC+"[17;"+(n+1)+"~":r.key=k.ESC+"[17~";break;case 118:n?r.key=k.ESC+"[18;"+(n+1)+"~":r.key=k.ESC+"[18~";break;case 119:n?r.key=k.ESC+"[19;"+(n+1)+"~":r.key=k.ESC+"[19~";break;case 120:n?r.key=k.ESC+"[20;"+(n+1)+"~":r.key=k.ESC+"[20~";break;case 121:n?r.key=k.ESC+"[21;"+(n+1)+"~":r.key=k.ESC+"[21~";break;case 122:n?r.key=k.ESC+"[23;"+(n+1)+"~":r.key=k.ESC+"[23~";break;case 123:n?r.key=k.ESC+"[24;"+(n+1)+"~":r.key=k.ESC+"[24~";break;default:if(e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey)e.keyCode>=65&&e.keyCode<=90?r.key=String.fromCharCode(e.keyCode-64):e.keyCode===32?r.key=k.NUL:e.keyCode>=51&&e.keyCode<=55?r.key=String.fromCharCode(e.keyCode-51+27):e.keyCode===56?r.key=k.DEL:e.keyCode===219?r.key=k.ESC:e.keyCode===220?r.key=k.FS:e.keyCode===221&&(r.key=k.GS);else if((!s||i)&&e.altKey&&!e.metaKey){let l=(o=Hv[e.keyCode])==null?void 0:o[e.shiftKey?1:0];if(l)r.key=k.ESC+l;else if(e.keyCode>=65&&e.keyCode<=90){let a=e.ctrlKey?e.keyCode-64:e.keyCode+32,h=String.fromCharCode(a);e.shiftKey&&(h=h.toUpperCase()),r.key=k.ESC+h}else if(e.keyCode===32)r.key=k.ESC+(e.ctrlKey?k.NUL:" ");else if(e.key==="Dead"&&e.code.startsWith("Key")){let a=e.code.slice(3,4);e.shiftKey||(a=a.toLowerCase()),r.key=k.ESC+a,r.cancel=!0}}else s&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&e.metaKey?e.keyCode===65&&(r.type=1):e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&e.key.length===1?r.key=e.key:e.key&&e.ctrlKey&&(e.key==="_"&&(r.key=k.US),e.key==="@"&&(r.key=k.NUL));break}return r}var Oe=0,Fv=class{constructor(e){this._getKey=e,this._array=[],this._insertedValues=[],this._flushInsertedTask=new yr,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new yr,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(e){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(e)}_flushInserted(){let e=this._insertedValues.sort((r,n)=>this._getKey(r)-this._getKey(n)),t=0,s=0,i=new Array(this._array.length+this._insertedValues.length);for(let r=0;r<i.length;r++)s>=this._array.length||this._getKey(e[t])<=this._getKey(this._array[s])?(i[r]=e[t],t++):i[r]=this._array[s++];this._array=i,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(e){if(this._flushCleanupInserted(),this._array.length===0)return!1;let t=this._getKey(e);if(t===void 0||(Oe=this._search(t),Oe===-1)||this._getKey(this._array[Oe])!==t)return!1;do if(this._array[Oe]===e)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(Oe),!0;while(++Oe<this._array.length&&this._getKey(this._array[Oe])===t);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let e=this._deletedIndices.sort((r,n)=>r-n),t=0,s=new Array(this._array.length-e.length),i=0;for(let r=0;r<this._array.length;r++)e[t]===r?t++:s[i++]=this._array[r];this._array=s,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(e){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(Oe=this._search(e),!(Oe<0||Oe>=this._array.length)&&this._getKey(this._array[Oe])===e))do yield this._array[Oe];while(++Oe<this._array.length&&this._getKey(this._array[Oe])===e)}forEachByKey(e,t){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(Oe=this._search(e),!(Oe<0||Oe>=this._array.length)&&this._getKey(this._array[Oe])===e))do t(this._array[Oe]);while(++Oe<this._array.length&&this._getKey(this._array[Oe])===e)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(e){let t=0,s=this._array.length-1;for(;s>=t;){let i=t+s>>1,r=this._getKey(this._array[i]);if(r>e)s=i-1;else if(r<e)t=i+1;else{for(;i>0&&this._getKey(this._array[i-1])===e;)i--;return i}}return t}},fn=0,ca=0,zv=class extends ce{constructor(){super(),this._decorations=new Fv(e=>e==null?void 0:e.marker.line),this._onDecorationRegistered=this._register(new W),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new W),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(Re(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(e){if(e.marker.isDisposed)return;let t=new Kv(e);if(t){let s=t.marker.onDispose(()=>t.dispose()),i=t.onDispose(()=>{i.dispose(),t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),s.dispose())});this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(let e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,s){let i=0,r=0;for(let n of this._decorations.getKeyIterator(t))i=n.options.x??0,r=i+(n.options.width??1),e>=i&&e<r&&(!s||(n.options.layer??"bottom")===s)&&(yield n)}forEachDecorationAtCell(e,t,s,i){this._decorations.forEachByKey(t,r=>{fn=r.options.x??0,ca=fn+(r.options.width??1),e>=fn&&e<ca&&(!s||(r.options.layer??"bottom")===s)&&i(r)})}},Kv=class extends ws{constructor(e){super(),this.options=e,this.onRenderEmitter=this.add(new W),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new W),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=Te.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=Te.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},Uv=1e3,Vv=class{constructor(e,t=Uv){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,s){this._rowCount=s,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t;let i=performance.now();if(i-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=i,this._innerRefresh();else if(!this._additionalRefreshRequested){let r=i-this._lastRefreshMs,n=this._debounceThresholdMS-r;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},n)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}},ua=20,wr=class extends ce{constructor(e,t,s,i){super(),this._terminal=e,this._coreBrowserService=s,this._renderService=i,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let r=this._coreBrowserService.mainDocument;this._accessibilityContainer=r.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=r.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let n=0;n<this._terminal.rows;n++)this._rowElements[n]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[n]);if(this._topBoundaryFocusListener=n=>this._handleBoundaryFocus(n,0),this._bottomBoundaryFocusListener=n=>this._handleBoundaryFocus(n,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=r.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new Vv(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize(n=>this._handleResize(n.rows))),this._register(this._terminal.onRender(n=>this._refreshRows(n.start,n.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar(n=>this._handleChar(n))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab(n=>this._handleTab(n))),this._register(this._terminal.onKey(n=>this._handleKey(n.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(se(r,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(Re(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<ua+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===ua+1&&(this._liveRegion.textContent+=Mn.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){let s=this._terminal.buffer,i=s.lines.length.toString();for(let r=e;r<=t;r++){let n=s.lines.get(s.ydisp+r),o=[],l=(n==null?void 0:n.translateToString(!0,void 0,void 0,o))||"",a=(s.ydisp+r+1).toString(),h=this._rowElements[r];h&&(l.length===0?(h.textContent="",this._rowColumns.set(h,[0,1])):(h.textContent=l,this._rowColumns.set(h,o)),h.setAttribute("aria-posinset",a),h.setAttribute("aria-setsize",i),this._alignRowWidth(h))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){let s=e.target,i=this._rowElements[t===0?1:this._rowElements.length-2],r=s.getAttribute("aria-posinset"),n=t===0?"1":`${this._terminal.buffer.lines.length}`;if(r===n||e.relatedTarget!==i)return;let o,l;if(t===0?(o=s,l=this._rowElements.pop(),this._rowContainer.removeChild(l)):(o=this._rowElements.shift(),l=s,this._rowContainer.removeChild(o)),o.removeEventListener("focus",this._topBoundaryFocusListener),l.removeEventListener("focus",this._bottomBoundaryFocusListener),t===0){let a=this._createAccessibilityTreeNode();this._rowElements.unshift(a),this._rowContainer.insertAdjacentElement("afterbegin",a)}else{let a=this._createAccessibilityTreeNode();this._rowElements.push(a),this._rowContainer.appendChild(a)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(t===0?-1:1),this._rowElements[t===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){var l;if(this._rowElements.length===0)return;let e=this._coreBrowserService.mainDocument.getSelection();if(!e)return;if(e.isCollapsed){this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection();return}if(!e.anchorNode||!e.focusNode){console.error("anchorNode and/or focusNode are null");return}let t={node:e.anchorNode,offset:e.anchorOffset},s={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(s.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===s.node&&t.offset>s.offset)&&([t,s]=[s,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;let i=this._rowElements.slice(-1)[0];if(s.node.compareDocumentPosition(i)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(s={node:i,offset:((l=i.textContent)==null?void 0:l.length)??0}),!this._rowContainer.contains(s.node))return;let r=({node:a,offset:h})=>{let c=a instanceof Text?a.parentNode:a,u=parseInt(c==null?void 0:c.getAttribute("aria-posinset"),10)-1;if(isNaN(u))return console.warn("row is invalid. Race condition?"),null;let d=this._rowColumns.get(c);if(!d)return console.warn("columns is null. Race condition?"),null;let _=h<d.length?d[h]:d.slice(-1)[0]+1;return _>=this._terminal.cols&&(++u,_=0),{row:u,column:_}},n=r(t),o=r(s);if(!(!n||!o)){if(n.row>o.row||n.row===o.row&&n.column>=o.column)throw new Error("invalid range");this._terminal.select(n.column,n.row,(o.row-n.row)*this._terminal.cols-n.column+o.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e]),this._alignRowWidth(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(e){var r,n;e.style.transform="";let t=e.getBoundingClientRect().width,s=(n=(r=this._rowColumns.get(e))==null?void 0:r.slice(-1))==null?void 0:n[0];if(!s)return;let i=s*this._renderService.dimensions.css.cell.width;e.style.transform=`scaleX(${i/t})`}};wr=Ie([Y(1,Eo),Y(2,hs),Y(3,cs)],wr);var ao=class extends ce{constructor(e,t,s,i,r){super(),this._element=e,this._mouseService=t,this._renderService=s,this._bufferService=i,this._linkProviderService=r,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new W),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new W),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(Re(()=>{var n;Ns(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,(n=this._activeProviderReplies)==null||n.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(se(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(se(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(se(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(se(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(e){this._lastMouseEvent=e;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;let s=e.composedPath();for(let i=0;i<s.length;i++){let r=s[i];if(r.classList.contains("xterm"))break;if(r.classList.contains("xterm-hover"))return}(!this._lastBufferCell||t.x!==this._lastBufferCell.x||t.y!==this._lastBufferCell.y)&&(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized){this._clearCurrentLink(),this._askForLink(e,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){var i,r;(!this._activeProviderReplies||!t)&&((i=this._activeProviderReplies)==null||i.forEach(n=>{n==null||n.forEach(o=>{o.link.dispose&&o.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let s=!1;for(let[n,o]of this._linkProviderService.linkProviders.entries())t?(r=this._activeProviderReplies)!=null&&r.get(n)&&(s=this._checkLinkProviderResult(n,e,s)):o.provideLinks(e.y,l=>{var h,c;if(this._isMouseOut)return;let a=l==null?void 0:l.map(u=>({link:u}));(h=this._activeProviderReplies)==null||h.set(n,a),s=this._checkLinkProviderResult(n,e,s),((c=this._activeProviderReplies)==null?void 0:c.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,t){let s=new Set;for(let i=0;i<t.size;i++){let r=t.get(i);if(r)for(let n=0;n<r.length;n++){let o=r[n],l=o.link.range.start.y<e?0:o.link.range.start.x,a=o.link.range.end.y>e?this._bufferService.cols:o.link.range.end.x;for(let h=l;h<=a;h++){if(s.has(h)){r.splice(n--,1);break}s.add(h)}}}}_checkLinkProviderResult(e,t,s){var n;if(!this._activeProviderReplies)return s;let i=this._activeProviderReplies.get(e),r=!1;for(let o=0;o<e;o++)(!this._activeProviderReplies.has(o)||this._activeProviderReplies.get(o))&&(r=!0);if(!r&&i){let o=i.find(l=>this._linkAtPosition(l.link,t));o&&(s=!0,this._handleNewLink(o))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!s)for(let o=0;o<this._activeProviderReplies.size;o++){let l=(n=this._activeProviderReplies.get(o))==null?void 0:n.find(a=>this._linkAtPosition(a.link,t));if(l){s=!0,this._handleNewLink(l);break}}return s}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._currentLink)return;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink&&jv(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){!this._currentLink||!this._lastMouseEvent||(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,Ns(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(e){if(!this._lastMouseEvent)return;let t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0?!0:e.link.decorations.underline,pointerCursor:e.link.decorations===void 0?!0:e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var s,i;return(i=(s=this._currentLink)==null?void 0:s.state)==null?void 0:i.decorations.pointerCursor},set:s=>{var i;(i=this._currentLink)!=null&&i.state&&this._currentLink.state.decorations.pointerCursor!==s&&(this._currentLink.state.decorations.pointerCursor=s,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",s))}},underline:{get:()=>{var s,i;return(i=(s=this._currentLink)==null?void 0:s.state)==null?void 0:i.decorations.underline},set:s=>{var i,r,n;(i=this._currentLink)!=null&&i.state&&((n=(r=this._currentLink)==null?void 0:r.state)==null?void 0:n.decorations.underline)!==s&&(this._currentLink.state.decorations.underline=s,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,s))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(s=>{if(!this._currentLink)return;let i=s.start===0?0:s.start+1+this._bufferService.buffer.ydisp,r=this._bufferService.buffer.ydisp+1+s.end;if(this._currentLink.link.range.start.y>=i&&this._currentLink.link.range.end.y<=r&&(this._clearCurrentLink(i,r),this._lastMouseEvent)){let n=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);n&&this._askForLink(n,!1)}})))}_linkHover(e,t,s){var i;(i=this._currentLink)!=null&&i.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(s,t.text)}_fireUnderlineEvent(e,t){let s=e.range,i=this._bufferService.buffer.ydisp,r=this._createLinkUnderlineEvent(s.start.x-1,s.start.y-i-1,s.end.x,s.end.y-i-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(r)}_linkLeave(e,t,s){var i;(i=this._currentLink)!=null&&i.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(s,t.text)}_linkAtPosition(e,t){let s=e.range.start.y*this._bufferService.cols+e.range.start.x,i=e.range.end.y*this._bufferService.cols+e.range.end.x,r=t.y*this._bufferService.cols+t.x;return s<=r&&r<=i}_positionFromMouseEvent(e,t,s){let i=s.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,s,i,r){return{x1:e,y1:t,x2:s,y2:i,cols:this._bufferService.cols,fg:r}}};ao=Ie([Y(1,Mo),Y(2,cs),Y(3,_t),Y(4,Fh)],ao);function jv(e,t){return e.text===t.text&&e.range.start.x===t.range.start.x&&e.range.start.y===t.range.start.y&&e.range.end.x===t.range.end.x&&e.range.end.y===t.range.end.y}var qv=class extends $v{constructor(e={}){super(e),this._linkifier=this._register(new Qs),this.browser=oc,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new Qs),this._onCursorMove=this._register(new W),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new W),this.onKey=this._onKey.event,this._onRender=this._register(new W),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new W),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new W),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new W),this.onBell=this._onBell.event,this._onFocus=this._register(new W),this._onBlur=this._register(new W),this._onA11yCharEmitter=this._register(new W),this._onA11yTabEmitter=this._register(new W),this._onWillOpen=this._register(new W),this._setup(),this._decorationService=this._instantiationService.createInstance(zv),this._instantiationService.setService(Hi,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(Om),this._instantiationService.setService(Fh,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(Bn)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows(t=>this.refresh((t==null?void 0:t.start)??0,(t==null?void 0:t.end)??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport(t=>this._reportWindowsOptions(t))),this._register(this._inputHandler.onColor(t=>this._handleColorEvent(t))),this._register(it.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(it.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(it.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(it.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize(t=>this._afterResize(t.cols,t.rows))),this._register(Re(()=>{var t,s;this._customKeyEventHandler=void 0,(s=(t=this.element)==null?void 0:t.parentNode)==null||s.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(e){if(this._themeService)for(let t of e){let s,i="";switch(t.index){case 256:s="foreground",i="10";break;case 257:s="background",i="11";break;case 258:s="cursor",i="12";break;default:s="ansi",i="4;"+t.index}switch(t.type){case 0:let r=ke.toColorRGB(s==="ansi"?this._themeService.colors.ansi[t.index]:this._themeService.colors[s]);this.coreService.triggerDataEvent(`${k.ESC}]${i};${Pv(r)}${rc.ST}`);break;case 1:if(s==="ansi")this._themeService.modifyColors(n=>n.ansi[t.index]=ze.toColor(...t.color));else{let n=s;this._themeService.modifyColors(o=>o[n]=ze.toColor(...t.color))}break;case 2:this._themeService.restoreColor(t.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(wr,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(k.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var e;return(e=this.textarea)==null?void 0:e.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(k.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;let s=Math.min(this.buffer.x,this.cols-1),i=this._renderService.dimensions.css.cell.height,r=t.getWidth(s),n=this._renderService.dimensions.css.cell.width*r,o=this.buffer.y*this._renderService.dimensions.css.cell.height,l=s*this._renderService.dimensions.css.cell.width;this.textarea.style.left=l+"px",this.textarea.style.top=o+"px",this.textarea.style.width=n+"px",this.textarea.style.height=i+"px",this.textarea.style.lineHeight=i+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(se(this.element,"copy",t=>{this.hasSelection()&&Jp(t,this._selectionService)}));let e=t=>Zp(t,this.textarea,this.coreService,this.optionsService);this._register(se(this.textarea,"paste",e)),this._register(se(this.element,"paste",e)),lc?this._register(se(this.element,"mousedown",t=>{t.button===2&&yl(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(se(this.element,"contextmenu",t=>{yl(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),Ao&&this._register(se(this.element,"auxclick",t=>{t.button===1&&Ph(t,this.textarea,this.screenElement)}))}_bindKeys(){this._register(se(this.textarea,"keyup",e=>this._keyUp(e),!0)),this._register(se(this.textarea,"keydown",e=>this._keyDown(e),!0)),this._register(se(this.textarea,"keypress",e=>this._keyPress(e),!0)),this._register(se(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(se(this.textarea,"compositionupdate",e=>this._compositionHelper.compositionupdate(e))),this._register(se(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(se(this.textarea,"input",e=>this._inputEvent(e),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(e){var r;if(!e)throw new Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((r=this.element)==null?void 0:r.ownerDocument.defaultView)&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);let t=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),t.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(se(this.screenElement,"mousemove",n=>this.updateCursorStyle(n))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),t.appendChild(this.screenElement);let s=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",En.get()),cc||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>s.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(Im,this.textarea,e.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(hs,this._coreBrowserService),this._register(se(this.textarea,"focus",n=>this._handleTextAreaFocus(n))),this._register(se(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(Gn,this._document,this._helperContainer),this._instantiationService.setService(Wr,this._charSizeService),this._themeService=this._instantiationService.createInstance(eo),this._instantiationService.setService(ei,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(Sr),this._instantiationService.setService(Wh,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(Zn,this.rows,this.screenElement)),this._instantiationService.setService(cs,this._renderService),this._register(this._renderService.onRenderedViewportChange(n=>this._onRender.fire(n))),this.onResize(n=>this._renderService.resize(n.cols,n.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(qn,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(Jn),this._instantiationService.setService(Mo,this._mouseService);let i=this._linkifier.value=this._register(this._instantiationService.createInstance(ao,this.screenElement));this.element.appendChild(t);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(Vn,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(n=>{super.scrollLines(n,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(Qn,this.element,this.screenElement,i)),this._instantiationService.setService(og,this._selectionService),this._register(this._selectionService.onRequestScrollLines(n=>this.scrollLines(n.amount,n.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw(n=>this._renderService.handleSelectionChanged(n.start,n.end,n.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection(n=>{this.textarea.value=n,this.textarea.focus(),this.textarea.select()})),this._register(it.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{var n;this._selectionService.refresh(),(n=this._viewport)==null||n.queueSync()})),this._register(this._instantiationService.createInstance(jn,this.screenElement)),this._register(se(this.element,"mousedown",n=>this._selectionService.handleMouseDown(n))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(wr,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",n=>this._handleScreenReaderModeOptionChange(n))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(vr,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",n=>{!this._overviewRulerRenderer&&n&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(vr,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(Xn,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let e=this,t=this.element;function s(n){var h,c,u,d,_;let o=e._mouseService.getMouseReportCoords(n,e.screenElement);if(!o)return!1;let l,a;switch(n.overrideType||n.type){case"mousemove":a=32,n.buttons===void 0?(l=3,n.button!==void 0&&(l=n.button<3?n.button:3)):l=n.buttons&1?0:n.buttons&4?1:n.buttons&2?2:3;break;case"mouseup":a=0,l=n.button<3?n.button:3;break;case"mousedown":a=1,l=n.button<3?n.button:3;break;case"wheel":if(e._customWheelEventHandler&&e._customWheelEventHandler(n)===!1)return!1;let p=n.deltaY;if(p===0||e.coreMouseService.consumeWheelEvent(n,(d=(u=(c=(h=e._renderService)==null?void 0:h.dimensions)==null?void 0:c.device)==null?void 0:u.cell)==null?void 0:d.height,(_=e._coreBrowserService)==null?void 0:_.dpr)===0)return!1;a=p<0?0:1,l=4;break;default:return!1}return a===void 0||l===void 0||l>4?!1:e.coreMouseService.triggerMouseEvent({col:o.col,row:o.row,x:o.x,y:o.y,button:l,action:a,ctrl:n.ctrlKey,alt:n.altKey,shift:n.shiftKey})}let i={mouseup:null,wheel:null,mousedrag:null,mousemove:null},r={mouseup:n=>(s(n),n.buttons||(this._document.removeEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.removeEventListener("mousemove",i.mousedrag)),this.cancel(n)),wheel:n=>(s(n),this.cancel(n,!0)),mousedrag:n=>{n.buttons&&s(n)},mousemove:n=>{n.buttons||s(n)}};this._register(this.coreMouseService.onProtocolChange(n=>{n?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(n)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),n&8?i.mousemove||(t.addEventListener("mousemove",r.mousemove),i.mousemove=r.mousemove):(t.removeEventListener("mousemove",i.mousemove),i.mousemove=null),n&16?i.wheel||(t.addEventListener("wheel",r.wheel,{passive:!1}),i.wheel=r.wheel):(t.removeEventListener("wheel",i.wheel),i.wheel=null),n&2?i.mouseup||(i.mouseup=r.mouseup):(this._document.removeEventListener("mouseup",i.mouseup),i.mouseup=null),n&4?i.mousedrag||(i.mousedrag=r.mousedrag):(this._document.removeEventListener("mousemove",i.mousedrag),i.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(se(t,"mousedown",n=>{if(n.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(n)))return s(n),i.mouseup&&this._document.addEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.addEventListener("mousemove",i.mousedrag),this.cancel(n)})),this._register(se(t,"wheel",n=>{var o,l,a,h,c;if(!i.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(n)===!1)return!1;if(!this.buffer.hasScrollback){if(n.deltaY===0)return!1;if(e.coreMouseService.consumeWheelEvent(n,(h=(a=(l=(o=e._renderService)==null?void 0:o.dimensions)==null?void 0:l.device)==null?void 0:a.cell)==null?void 0:h.height,(c=e._coreBrowserService)==null?void 0:c.dpr)===0)return this.cancel(n,!0);let u=k.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(n.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(u,!0),this.cancel(n,!0)}}},{passive:!1}))}refresh(e,t){var s;(s=this._renderService)==null||s.refreshRows(e,t)}updateCursorStyle(e){var t;(t=this._selectionService)!=null&&t.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t){this._viewport?this._viewport.scrollLines(e):super.scrollLines(e,t),this.refresh(0,this.rows-1)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){e&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}paste(e){Th(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}attachCustomWheelEventHandler(e){this._customWheelEventHandler=e}registerLinkProvider(e){return this._linkProviderService.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select(e,t,s){this._selectionService.setSelection(e,t,s)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var e;(e=this._selectionService)==null||e.clearSelection()}selectAll(){var e;(e=this._selectionService)==null||e.selectAll()}selectLines(e,t){var s;(s=this._selectionService)==null||s.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;let t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!t&&(e.key==="Dead"||e.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let s=Wv(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),s.type===3||s.type===2){let i=this.rows-1;return this.scrollLines(s.type===2?-i:i),this.cancel(e,!0)}if(s.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,e)||(s.cancel&&this.cancel(e,!0),!s.key)||e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.key.length===1&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((s.key===k.ETX||s.key===k.CR)&&(this.textarea.value=""),this._onKey.fire({key:s.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(s.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey)return this.cancel(e,!0);this._keyDownHandled=!0}_isThirdLevelShift(e,t){let s=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return t.type==="keypress"?s:s&&(!t.keyCode||t.keyCode>47)}_keyUp(e){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)&&(Yv(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(e.which===null||e.which===void 0)t=e.keyCode;else if(e.which!==0&&e.charCode!==0)t=e.which;else return!1;return!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)?!1:(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(e){if(e.data&&e.inputType==="insertText"&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){if(e===this.cols&&t===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(e,t)}_afterResize(e,t){var s;(s=this._charSizeService)==null||s.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(Fe));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){var t;this.options.rows=this.rows,this.options.cols=this.cols;let e=this._customKeyEventHandler;this._setup(),super.reset(),(t=this._selectionService)==null||t.reset(),this._decorationService.reset(),this._customKeyEventHandler=e,this.refresh(0,this.rows-1)}clearTextureAtlas(){var e;(e=this._renderService)==null||e.clearTextureAtlas()}_reportFocus(){var e;(e=this.element)!=null&&e.classList.contains("focus")?this.coreService.triggerDataEvent(k.ESC+"[I"):this.coreService.triggerDataEvent(k.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case 0:let t=this._renderService.dimensions.css.canvas.width.toFixed(0),s=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${k.ESC}[4;${s};${t}t`);break;case 1:let i=this._renderService.dimensions.css.cell.width.toFixed(0),r=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${k.ESC}[6;${r};${i}t`);break}}cancel(e,t){if(!(!this.options.cancelEvents&&!t))return e.preventDefault(),e.stopPropagation(),!1}};function Yv(e){return e.keyCode===16||e.keyCode===17||e.keyCode===18}var Xv=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){let s={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(s),t.dispose=()=>this._wrappedAddonDispose(s),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let s=0;s<this._addons.length;s++)if(this._addons[s]===e){t=s;break}if(t===-1)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}},Gv=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new Tt)}translateToString(e,t,s){return this._line.translateToString(e,t,s)}},da=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){let t=this._buffer.lines.get(e);if(t)return new Gv(t)}getNullCell(){return new Tt}},Jv=class extends ce{constructor(e){super(),this._core=e,this._onBufferChange=this._register(new W),this.onBufferChange=this._onBufferChange.event,this._normal=new da(this._core.buffers.normal,"normal"),this._alternate=new da(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},Zv=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,s=>t(s.toArray()))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,(s,i)=>t(s,i.toArray()))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}},Qv=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}},e0=["cols","rows"],Ht=0,t0=class extends ce{constructor(e){super(),this._core=this._register(new qv(e)),this._addonManager=this._register(new Xv),this._publicOptions={...this._core.options};let t=i=>this._core.options[i],s=(i,r)=>{this._checkReadonlyOptions(i),this._core.options[i]=r};for(let i in this._core.options){let r={get:t.bind(this,i),set:s.bind(this,i)};Object.defineProperty(this._publicOptions,i,r)}}_checkReadonlyOptions(e){if(e0.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new Zv(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new Qv(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new Jv(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let e=this._core.coreService.decPrivateModes,t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any";break}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,synchronizedOutputMode:e.synchronizedOutput,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(let t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}input(e,t=!0){this._core.input(e,t)}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}attachCustomWheelEventHandler(e){this._core.attachCustomWheelEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){return this._checkProposedApi(),this._verifyPositiveIntegers(e.x??0,e.width??0,e.height??0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,s){this._verifyIntegers(e,t,s),this._core.select(e,t,s)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write(`\r
`,t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return{get promptLabel(){return En.get()},set promptLabel(e){En.set(e)},get tooMuchOutput(){return Mn.get()},set tooMuchOutput(e){Mn.set(e)}}}_verifyIntegers(...e){for(Ht of e)if(Ht===1/0||isNaN(Ht)||Ht%1!==0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(Ht of e)if(Ht&&(Ht===1/0||isNaN(Ht)||Ht%1!==0||Ht<0))throw new Error("This API only accepts positive integers")}};/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var s0=2,i0=1,r0=class{activate(e){this._terminal=e}dispose(){}fit(){let e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;let t=this._terminal._core;(this._terminal.rows!==e.rows||this._terminal.cols!==e.cols)&&(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){var u;if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let e=this._terminal._core._renderService.dimensions;if(e.css.cell.width===0||e.css.cell.height===0)return;let t=this._terminal.options.scrollback===0?0:((u=this._terminal.options.overviewRuler)==null?void 0:u.width)||14,s=window.getComputedStyle(this._terminal.element.parentElement),i=parseInt(s.getPropertyValue("height")),r=Math.max(0,parseInt(s.getPropertyValue("width"))),n=window.getComputedStyle(this._terminal.element),o={top:parseInt(n.getPropertyValue("padding-top")),bottom:parseInt(n.getPropertyValue("padding-bottom")),right:parseInt(n.getPropertyValue("padding-right")),left:parseInt(n.getPropertyValue("padding-left"))},l=o.top+o.bottom,a=o.right+o.left,h=i-l,c=r-a-t;return{cols:Math.max(s0,Math.floor(c/e.css.cell.width)),rows:Math.max(i0,Math.floor(h/e.css.cell.height))}}};const n0={class:"h-full flex flex-col bg-monitor-bg-primary"},o0={class:"p-3 border-b border-slate-700 flex items-center justify-between"},l0={class:"text-xs text-monitor-text-muted"},a0={key:0,class:"flex-1 flex items-center justify-center p-4"},h0={key:1,class:"flex-1 flex flex-col overflow-hidden"},c0={class:"flex border-b border-slate-700 overflow-x-auto"},u0=["onClick"],d0={class:"ml-2"},f0={key:0,class:"ml-2 text-xs text-green-400"},_0={key:0,class:"flex-1 flex flex-col overflow-hidden"},p0={class:"px-3 py-2 bg-slate-800/50 border-b border-slate-700 flex items-center justify-between"},g0={class:"flex items-center space-x-3"},m0={class:"text-xs text-monitor-accent-cyan"},v0={class:"text-xs text-slate-400"},S0={key:1,class:"flex-1 flex items-center justify-center p-4"},b0={key:2,class:"border-t border-slate-700 p-3 bg-green-900/20"},y0={class:"text-xs text-green-400 mb-2"},w0={class:"flex flex-wrap gap-2"},C0=["onClick"],x0=Xt({__name:"WrapperPanel",setup(e){const t=as(),s=fe(null),i=fe(new Map),r=pe(()=>t.wrappers),n=pe(()=>t.activeWrappers),o=pe(()=>t.selectedWrapper),l=pe(()=>t.wrappersWaitingInput);function a(f){if(i.value.has(f))return i.value.get(f);const v=new t0({cursorBlink:!0,cursorStyle:"block",fontSize:13,fontFamily:'Menlo, Monaco, "Courier New", monospace',theme:{background:"#0f172a",foreground:"#e2e8f0",cursor:"#22d3ee",cursorAccent:"#0f172a",selectionBackground:"#334155",black:"#1e293b",red:"#ef4444",green:"#22c55e",yellow:"#eab308",blue:"#3b82f6",magenta:"#a855f7",cyan:"#22d3ee",white:"#f1f5f9",brightBlack:"#475569",brightRed:"#f87171",brightGreen:"#4ade80",brightYellow:"#facc15",brightBlue:"#60a5fa",brightMagenta:"#c084fc",brightCyan:"#67e8f9",brightWhite:"#f8fafc"},scrollback:1e4,convertEol:!1,allowProposedApi:!0}),S=new r0;return v.loadAddon(S),v.onData(C=>{t.injectInput(f,C)}),v.onResize(({cols:C,rows:I})=>{t.resizeWrapper(f,C,I)}),i.value.set(f,{terminal:v,fitAddon:S}),{terminal:v,fitAddon:S}}async function h(f){if(await Js(),!s.value)return;const v=a(f);if(!v)return;const{terminal:S,fitAddon:C}=v;if(s.value.querySelector(".xterm")){try{C.fit()}catch{}return}s.value.innerHTML="",S.open(s.value),await Js();try{C.fit(),t.resizeWrapper(f,S.cols,S.rows)}catch{}S.focus()}function c(f,v){const S=i.value.get(f);S&&S.terminal.write(v)}Is(()=>t.selectedWrapperId,async(f,v)=>{if(f){await h(f);const S=i.value.get(f);S&&S.terminal.focus()}},{immediate:!0}),Is(()=>t.lastWrapperOutput,f=>{f&&c(f.wrapperId,f.data)});function u(){if(t.selectedWrapperId){const f=i.value.get(t.selectedWrapperId);if(f)try{f.fitAddon.fit()}catch{}}}Ir(()=>{window.addEventListener("resize",u)}),Oi(()=>{window.removeEventListener("resize",u);for(const[,{terminal:f}]of i.value)f.dispose();i.value.clear()});function d(f){t.selectWrapper(f)}function _(f){switch(f){case"waiting_input":return"text-green-400";case"processing":return"text-yellow-400";case"starting":return"text-blue-400";case"ended":return"text-gray-500";default:return"text-gray-400"}}function p(f){switch(f){case"waiting_input":return"";case"processing":return"";case"starting":return"";case"ended":return"";default:return""}}return(f,v)=>(M(),B("div",n0,[m("div",o0,[v[1]||(v[1]=m("h2",{class:"text-sm font-medium text-monitor-text-secondary uppercase tracking-wide"}," Claude Wrappers ",-1)),m("span",l0,j(n.value.length)+" active ",1)]),r.value.length===0?(M(),B("div",a0,[...v[2]||(v[2]=[m("div",{class:"text-center text-monitor-text-muted"},[m("p",{class:"text-sm"},"No wrapper sessions"),m("p",{class:"text-xs mt-2"},[dt("Run "),m("code",{class:"bg-slate-700 px-1 rounded"},"contextuate claude"),dt(" to start")])],-1)])])):(M(),B("div",h0,[m("div",c0,[(M(!0),B(ye,null,ft(r.value,S=>(M(),B("button",{key:S.wrapperId,class:Se(["px-3 py-2 text-sm whitespace-nowrap border-b-2 transition-colors",[Ne(t).selectedWrapperId===S.wrapperId?"border-monitor-accent-cyan text-monitor-accent-cyan bg-slate-800":"border-transparent text-monitor-text-secondary hover:text-monitor-text-primary hover:bg-slate-800/50"]]),onClick:C=>d(S.wrapperId)},[m("span",{class:Se(_(S.state))},j(p(S.state)),3),m("span",d0,j(S.wrapperId),1),S.state==="waiting_input"?(M(),B("span",f0,"(ready)")):Q("",!0)],10,u0))),128))]),o.value?(M(),B("div",_0,[m("div",p0,[m("div",g0,[v[4]||(v[4]=m("span",{class:"text-xs text-monitor-text-muted"},"ID:",-1)),m("code",m0,j(o.value.wrapperId),1),v[5]||(v[5]=m("span",{class:"text-xs text-monitor-text-muted"},"State:",-1)),m("span",{class:Se([_(o.value.state),"text-xs font-medium"])},j(o.value.state),3),o.value.claudeSessionId?(M(),B(ye,{key:0},[v[3]||(v[3]=m("span",{class:"text-xs text-monitor-text-muted"},"Session:",-1)),m("code",v0,j(o.value.claudeSessionId.slice(0,8)),1)],64)):Q("",!0)]),v[6]||(v[6]=m("div",{class:"text-xs text-monitor-text-muted"}," Click terminal to type directly ",-1))]),m("div",{ref_key:"terminalContainerRef",ref:s,class:"flex-1 overflow-hidden",onClick:v[0]||(v[0]=()=>{const S=i.value.get(Ne(t).selectedWrapperId||"");S&&S.terminal.focus()})},null,512)])):(M(),B("div",S0,[...v[7]||(v[7]=[m("p",{class:"text-sm text-monitor-text-muted"},"Select a wrapper to view terminal",-1)])]))])),l.value.length>0&&!o.value?(M(),B("div",b0,[m("div",y0,j(l.value.length)+" wrapper(s) waiting for input ",1),m("div",w0,[(M(!0),B(ye,null,ft(l.value,S=>(M(),B("button",{key:S.wrapperId,class:"px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-500 transition-colors",onClick:C=>d(S.wrapperId)},j(S.wrapperId),9,C0))),128))])])):Q("",!0)]))}}),k0=Bh(x0,[["__scopeId","data-v-1f294f3d"]]),E0={class:"min-h-screen bg-monitor-bg-primary text-monitor-text-primary"},M0={class:"bg-monitor-bg-secondary border-b border-slate-700 px-4 py-3"},R0={class:"flex items-center justify-between"},B0={class:"flex items-center space-x-4"},D0={class:"flex items-center space-x-4"},T0={class:"flex items-center space-x-2"},P0={class:"text-monitor-text-muted text-sm"},L0={key:0,class:"w-2 h-2 rounded-full bg-white animate-pulse"},I0={class:"flex h-[calc(100vh-120px)]"},A0={class:"w-72 border-r border-slate-700 flex flex-col"},O0={class:"flex-1 flex flex-col"},N0={class:"h-32 border-b border-slate-700"},$0={key:0,class:"h-1/2 border-t border-slate-700 flex flex-col"},H0={class:"w-80 border-l border-slate-700 flex flex-col"},W0=Xt({__name:"App",setup(e){const t=as(),s=fe(!1),i=pe(()=>{switch(t.connectionStatus){case"connected":return"status-connected";case"connecting":return"status-connecting";default:return"status-disconnected"}});function r(o){(o.key==="Control"||o.key==="Meta")&&t.setCtrlPressed(!0)}function n(o){(o.key==="Control"||o.key==="Meta")&&t.setCtrlPressed(!1)}return Ir(()=>{t.connect(),window.addEventListener("keydown",r),window.addEventListener("keyup",n),window.addEventListener("blur",()=>t.setCtrlPressed(!1))}),Oi(()=>{t.disconnect(),window.removeEventListener("keydown",r),window.removeEventListener("keyup",n),window.removeEventListener("blur",()=>t.setCtrlPressed(!1))}),(o,l)=>(M(),B("div",E0,[m("header",M0,[m("div",R0,[m("div",B0,[l[1]||(l[1]=m("img",{src:tf,alt:"Contextuate",class:"h-8 w-auto"},null,-1)),l[2]||(l[2]=m("h1",{class:"text-xl font-semibold"},[m("span",{class:"text-monitor-accent-cyan"},"Contextuate"),m("span",{class:"text-monitor-text-secondary ml-2"},"Monitor")],-1)),$e(Lp)]),m("div",D0,[m("div",T0,[m("span",{class:Se(["w-2 h-2 rounded-full",{"bg-green-500 animate-pulse-dot":Ne(t).connectionStatus==="connected","bg-yellow-500 animate-pulse":Ne(t).connectionStatus==="connecting","bg-red-500":Ne(t).connectionStatus==="disconnected"}])},null,2),m("span",{class:Se(["text-sm",i.value])},j(Ne(t).connectionStatus),3)]),m("span",P0,j(Ne(t).sessions.length)+" session(s) ",1),m("button",{class:Se(["flex items-center space-x-2 px-3 py-1 rounded text-sm transition-colors",[Ne(t).activeWrappers.length>0?"bg-green-600 text-white hover:bg-green-500":s.value?"bg-monitor-accent-cyan text-white":"bg-slate-700 text-monitor-text-secondary hover:bg-slate-600"]]),onClick:l[0]||(l[0]=a=>s.value=!s.value)},[Ne(t).activeWrappers.length>0?(M(),B("span",L0)):Q("",!0),m("span",null,"Wrappers ("+j(Ne(t).activeWrappers.length)+")",1)],2)])])]),$e(jp,{class:"border-b border-slate-700"}),m("main",I0,[m("aside",A0,[l[3]||(l[3]=m("div",{class:"p-3 border-b border-slate-700"},[m("h2",{class:"text-sm font-medium text-monitor-text-secondary uppercase tracking-wide"}," Sessions ")],-1)),$e(r_,{class:"flex-1 overflow-y-auto"})]),m("div",O0,[m("div",N0,[$e(sp)]),m("div",{class:Se(["flex-1 overflow-hidden",{"h-1/2":s.value}])},[$e(z_)],2),s.value?(M(),B("div",$0,[$e(k0)])):Q("",!0)]),m("aside",H0,[l[4]||(l[4]=m("div",{class:"p-3 border-b border-slate-700"},[m("h2",{class:"text-sm font-medium text-monitor-text-secondary uppercase tracking-wide"}," Token Usage ")],-1)),$e(Rp,{class:"flex-1 overflow-y-auto"})])])]))}}),bc=Vd(W0),F0=Yd();bc.use(F0);bc.mount("#app");
